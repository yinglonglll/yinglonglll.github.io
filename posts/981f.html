<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Java基础">
    <meta name="description" content="摘要：Java基础">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Java基础 | yinglonglll</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="yinglonglll" type="application/atom+xml">
</head>


<!-- 添加加载动画判断 -->




<body>

    <!-- 给hexo博客适配全局深色模式 ,css样式放在my.css中-->
    <script>
        if (localStorage.getItem('dark') === '1') {
        document.body.classList.add('dark');
        }
        else if (new Date().getHours() >= 22 || new Date().getHours() < 7) {
        document.body.classList.add('dark');
        } 
        else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
        }
    </script>
    <a onclick="switchNightMode()" id="sma">
        <i class="fa fa-moon-o" id="nightMode" aria-hidden="true"></i>
    </a>
    
    <!-- END 给hexo博客适配全局深色模式 -->    

    <!-- start webpushr tracking code --> 
    <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";
    fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));
    webpushr('setup',{'key':'BNgmq5FVdJ-KyqD36I-eH-mHzVd-IHkK8eYttWSgCh3CTz3e2okxqiuAoo9WKgf8E1Rx2n2HNqTa4Q3Oxlb-Nkk' });</script>
    <!-- end webpushr tracking code -->

    <!-- 添加加载动画 -->
    

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">yinglonglll</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-shoe-prints" style="zoom: 0.6;"></i>
      
      <span>足迹</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/musics">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>音乐</span>
        </a>
      </li>
      
      <li>
        <a href="/video">
          
          <i class="fas fa-film" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>视频</span>
        </a>
      </li>
      
      <li>
        <a href="/galleries">
          
          <i class="fas fa-image" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>相册</span>
        </a>
      </li>
      
      <li>
        <a href="/archives">
          
          <i class="fas fa-archive" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>档案</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-book-open" style="zoom: 0.6;"></i>
      
      <span>文章</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>类别</span>
        </a>
      </li>
      
      <li>
        <a href="/tags">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>标签</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fas fa-link" style="zoom: 0.6;"></i>
      
      <span>链接库</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/friends">
          
          <i class="fas fa-address-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>友情链</span>
        </a>
      </li>
      
      <li>
        <a href="/toolbox">
          
          <i class="fas fa-toolbox" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>工具链</span>
        </a>
      </li>
      
      <li>
        <a href="/navigate">
          
          <i class="fas fa-location-arrow" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>导航链</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-list-ol" style="zoom: 0.6;"></i>
      
      <span>计划书</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/">
          
          <i class="far fa-edit" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>补全文章</span>
        </a>
      </li>
      
      <li>
        <a href="/">
          
          <i class="far fa-edit" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>添加云盘功能</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-house-user" style="zoom: 0.6;"></i>
      
      <span>实验室</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/">
          
          <i class="far fa-lightbulb" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>暂无实验</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-comment-dots" style="zoom: 0.6;"></i>
      
      <span>交流</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>关于我</span>
        </a>
      </li>
      
      <li>
        <a href="/contact">
          
          <i class="fas fa-comments" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>留言板</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">yinglonglll</div>
        <div class="logo-desc">
            
            本站记录本人各种学习的旅途，用于巩固自我并启发后来人
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-shoe-prints"></i>
			
			足迹
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/musics " style="margin-left:75px">
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>音乐</span>
                  </a>
                </li>
              
                <li>

                  <a href="/video " style="margin-left:75px">
				  
				   <i class="fa fas fa-film" style="position: absolute;left:50px" ></i>
			      
		          <span>视频</span>
                  </a>
                </li>
              
                <li>

                  <a href="/galleries " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>相册</span>
                  </a>
                </li>
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-archive" style="position: absolute;left:50px" ></i>
			      
		          <span>档案</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-book-open"></i>
			
			文章
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>类别</span>
                  </a>
                </li>
              
                <li>

                  <a href="/tags " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>标签</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fas fa-link"></i>
			
			链接库
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/friends " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>友情链</span>
                  </a>
                </li>
              
                <li>

                  <a href="/toolbox " style="margin-left:75px">
				  
				   <i class="fa fas fa-toolbox" style="position: absolute;left:50px" ></i>
			      
		          <span>工具链</span>
                  </a>
                </li>
              
                <li>

                  <a href="/navigate " style="margin-left:75px">
				  
				   <i class="fa fas fa-location-arrow" style="position: absolute;left:50px" ></i>
			      
		          <span>导航链</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list-ol"></i>
			
			计划书
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/ " style="margin-left:75px">
				  
				   <i class="fa far fa-edit" style="position: absolute;left:50px" ></i>
			      
		          <span>补全文章</span>
                  </a>
                </li>
              
                <li>

                  <a href="/ " style="margin-left:75px">
				  
				   <i class="fa far fa-edit" style="position: absolute;left:50px" ></i>
			      
		          <span>添加云盘功能</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-house-user"></i>
			
			实验室
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/ " style="margin-left:75px">
				  
				   <i class="fa far fa-lightbulb" style="position: absolute;left:50px" ></i>
			      
		          <span>暂无实验</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-comment-dots"></i>
			
			交流
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>关于我</span>
                  </a>
                </li>
              
                <li>

                  <a href="/contact " style="margin-left:75px">
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>留言板</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.webp')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Java基础</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    /* 适配目录 */
    .toc-widget {
        /* 修改前
        width: 345px;
        padding-left: 20px; */
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Java/">
                                <span class="chip bg-color">Java</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E7%AC%94%E8%AE%B0/" class="post-category">
                                笔记
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-02-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-02-15
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    49.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    192 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="学习的方式"><a href="#学习的方式" class="headerlink" title="学习的方式"></a>学习的方式</h1><blockquote>
<p>学习的方式就是读书与变通</p>
<ul>
<li>读书<ol>
<li>预习（预习即将学习的知识点、做一些简单性的练习）</li>
<li>学习（在老师的要求下使用学习到的知识做复杂练习、做完后自行做更多的练习即刷题）</li>
<li>温故知新（本质是总结知识点的串联、并联）</li>
</ol>
</li>
<li>变通<ol>
<li>预习（社会上就是看教学视频，了解功能及工作原理、自己落实简单Demo功能）</li>
<li>学习（社会上在公司进行大型项目时，就是真正的学习与做复杂练习题、自己深入学习就是刷题）</li>
<li>温故知新（这也是高人与新手的本质区别，能取其精华，弃其糟粕，为己所用，更上一层楼，即提高学习效率，这是指数级别的正向反馈增长，但一般人往往忽略1、3步，导致2进行不去，又或仅执行1、2，3不执行，忘却本质）</li>
</ol>
</li>
<li>拓展：代码技巧思想无非是时间换空间，空间换时间，或折中取最大收益这三种，没有既能上天又能入低万能代码。</li>
</ul>
</blockquote>
<h1 id="一、百度基础"><a href="#一、百度基础" class="headerlink" title="一、百度基础"></a>一、百度基础</h1><h2 id="1-Java基础"><a href="#1-Java基础" class="headerlink" title="1.Java基础"></a>1.Java基础</h2><h3 id="1-1-和-equals-的区别是什么？"><a href="#1-1-和-equals-的区别是什么？" class="headerlink" title="1.1 == 和 equals 的区别是什么？"></a>1.1 == 和 equals 的区别是什么？</h3><ul>
<li>对于==，比较的是值是否相等。<br>  如果作用于基本数据类型的变量，则直接比较其存储的 “值”是否相等；<br>  如果作用于引用类型的变量，则比较的是所指向的对象的地址。</li>
<li>对于equals方法，注意：equals方法不能作用于基本数据类型的变量，equals继承Object类，比较的是是否是同一个对象。<br>  <u>而基本数据类型是特殊的，没有集成equals方法</u>；如果没有对equals方法进行重写，则比较的是引用类型的变量所指向的对象的地址；诸如String、Date等类对equals方法进行了重写的话，比较的是所指向的对象的内容；</li>
</ul>
<h3 id="1-2-amp-和-amp-amp-的区别-和-同理-？"><a href="#1-2-amp-和-amp-amp-的区别-和-同理-？" class="headerlink" title="1.2 &amp;和&amp;&amp;的区别(| 和 || 同理)？"></a>1.2 &amp;和&amp;&amp;的区别(| 和 || 同理)？</h3><ul>
<li><p>&amp;是逻辑与(全部判断语句都会执行)，<br>  &amp;&amp;是短路与(从左到右，只要一个不成立则全部整个判断语句不成立)；</p>
</li>
<li><p>&amp;适用于判断条件时，前后条件的判断皆无互相关联，&amp;&amp;适用于“递进关系”的互相关联判断<br>  eg：&amp;&amp;–&gt;if(username != null &amp;&amp; !username.equals(“”))，此句正常，若换成&amp;，username为null时，还需再判断右边条件，导致NPE异常；</p>
</li>
</ul>
<h3 id="1-3-synchronized关键字的用法？"><a href="#1-3-synchronized关键字的用法？" class="headerlink" title="1.3 synchronized关键字的用法？"></a>1.3 synchronized关键字的用法？</h3><ul>
<li>synchronized关键字可以将对象或者方法标记为同步，以实现对对象和方法的互斥访问，可以用synchronized(对象) { … }定义同步代码块，或者在声明方法时将synchronized作为方法的修饰符。<br>  即限定对象只能一个在线持有者、方法只能一个在线使用者；</li>
</ul>
<h3 id="1-4-List、Set、Map-之间的区别是什么？"><a href="#1-4-List、Set、Map-之间的区别是什么？" class="headerlink" title="1.4 List、Set、Map 之间的区别是什么？"></a>1.4 List、Set、Map 之间的区别是什么？</h3><ul>
<li>List(有序、可重复)与Set(无序、不可重复–使用equals判断)是相反的、Map则是k-v键值存储；</li>
</ul>
<h3 id="1-5-并行和并发有什么区别？"><a href="#1-5-并行和并发有什么区别？" class="headerlink" title="1.5 并行和并发有什么区别？"></a>1.5 并行和并发有什么区别？</h3><ul>
<li>并行类似全双工通信，即多线程对多核–线程池应用；并发类似半双工通信，但速度快了就像全双工通信，即多线程对单核；</li>
<li>并发编程的目标是充分的利用处理器的每一个核，以达到最高的处理性能，即充分利用CPU的资源；</li>
</ul>
<h3 id="1-6-线程和进程的区别？"><a href="#1-6-线程和进程的区别？" class="headerlink" title="1.6 线程和进程的区别？"></a>1.6 线程和进程的区别？</h3><ul>
<li><p>进程是程序运行和资源分配的基本单位，一个程序至少有一个进程，一个进程至少有一个线程；进程在执行过程中拥有独立的内存单元，而多个线程共享内存资源，减少切换次数，从而效率更高。</p>
</li>
<li><p>线程是进程的一个实体，是cpu调度和分派的基本单位，是比程序更小的能独立运行的基本单位。同一进程中的多个线程之间可以并发执行。</p>
</li>
<li><p><del>创建线程有哪几种方式？</del></p>
<ol>
<li>继承Thread类创建线程类<ul>
<li>定义Thread类的子类，并重写该类的run方法，该run方法的方法体就代表了线程要完成的任务。因此把run()方法称为执行体。</li>
<li>创建Thread子类的实例，即创建了线程对象。</li>
<li>调用线程对象的start()方法来启动该线程。</li>
</ul>
</li>
<li>通过Runnable接口创建线程类<ul>
<li>定义runnable接口的实现类，并重写该接口的run()方法，该run()方法的方法体同样是该线程的线程执行体。</li>
<li>创建 Runnable实现类的实例，并依此实例作为Thread的target来创建Thread对象，该Thread对象才是真正的线程对象。</li>
<li>调用线程对象的start()方法来启动该线程。</li>
</ul>
</li>
<li>通过Callable和Future创建线程<ul>
<li>创建Callable接口的实现类，并实现call()方法，该call()方法将作为线程执行体，并且有返回值。</li>
<li>创建Callable实现类的实例，使用FutureTask类来包装Callable对象，该FutureTask对象封装了该Callable对象的call()方法的返回值。</li>
<li>使用FutureTask对象作为Thread对象的target创建并启动新线程。</li>
<li>调用FutureTask对象的get()方法来获得子线程执行结束后的返回值。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="1-7-如何学习源码？"><a href="#1-7-如何学习源码？" class="headerlink" title="1.7 如何学习源码？"></a>1.7 如何学习源码？</h3><ul>
<li>原因<ol>
<li>源码是对设计模式近乎完美的实践应用，是典型的范例，而，设计模式是前辈们对代码开发的经验总结，因此在看设计模式后再去看源码才是正确的步骤；</li>
<li>学习源码一定要明确源码带来的启迪作用，即通过xx的设计模式，实现了xx的功能，而这个功能解决了xx的问题，这个因果关系就是启迪作用，项目中遇到同样或相关的问题就可以用来解决；</li>
</ol>
</li>
</ul>
<h3 id="1-8-JDK8和JDK11的区别"><a href="#1-8-JDK8和JDK11的区别" class="headerlink" title="1.8 JDK8和JDK11的区别"></a>1.8 JDK8和JDK11的区别</h3><blockquote>
<p>简述：最大差别是jdk11去除了jre、采用模块化定制化jre、使用时配置jre环境变量；同时jdk8的新特性在后续版本也是会继续继承的，故特性功能可一点一点掌握，其lts版本就是每次版本的总和，即每次学习lts版本即可，切勿跨大步</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lukelook/p/13588801.html">两者区别</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jackion5/p/10772017.html">历代特性</a></p>
</blockquote>
<h3 id="1-9-ElasticSearch部分"><a href="#1-9-ElasticSearch部分" class="headerlink" title="1.9 ElasticSearch部分"></a>1.9 ElasticSearch部分</h3><blockquote>
<p>ElasticSearch<br>post默认是全部修改，加上_update则是对应修改，并且_update需要配合doc的格式进行修改<br>term与match、解决能不能查问题；<br>keyword和text解决查询方式的问题<br>换句话说：term仅支持keyword和数值类型的精确查询，而match仅支持text的分词查询；若混用，就查不到结果；</p>
<p>面向文档，一切皆json，<br>正向索引是key找value，倒排索引是value找key，而倒排索引又有”权重”一词，即score；且通过标签区分数据，找到对应的标签后再逐个匹配查询，即空间换时间</p>
</blockquote>
<p>1.10 Idea初期开发项目配置</p>
<blockquote>
</blockquote>
<ul>
<li>ProjectStruction配置<ol>
<li>Project和Moudle都要设置项目需要的JDK版本，如设置JDK8和JDK8对应的语法版本8；</li>
<li>在settings中查JavaComplier编辑器设置项目的Target bytecode version版本也是相应的JDK版本再开发项目；</li>
</ol>
</li>
</ul>
<h1 id="二、知识基础"><a href="#二、知识基础" class="headerlink" title="二、知识基础"></a>二、知识基础</h1><h2 id="1-Java基础-1"><a href="#1-Java基础-1" class="headerlink" title="1. Java基础"></a>1. Java基础</h2><h3 id="1-1-面向对象的有哪些特征？"><a href="#1-1-面向对象的有哪些特征？" class="headerlink" title="1.1 面向对象的有哪些特征？"></a>1.1 面向对象的有哪些特征？</h3><ul>
<li>封装：封装隐藏了类内部的实现机制，可在不影响使用的前提下，改变类的内部结构，同时也保护的数据，因为对外而言，内部的细节是隐藏的，故封装增加了代码的可维护性；</li>
<li>继承：继承是从已有的类中派生出新的类，新的类能够吸收已有类的属性和行为，并能拓展新的能力，本质上是特殊到一般的关系，故继承增加了代码的复用性；</li>
<li>多态：多态的三要素：继承、重写、父类引用指向子类对象，增加了代码的可移植性，健壮性；</li>
</ul>
<h3 id="1-2-数组-Array-和列表-ArrayList-有什么区别？"><a href="#1-2-数组-Array-和列表-ArrayList-有什么区别？" class="headerlink" title="1.2 数组(Array)和列表(ArrayList)有什么区别？"></a>1.2 数组(Array)和列表(ArrayList)有什么区别？</h3><ul>
<li><p>下面列出了Array和ArrayList的不同点：</p>
<ol>
<li>Array可以包含基本类型和对象类型，ArrayList只能包含对象类型。</li>
<li>Array大小是固定的，ArrayList的大小是动态变化的。</li>
<li>ArrayList提供了更多的方法和特性，比如：addAll()，removeAll()，iterator()等等。</li>
<li>对于基本类型数据，集合使用自动装箱来减少编码工作量。但是，当处理固定大小的基本数据类型的时候，这种方式相对比较慢。</li>
</ol>
</li>
</ul>
<h3 id="1-2-ArrayList和LinkedList有什么区别？"><a href="#1-2-ArrayList和LinkedList有什么区别？" class="headerlink" title="1.2 ArrayList和LinkedList有什么区别？"></a>1.2 ArrayList和LinkedList有什么区别？</h3><ul>
<li>ArrayList底层是数组实现的列表，它可以以O(1)时间复杂度对元素进行随机访问；LinkedList是单链表实现的列表，查找某个元素的时间复杂度是O(n)；</li>
<li>LinkedList比ArrayList更占内存，因为LinkedList为每一个节点存储了两个引用，一个指向前一个元素，一个指向下一个元素。</li>
<li>差异<ol>
<li>查：Array *查询只需根据数组下标快速找到对应的数据，而 Linked *需要顺序遍历每个链表中存储下一个链表地址的数据，才能查询依次查到，故Array *查快</li>
<li>改：Array *一改某处，某处后面全部都要重新排序，而Linked *只需要在打断修改处的链地址，修改前后链表中存储下一个链表地址的数据即可，故Linked *改快</li>
</ol>
</li>
</ul>
<h3 id="1-3-高并发中的集合有哪些问题-？"><a href="#1-3-高并发中的集合有哪些问题-？" class="headerlink" title="1.3 高并发中的集合有哪些问题 ？"></a>1.3 高并发中的集合有哪些问题 ？</h3><h3 id="1-4-jdk1-8的新特性有哪些-？"><a href="#1-4-jdk1-8的新特性有哪些-？" class="headerlink" title="1.4 jdk1.8的新特性有哪些 ？"></a>1.4 jdk1.8的新特性有哪些 ？</h3><h3 id="1-5-接口和抽象类有哪些区别？"><a href="#1-5-接口和抽象类有哪些区别？" class="headerlink" title="1.5 接口和抽象类有哪些区别？"></a>1.5 接口和抽象类有哪些区别？</h3><ul>
<li><p>抽象类是可接触到的具体<u>概念</u>，如植物、动物、食物等，</p>
</li>
<li><p>接口是描述某些共同事物之间所具有的<u>特征</u>，蜻蜓会飞、飞机会飞、鸟也会飞，即飞为特征</p>
</li>
<li><p>hashcode和equals如何使用 ？</p>
<ol>
<li><p>两者本质上是涉及HashMap底层原理，而HashMap底层1.8是 数组-单链表-红黑树</p>
</li>
<li><p>当我们往HashMap中放入k-v键值对时，实际上是先放入key，通过hashCode()获取该对象所在<u>内存地址的整数</u>表示，即哈希码，然后带入哈希码到散列算法(对16取余)得到0~15的indexHashMap的桶下标，即value的内存地址位置；<br> 查key时，先通过hashcode快速定位记录的位置.然后再通过equals来顺序比较各个单链表的hashcode，如都不等即无存在该key，则再指向一个新的链表存key的value即可；</p>
</li>
<li><p>HashMap的简概</p>
 <img src="D:/App/Typora/TyporaSource/Private/Java基础/HashMap组成.png" style="zoom: 67%;" />

<ul>
<li><p>源码关键字</p>
<ol>
<li>LoadFactor：负载因子，默认为0.75；</li>
<li>threshold：表示所能容纳的键值对的临界值=size/LoadFactor，当threshold&gt;HashMap.INITIAL_CAPACITY.时，新建一个hashmap数组；</li>
<li>size：HashMap中实际存在的键值对数量；</li>
<li>modCount：用来记录HashMap内部结构发生变化的次数；</li>
<li>HashMap：默认数组容量为INITIAL_CAPACITY为16；</li>
</ol>
</li>
<li><p>链表与红黑树转换关系</p>
<ol>
<li>HashMap数组中部分称为哈希桶，当链表长度大于等于8时，链表数据将以红黑树(O(logn))的形式进行存储，当长度降到6时，转成链表(O(n))；</li>
<li>链表(红黑树)的node节点存储着用来定位数据索引位置的hash值、k、v、指向链表下一个节点的node&lt;k,v&gt; next节点组成；</li>
</ol>
</li>
<li><p>增key的关系(前7后8：1.8尾插入)</p>
<ol>
<li>当插入第二个以“a”为key的对象时，将新值赋给“a”的值；<br> 当插入的对象大小超过临界值threshold时，hashMap将新建一个桶数组并重新赋值；</li>
</ol>
</li>
<li><p>哈希码与AII码的关系 </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yb546822612/article/details/106209383">https://blog.csdn.net/yb546822612/article/details/106209383</a></p>
</blockquote>
<ol>
<li>对于单数字、单字母是完全对应的</li>
</ol>
</li>
<li><p>理解进阶</p>
<blockquote>
<p>HashMap更详解<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv5517205/">https://www.bilibili.com/read/cv5517205/</a></p>
</blockquote>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="1-6-Java代理模式？"><a href="#1-6-Java代理模式？" class="headerlink" title="1.6 Java代理模式？"></a>1.6 Java代理模式？</h3><blockquote>
<p>代理模式：接口A+接口实现类B+实现类的代理类C，其中代理逻辑是 通过传入 B 的对象，然后在 C 调用的方法中加入 B 的调用方法+额外代理添加的方法，达到复用及扩充功能的效果；</p>
</blockquote>
<ul>
<li><p>静态代理：每个接口实现类都要对应一个实现类的代理类，无法抽象化实现类的代理类，十分冗余</p>
</li>
<li><p>JDK内置代理：通过反射实现，可以抽象化实现类的代理类，但需每个被代理的类是实现接口，即成为实现类；</p>
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/JDK代理.png" style="zoom: 50%;" /></li>
<li><p>CGLIB代理(JDK代理的补充)：可以抽象化实现类的代理类，不需被代理的类是实现类；需带入第三方依赖</p>
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/CDLIB代理.png" style="zoom:50%;" />
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Java代理的调用.png" style="zoom:50%;" /></li>
<li><p>重写与重载的区别？</p>
<ol>
<li>重载：在同一类中，取决于 方法名与参数类型 来区分方法；</li>
<li>重写：在子父类中，直接重写方法，父类权限修饰符 &lt; 子类 *、父类返回值类型 &gt; 子类 *；</li>
</ol>
</li>
<li><p>String、StringBuilder(1.5)、StringBuffer(1.0)的区别？</p>
<ol>
<li>String：字符串常量，内存地址会变；</li>
<li>两者对象被创建时，都会在堆中开辟一个内存空间，含有value和count两个属性，其中value底层是一个可变数组，内存地址不变(除了数组扩容)，也是与String区分的地方；</li>
</ol>
</li>
<li><p>怎样声明一个类不会被继承，什么场景下会用？</p>
<ol>
<li>final的特性：不可被继承、不可被修改、不可被重写，故类被final修饰后无法继承；</li>
<li>如果类中的所有方法没有重写、没有子类，则使用final修饰类，且配合static调用，增加代码的效率，如Math类；</li>
<li>(常量的作用域是全局的,不存在全局与局部的概念)</li>
</ol>
</li>
</ul>
<h2 id="2-Redis基础"><a href="#2-Redis基础" class="headerlink" title="2. Redis基础"></a>2. Redis基础</h2><h3 id="2-1-为什么说Redis是单线程的以及Redis为什么这么快？"><a href="#2-1-为什么说Redis是单线程的以及Redis为什么这么快？" class="headerlink" title="2.1 为什么说Redis是单线程的以及Redis为什么这么快？"></a>2.1 为什么说Redis是单线程的以及Redis为什么这么快？</h3><blockquote>
<p>数据库的工作模式按存储方式可分为：硬盘数据库和内存数据库，如下图；Redis属于内存数据库，数据库、缓存和消息中间件。Redis通过单线程实现的Reactor模式</p>
</blockquote>
<ul>
<li><p>Redis 将数据储存在<u>内存</u>里面，读写数据的时候都不会受到硬盘 I/O 速度的限制，且数据结构设计有优势，所以速度极快；</p>
</li>
<li><p>采用<u>单线程</u>，避免了不必要的上下文切换和竞争条件，不存在多进程或者多线程导致的切换而消耗 CPU，不用去考虑各种锁的问题（不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗）；<br>  因此Redis更适合大缓存的CPU，但是，我们使用单线程的方式是无法发挥多核CPU 性能，不过我们可以通过在单机开多个Redis 实例来完善！</p>
</li>
<li><p>使用<u>多路I/O复用模型</u>，非阻塞IO；<u>Reactor 模式</u>的基本设计思想是基于I/O复用模型来实现的。Reactor 通过 I/O复用程序监控客户端请求事件，收到事件后通过任务分派器进行分发。<br>  针对建立连接请求事件，通过 Acceptor 处理，并建立对应的 handler 负责后续业务处理。<br>  针对非连接事件，Reactor 会调用对应的 handler 完成 read-&gt;业务处理-&gt;write 处理流程，并将结果返回给客户端。<br>  整个过程都在一个线程里完成。<br>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Reactor模型.png"></p>
</li>
</ul>
<blockquote>
<p>概念：<br>多路I/O复用模型是利用 select、poll、epoll 可以同时监察多个流的 I/O 事件的能力，在空闲的时候，会把当前线程阻塞掉，当有一个或多个流有 I/O 事件时，就从阻塞态中唤醒，于是程序就会轮询一遍所有的流（epoll 是只轮询那些真正发出了事件的流），并且只依次顺序的处理就绪的流，这种做法就避免了大量的无用操作。</p>
<p>名词：<br>这里“多路”指的是多个网络连接，“复用”指的是复用同一个线程。采用多路 I/O 复用技术可以让单个线程高效的处理多个连接请求（尽量减少网络 IO 的时间消耗），且 Redis 在内存中操作数据的速度非常快，也就是说内存内的操作不会成为影响Redis性能的瓶颈，主要由以上几点造就了 Redis 具有很高的吞吐量。</p>
</blockquote>
<ul>
<li>使用<u>底层模型不同</u>，它们之间底层实现方式以及与客户端之间通信的应用协议不一样，Redis直接自己构建了VM 机制 ，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求；<br>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/硬盘数据库.png" style="zoom:50%;" /><img src="D:/App/Typora/TyporaSource/Private/Java基础/内存数据库.png" style="zoom:57%;" /></li>
</ul>
<h3 id="2-2-redis持久化机制-RDB和AOF？"><a href="#2-2-redis持久化机制-RDB和AOF？" class="headerlink" title="2.2 redis持久化机制 RDB和AOF？"></a>2.2 redis持久化机制 RDB和AOF？</h3><blockquote>
<p>Redis更适合用于作为缓存使用，而不是数据库</p>
</blockquote>
<ul>
<li><p>定义</p>
<ol>
<li>RDB持久化方式能够在<u>指定的时间间隔</u>能对你的数据进行<u>快照存储</u>，即保存数据；</li>
<li>AOF持久化方式<u>记录</u>每次对服务器<u>写的操作命令</u>,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾、文件过大时可对AOF文件进行后台重写；</li>
</ol>
</li>
<li><p>优点</p>
<ol>
<li>RDB是紧凑的单一文件便于传输且更快恢复数据、<br> 保存RDB文件是fork出子线程来做保证redis最大化性能</li>
<li>AOF至多丢失1s数据、<br> 自动重写功能保证AOF文件体积不会太大且绝对安全、<br> AOF 文件有序地保存了对数据库执行的所有写操作，<br> 即文件内容容易读懂和进行分析；</li>
</ol>
</li>
<li><p>缺点</p>
<ol>
<li>RDB断电丢失较多数据、<br> 数据集过大导致新建的fork子进程耗时导致毫秒级暂时无法响应；</li>
<li>AOF文件体积大于RDB、<br> AOF重新生成数据更耗时；</li>
</ol>
</li>
</ul>
<h3 id="2-3-Redis过期键的删除策略？"><a href="#2-3-Redis过期键的删除策略？" class="headerlink" title="2.3 Redis过期键的删除策略？"></a>2.3 Redis过期键的删除策略？</h3><blockquote>
<p>Redis的过期键删除策略：Redis服务器实际使用的是惰性删除和定期删除两种策略。<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lukexwang/p/4694094.html">https://www.cnblogs.com/lukexwang/p/4694094.html</a></p>
</blockquote>
<ul>
<li><p>定义</p>
<ol>
<li>定时删除：在设置键的过期时间的同时创建一个定时器(timer)，使定时器在键的过期时间点对键删除；</li>
<li>惰性删除：每次从键空间中获取键时，都检查取得的键是否过期，若过期则删除该键；反之返回该键；</li>
<li>定期删除：每隔一段时间，程序就对数据库进行一次(随机抽样)检查，删除里面的过期键。至于删除多少过期键，以及要检查多少个数据库，则由算法决定，定期删除可以稳定内存空间平衡。</li>
</ol>
</li>
<li><p>比较</p>
<ol>
<li><p>定时删除策略对内存是最友好的，但对CPU不友好，创建过多定时器导致占用大量CPU，影响服务器的响应时间和吞吐量；</p>
</li>
<li><p>惰性删除策略对CPU时间来说是最友好的，但有内存泄漏的危险；</p>
</li>
<li><p>定期删除策略是前两种策略的一种整合和折中</p>
<blockquote>
<p>定期删除策略每隔一段时间执行一次删除过期键操作，并通过<u>限制删除操作执行的时长和频率</u>来减少删除操作对CPU时间的影响；<br>通过定期删除过期键，定期删除策略有效地减少了因为过期键而带来的内存浪费；</p>
<p>定期删除策略的难点是确定删除操作执行的时长和频率。</p>
</blockquote>
</li>
</ol>
</li>
<li><p>拓展</p>
<ol>
<li>绝对时间点过期、相对时间点过期、时钟轮算法</li>
</ol>
</li>
</ul>
<h3 id="2-4-redis缓存如何回收？"><a href="#2-4-redis缓存如何回收？" class="headerlink" title="2.4 redis缓存如何回收？"></a>2.4 redis缓存如何回收？</h3><ul>
<li><p>回收策略</p>
  <pre class="line-numbers language-none"><code class="language-none">noeviction:返回错误当内存限制达到并且客户端尝试执行会让更多内存被使用的命令（大部分的写入指令，但DEL和几个例外）
allkeys-lru: 尝试回收最少使用的键（LRU），使得新添加的数据有空间存放。
volatile-lru: 尝试回收最少使用的键（LRU），但仅限于在过期集合的键,使得新添加的数据有空间存放。
allkeys-random: 回收随机的键使得新添加的数据有空间存放。
volatile-random: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。
volatile-ttl: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键,使得新添加的数据有空间存放。
volatile-lfu：从所有配置了过期时间的键中驱逐使用频率最少的键
allkeys-lfu：从所有键中驱逐使用频率最少的键
------------------------------------------------
# 设置方式
config set maxmemory-policy volatile-lru <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>回收过程</p>
<ol>
<li><p>一个客户端运行了新的命令，添加了新的数据。</p>
</li>
<li><p>Redi检查内存使用情况，如果大于maxmemory的限制, 则根据设定好的策略进行回收。</p>
</li>
<li><p>一个新的命令被执行，等等。</p>
</li>
<li><p>所以我们不断地穿越内存限制的边界，通过不断达到边界然后不断地回收回到边界以下。</p>
</li>
<li><p>redis集群方案有哪些？</p>
<blockquote>
<p>做集群的原因不仅仅是数据量大导致内存空间需求大，还需考虑访问的并发量、网络吞吐量等问题</p>
</blockquote>
</li>
</ol>
</li>
<li><p>主从复制集群</p>
<ol>
<li><p>主从数据同步是异步进行的，导致难以保持主从数据一致性；</p>
<blockquote>
<p>缓存不对数据的一致性、完整性有更高的要求，更注重性能，即对于决策性数据，主修改值，从未来得及异步同步数据，主就出问题，这样就导致数据的丢失；<u>但单实例redis不会有这样问题</u>；</p>
</blockquote>
</li>
</ol>
</li>
<li><p>分片集群</p>
<ol>
<li><p><del>客户端实现路由索引的分片集群</del></p>
<blockquote>
<p>分片解决了内存大、访问的并发量的问题，但弊端是网络吞吐量的问题；</p>
</blockquote>
</li>
<li><p>使用中间件代理层的分片集群</p>
<blockquote>
<p>利用中间件将实现路由索引的算法进行解耦(客户端与分片集群的耦合性)，但弊端还是中间件的网络吞吐量的问题；</p>
</blockquote>
</li>
<li><p>Redis自身实现的cluster分片集群(将代理层下放到cluster分片集群上)</p>
</li>
</ol>
</li>
</ul>
<h3 id="2-5-为什么-Redis-不支持回滚（roll-back）？"><a href="#2-5-为什么-Redis-不支持回滚（roll-back）？" class="headerlink" title="2.5 为什么 Redis 不支持回滚（roll back）？"></a>2.5 为什么 Redis 不支持回滚（roll back）？</h3><ul>
<li>Redis 命令只会因为错误的语法而失败（并且这些问题不能在入队时发现），但从实用性角度来说，出现失败命令都是在开发过程中出现的，我们可以修正错误，从而规避发生在生产环境的问题，故没必要支持，因此Redis 的内部可以保持简单且快速；</li>
</ul>
<h3 id="2-6-redis主从复制的原理？"><a href="#2-6-redis主从复制的原理？" class="headerlink" title="2.6 redis主从复制的原理？"></a>2.6 redis主从复制的原理？</h3><ul>
<li><p>原理：当一个 master 实例和一个 slave 实例连接正常时，master会发送一连串的<u>命令流</u>来保持对 slave 的异步更新，当 master 和 slave 之间的连接断开之后，先尝试<u>部分重同步</u>，当无法进行部分重同步时， slave 会请求进 行<u>全量重同步</u>(RDB文件全同步)； </p>
</li>
<li><p>注意：切记<u>主从复制时不要开启AOF</u>，因为一开始时可能讲salve的数据同步清空；</p>
</li>
</ul>
<h3 id="2-7-缓存雪崩、穿透、击穿如何处理？"><a href="#2-7-缓存雪崩、穿透、击穿如何处理？" class="headerlink" title="2.7 缓存雪崩、穿透、击穿如何处理？"></a>2.7 缓存雪崩、穿透、击穿如何处理？</h3><blockquote>
<p>详细处理见 面试_马士兵.md</p>
</blockquote>
<ul>
<li><p>问题原理</p>
<ol>
<li>穿透：缓存不存在，数据库不存在，高并发，少量key</li>
<li>击穿：缓存不存在，数据库存在，高并发，少量key</li>
<li>雪崩：缓存不存在，数据库存在，高并发，大量key</li>
</ol>
</li>
<li><p>设计处理</p>
<ol>
<li><p>限流锁(建议工具类Semaphore信号锁)+预热</p>
<blockquote>
<p>缓存如果不存在，无论数据是否存在于数据库或弱数据，(根据哪种key的访问量大到小排序,逐一拿锁？），让请求都进行抢锁，抢不到自选锁，自旋完再访问缓存，直到抢到锁(限流的互斥锁，保障O(1)复杂度)来访问数据库，保障数据库的稳定</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h2 id="3-Mysql基础"><a href="#3-Mysql基础" class="headerlink" title="3. Mysql基础"></a>3. Mysql基础</h2><blockquote>
<p>Mysql调优是 先查看执行计划即explain(看type、if、)，再结合实际情况调优</p>
</blockquote>
<h3 id="3-1-mysql执行计划怎么看？"><a href="#3-1-mysql执行计划怎么看？" class="headerlink" title="3.1 mysql执行计划怎么看？"></a>3.1 mysql执行计划怎么看？</h3><ul>
<li><p>在企业的应用场景中，为了知道优化SQL语句的执行，需要查看SQL语句的具体执行过程，以加快SQL语句的执行效率。</p>
<p>  ​       可以使用explain+SQL语句来模拟优化器执行SQL查询语句，从而知道mysql是如何处理sql语句的。</p>
<p>  ​       官网地址： <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a> </p>
<p>  1、执行计划中包含的信息</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>The <code>SELECT</code> identifier</td>
</tr>
<tr>
<td>select_type</td>
<td>The <code>SELECT</code> type</td>
</tr>
<tr>
<td>table</td>
<td>The table for the output row</td>
</tr>
<tr>
<td>partitions</td>
<td>The matching partitions</td>
</tr>
<tr>
<td>type</td>
<td>The join type</td>
</tr>
<tr>
<td>possible_keys</td>
<td>The possible indexes to choose</td>
</tr>
<tr>
<td>key</td>
<td>The index actually chosen</td>
</tr>
<tr>
<td>key_len</td>
<td>The length of the chosen key</td>
</tr>
<tr>
<td>ref</td>
<td>The columns compared to the index</td>
</tr>
<tr>
<td>rows</td>
<td>Estimate of rows to be examined</td>
</tr>
<tr>
<td>filtered</td>
<td>Percentage of rows filtered by table condition</td>
</tr>
<tr>
<td>extra</td>
<td>Additional information</td>
</tr>
</tbody></table>
<p>  <strong>id</strong></p>
<p>  select查询的序列号，包含一组数字，表示查询中执行select子句或者操作表的顺序</p>
<p>  id号分为三种情况：</p>
<p>  ​        1、如果id相同，那么执行顺序从上到下</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">join</span> dept d <span class="token keyword">on</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno <span class="token keyword">join</span> salgrade sg <span class="token keyword">on</span> e<span class="token punctuation">.</span>sal <span class="token operator">between</span> sg<span class="token punctuation">.</span>losal <span class="token operator">and</span> sg<span class="token punctuation">.</span>hisal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  ​        2、如果id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> d<span class="token punctuation">.</span>deptno <span class="token keyword">from</span> dept d <span class="token keyword">where</span> d<span class="token punctuation">.</span>dname <span class="token operator">=</span> <span class="token string">'SALES'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  ​        3、id相同和不同的，同时存在：相同的可以认为是一组，从上往下顺序执行，在所有组中，id值越大，优先级越高，越先执行</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">join</span> dept d <span class="token keyword">on</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span> d<span class="token punctuation">.</span>deptno <span class="token keyword">join</span> salgrade sg <span class="token keyword">on</span> e<span class="token punctuation">.</span>sal <span class="token operator">between</span> sg<span class="token punctuation">.</span>losal <span class="token operator">and</span> sg<span class="token punctuation">.</span>hisal <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> d<span class="token punctuation">.</span>deptno <span class="token keyword">from</span> dept d <span class="token keyword">where</span> d<span class="token punctuation">.</span>dname <span class="token operator">=</span> <span class="token string">'SALES'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>select_type</strong></p>
<p>  主要用来分辨查询的类型，是普通查询还是联合查询还是子查询</p>
<table>
<thead>
<tr>
<th><code>select_type</code> Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>SIMPLE</td>
<td>Simple SELECT (not using UNION or subqueries)</td>
</tr>
<tr>
<td>PRIMARY</td>
<td>Outermost SELECT</td>
</tr>
<tr>
<td>UNION</td>
<td>Second or later SELECT statement in a UNION</td>
</tr>
<tr>
<td>DEPENDENT UNION</td>
<td>Second or later SELECT statement in a UNION, dependent on outer query</td>
</tr>
<tr>
<td>UNION RESULT</td>
<td>Result of a UNION.</td>
</tr>
<tr>
<td>SUBQUERY</td>
<td>First SELECT in subquery</td>
</tr>
<tr>
<td>DEPENDENT SUBQUERY</td>
<td>First SELECT in subquery, dependent on outer query</td>
</tr>
<tr>
<td>DERIVED</td>
<td>Derived table</td>
</tr>
<tr>
<td>UNCACHEABLE SUBQUERY</td>
<td>A subquery for which the result cannot be cached and must be re-evaluated for each row of the outer query</td>
</tr>
<tr>
<td>UNCACHEABLE UNION</td>
<td>The second or later select in a UNION that belongs to an uncacheable subquery (see UNCACHEABLE SUBQUERY)</td>
</tr>
</tbody></table>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--sample:简单的查询，不包含子查询和union</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>

<span class="token comment">--primary:查询中若包含任何复杂的子查询，最外层查询则被标记为Primary</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> staname<span class="token punctuation">,</span>ename supname <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ename staname<span class="token punctuation">,</span>mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span> t <span class="token keyword">join</span> emp <span class="token keyword">on</span> t<span class="token punctuation">.</span>mgr<span class="token operator">=</span>emp<span class="token punctuation">.</span>empno <span class="token punctuation">;</span>

<span class="token comment">--union:若第二个select出现在union之后，则被标记为union</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">;</span>

<span class="token comment">--dependent union:跟union类似，此处的depentent表示union或union all联合而成的结果会受外部表影响</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>empno  <span class="token operator">in</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">)</span>

<span class="token comment">--union result:从union表获取结果的select</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span><span class="token number">2000</span><span class="token punctuation">;</span>

<span class="token comment">--subquery:在select或者where列表中包含子查询</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">--dependent subquery:subquery的子查询要受到外部表查询的影响</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> dept<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--DERIVED: from子句中出现的子查询，也叫做派生类，</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> staname<span class="token punctuation">,</span>ename supname <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> ename staname<span class="token punctuation">,</span>mgr <span class="token keyword">from</span> emp<span class="token punctuation">)</span> t <span class="token keyword">join</span> emp <span class="token keyword">on</span> t<span class="token punctuation">.</span>mgr<span class="token operator">=</span>emp<span class="token punctuation">.</span>empno <span class="token punctuation">;</span>

<span class="token comment">--UNCACHEABLE SUBQUERY：表示使用子查询的结果不能被缓存</span>
 <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> empno <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno<span class="token operator">=</span>@<span class="token variable">@sort_buffer_size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">--uncacheable union:表示union的查询结果不能被缓存：sql语句未验证</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <strong>table</strong></p>
<p>  对应行正在访问哪一个表，表名或者别名，可能是临时表或者union合并结果集</p>
<pre><code>      1、如果是具体的表名，则表明从实际的物理表中获取数据，当然也可以是表的别名
</code></pre>
<p>  ​        2、表名是derivedN的形式，表示使用了id为N的查询产生的衍生表</p>
<p>  ​        3、当有union result的时候，表名是union n1,n2等的形式，n1,n2表示参与union的id</p>
<p>  <strong>type</strong></p>
<p>  type显示的是访问类型，访问类型表示我是以何种方式去访问我们的数据，最容易想的是全表扫描，直接暴力的遍历一张表去寻找需要的数据，效率非常低下，访问的类型有很多，效率从最好到最坏依次是：</p>
<p>  system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL </p>
<p>  一般情况下，得保证查询至少达到range级别，最好能达到ref</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--all:全表扫描，一般情况下出现这样的sql语句而且数据量比较大的话那么就需要进行优化。</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>

<span class="token comment">--index：全索引扫描这个比all的效率要好，主要有两种情况，一种是当前的查询时覆盖索引，即我们需要的数据在索引中就可以索取，或者是使用了索引进行排序，这样就避免数据的重排序</span>
<span class="token keyword">explain</span>  <span class="token keyword">select</span> empno <span class="token keyword">from</span> emp<span class="token punctuation">;</span>

<span class="token comment">--range：表示利用索引查询的时候限制了范围，在指定范围内进行查询，这样避免了index的全索引扫描，适用的操作符： =, &lt;>, >, >=, &lt;, &lt;=, IS NULL, BETWEEN, LIKE, or IN() </span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">between</span> <span class="token number">7000</span> <span class="token operator">and</span> <span class="token number">7500</span><span class="token punctuation">;</span>

<span class="token comment">--index_subquery：利用索引来关联子查询，不再扫描全表</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> emp<span class="token punctuation">.</span>job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> t_job<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--unique_subquery:该连接类型类似与index_subquery,使用的是唯一索引</span>
 <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> deptno <span class="token keyword">from</span> dept<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">--index_merge：在查询过程中需要多个索引组合使用，没有模拟出来</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> rental <span class="token keyword">where</span> rental_date <span class="token operator">like</span> <span class="token string">'2005-05-26 07:12:2%'</span> <span class="token operator">and</span> inventory_id<span class="token operator">=</span><span class="token number">3926</span> <span class="token operator">and</span> customer_id<span class="token operator">=</span><span class="token number">321</span>\G

<span class="token comment">--ref_or_null：对于某个字段即需要关联条件，也需要null值的情况下，查询优化器会选择这种访问方式</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e <span class="token keyword">where</span>  e<span class="token punctuation">.</span>mgr <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">or</span> e<span class="token punctuation">.</span>mgr<span class="token operator">=</span><span class="token number">7369</span><span class="token punctuation">;</span>

<span class="token comment">--ref：使用了非唯一性索引进行数据的查找</span>
 <span class="token keyword">create</span> <span class="token keyword">index</span> idx_3 <span class="token keyword">on</span> emp<span class="token punctuation">(</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp e<span class="token punctuation">,</span>dept d <span class="token keyword">where</span> e<span class="token punctuation">.</span>deptno <span class="token operator">=</span>d<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>

<span class="token comment">--eq_ref ：使用唯一性索引进行数据查找</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>emp2 <span class="token keyword">where</span> emp<span class="token punctuation">.</span>empno <span class="token operator">=</span> emp2<span class="token punctuation">.</span>empno<span class="token punctuation">;</span>

<span class="token comment">--const：这个表至多有一个匹配行，</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
 
<span class="token comment">--system：表只有一行记录（等于系统表），这是const类型的特例，平时不会出现</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>   <strong>possible_keys</strong> </p>
<p>  ​        显示可能应用在这张表中的索引，一个或多个，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询实际使用</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>key</strong></p>
<p>  ​        实际使用的索引，如果为null，则没有使用索引，查询中若使用了覆盖索引，则该索引和查询的select字段重叠。</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>key_len</strong></p>
<p>  表示索引中使用的字节数，可以通过key_len计算查询中使用的索引长度，在不损失精度的情况下长度越短越好。</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>ref</strong></p>
<p>  显示索引的哪一列被使用了，如果可能的话，是一个常数</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno <span class="token operator">and</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>rows</strong></p>
<p>  根据表的统计信息及索引使用情况，大致估算出找出所需记录需要读取的行数，此参数很重要，直接反应的sql找了多少数据，在完成目的的情况下越少越好</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  <strong>extra</strong></p>
<p>  包含额外的信息。</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--using filesort:说明mysql无法利用索引进行排序，只能利用排序算法进行排序，会消耗额外的位置</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal<span class="token punctuation">;</span>

<span class="token comment">--using temporary:建立临时表来保存中间结果，查询完成之后把临时表删除</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> ename<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">group</span> <span class="token keyword">by</span> ename<span class="token punctuation">;</span>

<span class="token comment">--using index:这个表示当前的查询时覆盖索引的，直接从索引中读取数据，而不用访问数据表。如果同时出现using where 表名索引被用来执行索引键值的查找，如果没有，表面索引被用来读取数据，而不是真的查找</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">--using where:使用where进行条件过滤</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">--using join buffer:使用连接缓存，情况没有模拟出来</span>

<span class="token comment">--impossible where：where语句的结果总是false</span>
<span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7469</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="3-1-索引的基本原理"><a href="#3-1-索引的基本原理" class="headerlink" title="3.1 索引的基本原理"></a>3.1 索引的基本原理</h3><ul>
<li><p>为什么要有索引?</p>
<ol>
<li>一般的应用系统，读写比例在10:1左右，而且插入操作和一般的更新操作很少出现性能问题，在生产环境中，我们遇到最多的，也是最容易出问题的，还是一些复杂的查询操作，因此对查询语句的优化显然是重中之重。说起加速查询，就不得不提到索引了。</li>
</ol>
</li>
<li><p>什么是索引？</p>
<ol>
<li>索引在MySQL中也叫是一种“键”，是存储引擎用于快速找到记录的一种数据结构。索引对于良好的性能<br> 非常关键，尤其是当表中的数据量越来越大时，索引对于性能的影响愈发重要。<br> 索引优化应该是对查询性能优化最有效的手段了。索引能够轻易将查询性能提高好几个数量级。<br> 索引相当于字典的音序表，如果要查某个字，如果不使用音序表，则需要从几百页中逐页去查。    </li>
</ol>
</li>
<li><p>索引的原理？</p>
<ol>
<li><p>索引的目的在于提高查询效率，与我们查阅图书所用的目录是一个道理：先定位到章，然后定位到该章下的一个小节，然后找到页数。相似的例子还有：查字典，查火车车次，飞机航班等</p>
<p> 本质都是：通过不断地缩小想要获取数据的范围来筛选出最终想要的结果，同时把随机的事件变成顺序的事件，也就是说，有了这种索引机制，我们可以总是用同一种查找方式来锁定数据。</p>
<p> 数据库也是一样，但显然要复杂的多，因为不仅面临着等值查询，还有范围查询(&gt;、&lt;、between、in)、模糊查询(like)、并集查询(or)等等。数据库应该选择怎么样的方式来应对所有的问题呢？我们回想字典的例子，能不能把数据分成段，然后分段查询呢？最简单的如果1000条数据，1到100分成第一段，101到200分成第二段，201到300分成第三段…这样查第250条数据，只要找第三段就可以了，一下子去除了90%的无效数据。但如果是1千万的记录呢，分成几段比较好？按照搜索树的模型，其平均复杂度是lgN，具有不错的查询性能。但这里我们忽略了一个关键的问题，复杂度模型是基于每次相同的操作成本来考虑的。而数据库实现比较复杂，一方面数据是保存在磁盘上的，另外一方面为了提高性能，每次又可以把部分数据读入内存来计算，因为我们知道访问磁盘的成本大概是访问内存的十万倍左右，所以简单的搜索树难以满足复杂的应用场景。</p>
</li>
</ol>
</li>
<li><p>索引的数据结构</p>
<ol>
<li><p>MySQL主要用到两种结构：B+ Tree索引和Hash索引<br> Inodb存储引擎 默认是 B+Tree索引</p>
<blockquote>
<p>B+树是一个平衡的多叉树，从根节点到每个叶子节点的高度差值不超过1，而且同层级的二节点间有指针相关连接，在B+树上的常规检索，从根节点到叶子节点的搜索效率基本相当，不会出现大幅波动，而且基于索引的顺序扫描时，也可以利用双向指针快速左右移动，效率非常高。因为，B+树索引被广泛应用于数据库、文件系统等场景。</p>
</blockquote>
</li>
<li><p>Memory 存储引擎 默认 Hash索引；</p>
<blockquote>
<p>哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可立刻定位到相应的位置，速度非常快。</p>
</blockquote>
</li>
<li><p>MySQL中，只有Memory(Memory表只存在内存中，断电会消失，适用于临时表)存储引擎显示支持Hash索引，是Memory表的默认索引类型，尽管Memory表也可以使用B+Tree索引。Hash索引把数据以hash形式组织起来，因此当查找某一条记录的时候，速度非常快。但是因为hash结构，每个键只对应一个值，而且是散列的方式分布。所以它并不支持范围查找和排序等功能。<br> B+Tree是mysql使用最频繁的一个索引数据结构，是InnoDB和MyISAM存储引擎模式的索引类型。相对Hash索引，B+Tree在查找单条记录的速度比不上Hash索引，但是因为更适合排序等操作，所以它更受欢迎。毕竟不可能只对数据库进行单条记录的操作。<br> 对比：<br> hash类型的索引：查询单条快，范围查询慢<br> btree类型的索引：b+树，层数越多，数据量指数级增长（我们就用它，因为innodb默认支持它）</p>
<blockquote>
<p>如果是等值查询，那么哈希索引明显有绝对优势，因为只需要经过一次算法即可找到相应的键值，前提是键值都是唯一的。如果键值不是唯一的，就需要先找到该键所在位置，然后再根据链表往后扫描，知道找到对应的数据</p>
<p>如果是范围查询检索，这时候哈徐索引就毫无用武之地了，因为原先是有序的键值，经过哈希算法后，有可能变成不连续的了，就没办法再利用索引完成范围查询检索</p>
<p>哈希所有也没办法利用索引完成排序，以及like这样的部分模糊查询</p>
<p>哈希索引也不支持多列联合索引的最左匹配规则</p>
<p>B+树索引的关键字检索效率比较平均，不像B树那样波动大，在有大量重复键值情况下，哈希索引的效率也是极低的，因此存在哈希碰撞问题。</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id="3-1-索引的设计原则有哪些？"><a href="#3-1-索引的设计原则有哪些？" class="headerlink" title="3.1 索引的设计原则有哪些？"></a>3.1 索引的设计原则有哪些？</h3><blockquote>
<p>在进行索引设计的时候，应该保证索引字段占用的空间越小越好，这只是一个大的方向，还有一些细节点需要注意下：</p>
</blockquote>
<ul>
<li>原则<ol>
<li>适合索引的列是出现在where字句中的列，或者连接子句中指定的列</li>
<li>基数较小的表，索引效果差，没必要创建索引</li>
<li>在选择索引列的时候，越短越好，可以指定某些列的一部分，没必要用全部字段的值</li>
<li>不要给表中的每一个字段都创建索引，并不是索引越多越好</li>
<li>定义有外键的数据列一定要创建索引</li>
<li>更新频繁的字段不要有索引</li>
<li>创建索引的列不要过多，可以创建组合索引，但是组合索引的列的个数不建议太多</li>
<li>大文本、大对象不要创建索引</li>
</ol>
</li>
</ul>
<h3 id="3-1-mysql调优的原理"><a href="#3-1-mysql调优的原理" class="headerlink" title="3.1 mysql调优的原理"></a>3.1 mysql调优的原理</h3><blockquote>
<p>(mysql innodb索引是B+树数据结构，调优即调数据结构中最大化利用存储空间的方式）</p>
<ol>
<li>磁盘块：<a target="_blank" rel="noopener" href="https://blog.csdn.net/SweeNeil/article/details/88743164">https://blog.csdn.net/SweeNeil/article/details/88743164</a><br> 磁盘块：操作系统最小的逻辑存储单位，默认为4（可新建文本，随便输入个数字保存，查看txt文件的大小，常为4kb），由于内存与磁盘交互的最小逻辑单元称为页page_size且mysql中page_size为16KB，因此，磁盘块的大小：块=扇区×2^n的n就为2，故磁盘块大小为4<em>2^2=16KB，故在io层上的读取磁盘数据以16KB为单位，不管满没满参数：page_size,在innodb中默认为16KB(在mysql中使用命令 [show variables like ‘innodb_page_size’])；<br> 类二叉树结构，层级越多，io层数越多，由于每个节点占用一个磁盘块，由于读取页的整数倍4</em>4=16kb，每个的磁盘块大小为16kb(page_size)，只要有data，就会占据16kb。即每层读取需要16kb的代价，消耗的即是电脑RAM内存，<u>即IO层越多，查询的内存代价越大，故需要优化数据结构</u>；<br> 根据Max.Degree来确定每个磁盘块放data的最大个数；<br> 即data大小=16/Max.Degree<br> 而指针+key大小为10字节；<br> 导致读一个磁盘块能读16KB*1024/10=1600个指针+key的数据对象；<br> 因此，在二叉树中能读的数据对象个数与key的大小有关，即与key的数据类型有关，即与mysql优化有关；<br> 而B数和B+数的选用理由在于B+数能够在一个磁盘块存储更多的数据，以三层而言；<br> 数中存指针(固定)、key(看数据类型知大小)，data(数据最大)，由于限定为B树三层，要想存储更多的数据，除了最底层，上层都存放非数据即指针和key来达到最大乘积值，最底层存放数据，而B+数正是此种结构，<u>且人为调优的方式就只有key的数据类型</u>；</li>
</ol>
<ol start="2">
<li>满足业务系统下尽量自增，这样不会出现打乱数据结构层数的情况，如11 12 13 15塞满一个磁盘块，若非自增，插入一个14则导致该磁盘块要拆分成两个磁盘块，14才能有位置插入进来，也导致父级磁盘块需要一个指针，若也满也需拆分，依次类推父父级。这样多次拆分极大影响效率(重新创建索引)，故建议自增；</li>
<li>数据迁移时需要关闭生成索引；</li>
</ol>
</blockquote>
<p><img src="D:/App/Typora/TyporaSource/Private/Java基础/B+树.png"></p>
<h3 id="3-2-mysql聚簇和非聚簇索引的区别？"><a href="#3-2-mysql聚簇和非聚簇索引的区别？" class="headerlink" title="3.2 mysql聚簇和非聚簇索引的区别？"></a>3.2 mysql聚簇和非聚簇索引的区别？</h3><ul>
<li><p>区别</p>
<ol>
<li>聚簇索引：数据跟索引绑定存储在一起的叫聚簇索引；</li>
<li>非聚簇索引：数据跟索引分开存储的叫做非聚簇索引；</li>
</ol>
</li>
<li><p>数据文件</p>
<ol>
<li>innodb：使用聚簇索引、非聚簇索引；</li>
<li>myisam：使用非聚簇索引；</li>
</ol>
</li>
<li><p>数据文件存储格式</p>
<ol>
<li>innodb<ul>
<li>*.frm：表结构</li>
<li>*.idb：数据文件和索引文件(索引每次重构索引相当于重构该文件)</li>
</ul>
</li>
<li>myisam</li>
</ol>
<pre><code>- *.frm：表结构
- *.MYD(data)：数据文件
- *.MYI(index)：索引文件
</code></pre>
</li>
<li><p>存储引擎(动词)</p>
</li>
</ul>
<blockquote>
<p>不同的数据文件（innodb/myisam）在磁盘的不同组织形式（* .frm、* .idb/* .frm、* .MYD、* .MYI）<br>拓展：索引的选择性问题(boolean类型不适合作为索引)，涉及hyperloglog 基数计算用于判断是否建索引； </p>
</blockquote>
<ul>
<li><p>索引6种类型</p>
<ol>
<li><p>增</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 建表时建索引</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span>（<span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> <span class="token punctuation">[</span>数据类型<span class="token punctuation">]</span> <span class="token punctuation">[</span>约束<span class="token punctuation">]</span>，<span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> <span class="token punctuation">[</span>数据类型<span class="token punctuation">]</span> <span class="token punctuation">[</span>约束<span class="token punctuation">]</span>，<span class="token keyword">index</span> <span class="token punctuation">[</span>索引名<span class="token punctuation">]</span>（<span class="token punctuation">[</span>字段名<span class="token punctuation">]</span>）<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>删</p>
 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 删除方法一</span>
<span class="token keyword">drop</span> <span class="token keyword">index</span> <span class="token punctuation">[</span>索引名<span class="token punctuation">]</span> <span class="token keyword">on</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span>；
<span class="token comment"># 删除方法二</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">drop</span> <span class="token keyword">index</span> <span class="token punctuation">[</span>索引名<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>改（6种索引类型）</p>
</li>
</ol>
<pre><code><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">add</span> <span class="token keyword">index</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>索引名<span class="token punctuation">]</span><span class="token punctuation">)</span>；

<span class="token comment"># 1.添加PRIMARY KEY（主键索引）：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token punctuation">`</span><span class="token keyword">column</span><span class="token punctuation">`</span> <span class="token punctuation">)</span> 

<span class="token comment"># 2.添加UNIQUE(唯一索引) ：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token punctuation">(</span> <span class="token punctuation">`</span><span class="token keyword">column</span><span class="token punctuation">`</span> <span class="token punctuation">)</span> 
 
<span class="token comment"># 3.添加INDEX(普通索引) ：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span> <span class="token punctuation">`</span><span class="token keyword">column</span><span class="token punctuation">`</span> <span class="token punctuation">)</span>

<span class="token comment"># 4.添加FULLTEXT(全文索引) ：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span> <span class="token keyword">ADD</span> FULLTEXT <span class="token punctuation">(</span> <span class="token punctuation">`</span><span class="token keyword">column</span><span class="token punctuation">`</span><span class="token punctuation">)</span> 
 
<span class="token comment"># 5.添加多列索引(组合索引)：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>table_name<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span> <span class="token punctuation">`</span>column1<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>column2<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>column3<span class="token punctuation">`</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
<ol start="4">
<li>查</li>
</ol>
<pre><code><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 展现表中所有的索引</span>
<span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span>
<span class="token comment"># 解释表中是否使用索引ref</span>
<span class="token keyword">explain</span> <span class="token operator">+</span> <span class="token keyword">sql</span>语句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
</li>
</ul>
<h3 id="3-3-mysql索引常规问题"><a href="#3-3-mysql索引常规问题" class="headerlink" title="3.3 mysql索引常规问题?"></a>3.3 mysql索引常规问题?</h3><ul>
<li><p>索引并不是越多越好</p>
<ol>
<li>索引的维护十分麻烦，参考 ‘’拆分’’ 的原因；</li>
<li>占用的存储空间变大，会导致io增多</li>
</ol>
</li>
<li><p>索引与表的关系</p>
<ol>
<li><p>一个表可以创建多个索引，但不要&gt;5个；</p>
</li>
<li><p>一个索引是一颗B+树，多个索引则多个；</p>
</li>
<li><p>若多颗B+树，相同数据还是仅存一份，其他索引的叶子节点一般下存放主键</p>
<blockquote>
<p>innodb存储引擎在进行数据插入的时候，数据必须要跟索引放在一起，如果有主键就使用主键，没有主键就使用唯一键，没有唯一键就使用6字节的rowid，此为聚簇索引的原理</p>
</blockquote>
</li>
</ol>
</li>
<li><p>回表(涉及select * 时会产生回表)</p>
<ol>
<li><p>已知</p>
<ul>
<li><p>字段名：id、name、age、gender、id主键、name普通索引；</p>
<ol>
<li><p>回表过程</p>
<ul>
<li><p>sql语句：</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'zhangsan'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>执行过程<br> 先根据name到nameB+树找到对应叶子节点的id值；再根据id到idB+树读取整行记录，这种查询方式叫做回表，不推荐使用，效率降低</li>
</ol>
</li>
</ul>
</li>
<li><p>索引覆盖过程</p>
<ul>
<li><p>sql语句：</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id<span class="token punctuation">,</span>name <span class="token keyword">from</span> <span class="token keyword">table</span> <span class="token keyword">where</span> name<span class="token operator">=</span>'zhangsan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>执行过程：<br> 根据name的值到nameB+树中获取对应的叶子节点中的数据，叶子节点中包含了全部要查询的字段，此时叫做索引覆盖，<br> 可通过explain查执行过程，若extra字段：useing index =&gt; 100%无回表；<br> (nameB+数中叶子节点单一数据data默认存储主键即id，故此处恰巧不走回表，若为select age，name，则走回表)</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
<li><p>字段名：id、name、age、gender、id主键、age，name普通索引；</p>
<ol>
<li><p>解决叶子节点单一数据问题</p>
<ul>
<li><p>最左匹配：创建组合索引（age，name普通索引），</p>
<blockquote>
<p>select * from table where name=? and age=?      可用组合索引<br>select * from table where name=?                        无<br>select * from table where age=?                           无<br>select * from table where age=? and name=?      通过mysql的优化器可用组合索引</p>
</blockquote>
</li>
<li><p>拓展：Mysql结构</p>
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Mysql结构.png" style="zoom: 80%;" /></li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="3-4-mysql在海量数据下的情况处理"><a href="#3-4-mysql在海量数据下的情况处理" class="headerlink" title="3.4 mysql在海量数据下的情况处理"></a>3.4 mysql在海量数据下的情况处理</h3><ul>
<li><p>数据库与数据仓库的区别？</p>
<ol>
<li>OLAP(OnlineAnalysisProcess)<br> 联机分析处理——&gt;数据仓库——&gt;hive——&gt;对历史数据做分析，产生决策性的影响，<u>用于大数据分析</u></li>
<li>OLTP(OnlineTransientProcess)<br> 联机事务处理——&gt;数据库——&gt;mysql、oracle、db2——&gt;支撑业务系统，在很短时间内返回结果；</li>
</ol>
</li>
<li><p>如何分布式集群？</p>
<ol>
<li><p>主从复制</p>
<blockquote>
<p>Mysql优化学习之MTS机制、组提交、GTID汇总分析 (5.7及之后新特性MTS)<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Qyehui/p/15212498.html">https://www.cnblogs.com/Qyehui/p/15212498.html</a></p>
</blockquote>
<ul>
<li><p>原理图<br>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Mysql主从原理.png"></p>
<blockquote>
<ol>
<li><p>master服务器将数据的改变记录二进制binlog日志，当master上的数据发生改变时，则将其改变写入二进制日志中；        </p>
</li>
<li><p>slave服务器会在一定时间间隔内对master二进制日志进行探测其是否发生改变，如果发生改变，则开始一个I/OThread请求master二进制事件</p>
</li>
<li><p>同时主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至从节点本地的中继日志中，从节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，使得其数据和主节点的保持一致，最后I/OThread和SQLThread将进入睡眠状态，等待下一次被唤醒。</p>
</li>
</ol>
<p>换言之：</p>
<ul>
<li>从库会生成两个线程,一个I/O线程,一个SQL线程;</li>
<li>I/O线程会去请求主库的binlog,并将得到的binlog写到本地的relay-log(中继日志)文件中;</li>
<li>主库会生成一个log dump线程,用来给从库I/O线程传binlog;</li>
<li>SQL线程,会读取relay log文件中的日志,并解析成sql语句逐一执行;</li>
</ul>
<p>注意：</p>
<p>1–master将操作语句记录到binlog日志中，然后授予slave远程连接的权限（master一定要开启binlog二进制日志功能；通常为了数据安全考虑，slave也开启binlog功能）。<br>2–slave开启两个线程：IO线程和SQL线程。其中：IO线程负责读取master的binlog内容到中继日志relay log里；SQL线程负责从relay log日志里读出binlog内容，并更新到slave的数据库里，这样就能保证slave数据和master数据保持一致了。<br>3–Mysql复制至少需要两个Mysql的服务，当然Mysql服务可以分布在不同的服务器上，也可以在一台服务器上启动多个服务。<br>4–Mysql复制最好确保master和slave服务器上的Mysql版本相同（如果不能满足版本一致，那么要保证master主节点的版本低于slave从节点的版本）<br>5–master和slave两节点间时间需同步</p>
</blockquote>
</li>
<li><p>步骤过程</p>
<ol>
<li>从库通过手工执行change  master to 语句连接主库，提供了连接的用户一切条件（user 、password、port、ip），并且让从库知道，二进制日志的起点位置（file名 position 号）；    start  slave</li>
<li>从库的IO线程和主库的dump线程建立连接。</li>
<li>从库根据change  master  to 语句提供的file名和position号，IO线程向主库发起binlog的请求。</li>
<li>主库dump线程根据从库的请求，将本地binlog以events的方式发给从库IO线程。</li>
<li>从库IO线程接收binlog  events，并存放到本地relay-log中，传送过来的信息，会记录到master.info中</li>
<li>从库SQL线程应用relay-log，并且把应用过的记录到relay-log.info中，默认情况下，已经应用过的relay 会自动被清理purge</li>
</ol>
</li>
</ul>
</li>
<li><p>读写分离</p>
<ul>
<li>主机一写、从机多读</li>
</ul>
</li>
<li><p>分库分表(推荐运用shardingsphere实现)</p>
<blockquote>
<p>ShardingSphere简介<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0238ff53c6bb">https://www.jianshu.com/p/0238ff53c6bb</a></p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id="3-5-如何保证不同事务的一致性？"><a href="#3-5-如何保证不同事务的一致性？" class="headerlink" title="3.5 如何保证不同事务的一致性？"></a>3.5 如何保证不同事务的一致性？</h3><blockquote>
<p>事务的ACID（atomicity、consistency、isolation、durability）原则<br>mysql日志：binlog(归属mysql server层)、redo log(归属mysql innodb层)、undo log(归属mysql innodb层) 区别与作用<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wq-blogs/p/11867199.html">https://www.cnblogs.com/wq-blogs/p/11867199.html</a></p>
</blockquote>
<ul>
<li><p>原子性(atomicity)</p>
<ol>
<li><p>定义</p>
<ul>
<li>要么全部成功，要么全部失败</li>
</ul>
</li>
<li><p>原理</p>
<ul>
<li><p>通过undolog回滚日志实现的回滚的</p>
<blockquote>
<p>undolog回滚日志即微观上是记录操作相反的sql语句（宏观上是记录之前数据的历史版本），若我insert ，则undolog记录delete 操作；</p>
</blockquote>
</li>
</ul>
</li>
</ol>
</li>
<li><p>持久性(durability)</p>
<ol>
<li><p>定义</p>
<ul>
<li>事务被提交，它对数据库中数据的改变就是永久性的</li>
</ul>
</li>
<li><p>原理</p>
<ul>
<li><p>通过redolog重做日志的二阶段提交实现绝对性的持久化</p>
<blockquote>
<p>二阶段提交的作用原理：进入prepared后，无论有无写binlog断电，再redolog中检查到prepared会检查binlog有无写入，无则恢复原先状态(取出无效prepared代码)，有则改为commit状态，完成事物；</p>
<p><img src="D:/App/Typora/TyporaSource/Private/Java基础/Mysql数据更新原理.png"></p>
<p><img src="D:/App/Typora/TyporaSource/Private/Java基础/Mysql的redolog二阶段提交.png"></p>
</blockquote>
</li>
</ul>
</li>
</ol>
</li>
<li><p>隔离性(isolation)</p>
<ol>
<li><p>四个隔离级别</p>
<blockquote>
<p>隔离级别越高，效率越低</p>
</blockquote>
<ul>
<li><p>读未提交（READ UNCOMMITTED）</p>
<blockquote>
<p>在这个隔离级别，所有事务都可以“看到”未提交事务的执行结果。在这种级别上，可能会产生很多问题，除非用户真的知道自己在做什么，并有很好的理由选择这样做。本隔离级别很少用于实际应用，因为它的性能也不必其他性能好多少，而别的级别还有其他更多的优点。读取未提交数据，也被称为“脏读”</p>
</blockquote>
</li>
<li><p>读已提交RC（READ COMMITTED ）</p>
<blockquote>
<p>大多数数据库系统的默认隔离级别（但是不是MySQL的默认隔离级别），满足了隔离的早先简单定义：一个事务开始时，只能“看见”已经提交事务所做的改变，一个事务从开始到提交前，所做的任何数据改变都是不可见的，除非已经提交。这种隔离级别也支持所谓的“不可重复读”。这意味着用户运行同一个语句两次，看到的结果是不同的。</p>
</blockquote>
</li>
<li><p>可重复读RR（REPEATABLE READ）</p>
<blockquote>
<p>MySQL数据库默认的隔离级别。该级别解决了READ UNCOMMITTED隔离级别导致的问题。它保证同一事务的多个实例在并发读取事务时，会“看到同样的”数据行。不过，这会导致另外一个棘手问题“幻读”。InnoDB和Falcon存储引擎通过多版本并发控制机制解决了幻读问题。</p>
</blockquote>
</li>
<li><p>串行化（SERIALIZABLE ）</p>
<blockquote>
<p>该级别是最高级别的隔离级。它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简而言之，SERIALIZABLE是在每个读的数据行上加锁。在这个级别，可能导致大量的超时Timeout和锁竞争Lock Contention现象，实际应用中很少使用到这个级别，但如果用户的应用为了数据的稳定性，需要强制减少并发的话，也可以选择这种隔离级。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>隔离产生的问题</p>
<ul>
<li><p>脏读</p>
<blockquote>
<p>脏读是指一个事务读取了未提交事务执行过程中的数据。<br>当一个事务的操作正在多次修改数据，而在事务还未提交的时候，另外一个并发事务来读取了数据，就会导致读取到的数据并非是最终持久化之后的数据，这个数据就是脏读的数据。</p>
</blockquote>
</li>
<li><p>不可重复读</p>
<blockquote>
<p>不可重复读是指对于数据库中的某个数据，一个事务执行过程中多次查询返回不同查询结果，这就是在事务执行过程中，数据被其他事务提交修改了。<br>不可重复读同脏读的区别在于，脏读是一个事务读取了另一未完成的事务执行过程中的数据，而不可重复读是一个事务执行过程中，另一事务提交并修改了当前事务正在读取的数据。</p>
</blockquote>
</li>
<li><p>虚读(幻读)</p>
<blockquote>
<p>幻读是事务非独立执行时发生的一种现象，例如事务T1批量对一个表中某一列列值为1的数据修改为2的变更，但是在这时，事务T2对这张表插入了一条列值为1的数据，并完成提交。此时，如果事务T1查看刚刚完成操作的数据，发现还有一条列值为1的数据没有进行修改，而这条数据其实是T2刚刚提交插入的，这就是幻读。<br>幻读和不可重复读都是读取了另一条已经提交的事务（这点同脏读不同），所不同的是不可重复读查询的都是同一个数据项，而幻读针对的是一批数据整体（比如数据的个数）。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>数据库并发场景</p>
<ul>
<li>读读：不会存在任何问题的，也不需要并发控制</li>
<li>读写：会有线程安全问题，需要进行并发控制（锁）MVCC</li>
<li>写写：会有线程安全问题，更新丢失问题</li>
</ul>
</li>
<li><p>MVCC(Mutil-Version Concurrency Control 多版本并发控制的方法)</p>
<ul>
<li><p>定义</p>
<ol>
<li>MVCC多版本并发控制指的是维持一个数据的多个版本，使得读写操作没有冲突，快照读是mysql为了实现MVCC的一个非阻塞功能</li>
</ol>
</li>
<li><p>作用</p>
<ol>
<li>解决并发数据读写问题<br> (在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写的性能)</li>
<li>解决脏读、幻读、不可重复读等事务隔离问题，但是不能解决更新丢失问题</li>
</ol>
</li>
<li><p>前提</p>
<ol>
<li><p>快照读：读取的是mysql对应数据的历史版本（即不取并发事务中修改的操作后的最新数据结果）</p>
<ul>
<li>select (单纯执行select产生快照读，下面同理)</li>
</ul>
</li>
<li><p>当前读：读取的最新的数据结果</p>
<ul>
<li>select lock in share mode</li>
<li>select for update</li>
<li>insert \delete\update</li>
</ul>
</li>
<li><p>数据的历史版本</p>
<blockquote>
<p>由于undolog是记录之前数据的历史版本，undolog不会无限膨胀下去，会存在一个后台线程，purge线程，当发现当前记录不需要回|undolog不会无限膨胀下去，会存在一个后台线程，purge线程，当发现当前记录不需要回滚且不需要参与MVCC的时候，就会把数据给清理掉不需要参与MVCC的时候，就会把数据给清理掉</p>
</blockquote>
</li>
</ol>
</li>
<li><p>实现原理</p>
<blockquote>
<p>mvcc的实现原理主要依赖于记录中的三个隐藏字段，undolog，read view来实现的。</p>
</blockquote>
<ol>
<li><p>隐藏字段</p>
<table>
<thead>
<tr>
<th>DB_TRX_ID</th>
<th>最近修改事务id，记录创建当前记录或者最后一个修改的事务id</th>
</tr>
</thead>
<tbody><tr>
<td><strong>DB ROLL PTR</strong></td>
<td><strong>回滚指针，指向这条记录的上一个版本</strong></td>
</tr>
<tr>
<td><strong>DB ROW ID</strong></td>
<td><strong>隐藏主键(平时默认绑定主键id，隐藏了实际作用的主键字段名)</strong></td>
</tr>
</tbody></table>
<p> 实际表中的字段名应如下：</p>
<table>
<thead>
<tr>
<th>name</th>
<th>age</th>
<th>gender</th>
<th>DB_TRX_ID</th>
<th>DB ROLL PTR</th>
<th>DB ROW ID</th>
</tr>
</thead>
<tbody><tr>
<td>zhangsan</td>
<td>23</td>
<td>man</td>
<td>1</td>
<td>0x123</td>
<td>1</td>
</tr>
</tbody></table>
</li>
<li><p>ReadView(读视图)</p>
<ul>
<li><p>定义</p>
<p>  当事务在进行快照读的时候，会生成一个<u>读视图</u>来进行可见性判断，可见性判断是由<u>可见性算法</u>来确定的</p>
<ol>
<li><p>读视图：是一种虚拟的表，本质还是表，此处读视图如下；</p>
<table>
<thead>
<tr>
<th>trx_list</th>
<th>当前系统活跃的事务id</th>
</tr>
</thead>
<tbody><tr>
<td><strong>up_limit_id</strong></td>
<td><strong>活跃事务列表中最小的id值</strong></td>
</tr>
<tr>
<td><strong>low_limit_id</strong></td>
<td><strong>当前系统尚未分配的下一个事务id</strong></td>
</tr>
</tbody></table>
</li>
<li><p>可见性算法：</p>
<blockquote>
<p>无论隔离级别是RC(常理可以)还是RR(常理不行)，都能通过可见性算法得出一样的结果</p>
</blockquote>
<p> <img src="D:/App/Typora/TyporaSource/Private/Java基础/ReadView可见性算法.png"></p>
</li>
<li><p>ReadView结论</p>
<ul>
<li><p><strong>能否看到修改的数据，取决于可见性算法，可见性算法比较的时候取决于readview中的结果值；</strong></p>
</li>
<li><p><strong>因为在不同的隔离级别的时候，生成readview的时机是不同的RC</strong>：每次执行快照读都会生成新的readview RR：只有在当前事务第一次进行快照读的时候生成readview，之后的快照读操作会都用当前的readview</p>
<p>  (不同隔离级别的作用在于生成readview的时机是不同的)</p>
</li>
</ul>
</li>
<li><p>举例(RR隔离)</p>
<ul>
<li><p>例1</p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>并发事务1</th>
<th>并发事务2</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>begin</td>
<td>begin</td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>update<br />commit</td>
</tr>
<tr>
<td>3</td>
<td>select</td>
<td></td>
</tr>
</tbody></table>
<p>  问：执行select的时候是否能读取到修改的数据？</p>
<p>  答：可以。下图为读视图，根据读视图即可见性算法判断可知结果，<br>  直接到第三步都不满足，故修改的结果是看得见的。</p>
<table>
<thead>
<tr>
<th>trx_list</th>
<th>事务1</th>
</tr>
</thead>
<tbody><tr>
<td>up_limit_id</td>
<td>事务1</td>
</tr>
<tr>
<td>low_limit_id</td>
<td>事务3</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>DB_TRX_ID</th>
<th>事务2</th>
</tr>
</thead>
</table>
</li>
<li><p>例2</p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>并发事务1</th>
<th>并发事务2</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>begin</td>
<td>begin</td>
</tr>
<tr>
<td>2</td>
<td>select</td>
<td>select</td>
</tr>
<tr>
<td>3</td>
<td></td>
<td>update<br />commit</td>
</tr>
<tr>
<td>4</td>
<td>select</td>
<td></td>
</tr>
</tbody></table>
<p>  问：执行select(时刻4)的时候是否能读取到修改的数据？</p>
<p>  答：不可以。下图两ReadView不同，导致可见性算法结果不同，即得到不同的并发结果。<br>  时刻2的ReadView：</p>
<table>
<thead>
<tr>
<th>trx_list</th>
<th>事务1、事务2</th>
</tr>
</thead>
<tbody><tr>
<td>up_limit_id</td>
<td>事务1</td>
</tr>
<tr>
<td>low_limit_id</td>
<td>事务3</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>DB_TRX_ID</th>
<th>事务0<br />(无修改)</th>
</tr>
</thead>
</table>
<p>  时刻4的ReadView：<br>  (此时由于是RR级别，导致第二次快照读是不会生成新的ReadView，<strong>会沿用之前的ReadView，导致得不到最新的修改结果</strong>，<strong>若能生成新的ReadView，则能得到最新的修改的结果，本质上是作用对象不同</strong>)</p>
<table>
<thead>
<tr>
<th>trx_list</th>
<th>事务1、事务2</th>
</tr>
</thead>
<tbody><tr>
<td>up_limit_id</td>
<td>事务1</td>
</tr>
<tr>
<td>low_limit_id</td>
<td>事务3</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>DB_TRX_ID</th>
<th>事务2<br />(update修改)</th>
</tr>
</thead>
</table>
</li>
</ul>
</li>
<li><p>如何解决幻读问题？</p>
<ul>
<li><p>如果当前的所有操作都是当前读，那么是不会产生幻读问题，只有当前读换照读一起使用的时候才会产生幻读问题</p>
<ol>
<li><p>解决办法：可上锁，select for update 阻塞对该版本数据进行修改。间接禁止了沿用之前的ReadView，即不会出现幻读问题；</p>
<blockquote>
<p>select for update <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42956376/article/details/109544539">https://blog.csdn.net/qq_42956376/article/details/109544539</a></p>
</blockquote>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
</li>
<li><p>一致性</p>
<p>  1.一致性是由原子性、持久性、隔离性保证的</p>
</li>
</ul>
<h3 id="3-6-Mysql锁和Java锁是不同的机制"><a href="#3-6-Mysql锁和Java锁是不同的机制" class="headerlink" title="3.6 Mysql锁和Java锁是不同的机制"></a>3.6 Mysql锁和Java锁是不同的机制</h3><blockquote>
<p>Mysql的锁 <a target="_blank" rel="noopener" href="https://blog.csdn.net/mysteryhaohao/article/details/51669741">https://blog.csdn.net/mysteryhaohao/article/details/51669741</a><br>Java的锁 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/lxmyhappy/p/7380073.html">https://www.cnblogs.com/lxmyhappy/p/7380073.html</a></p>
</blockquote>
<ul>
<li><p>分类方式</p>
<ol>
<li><p>基于锁的属性分类：共享锁、排他锁。</p>
<blockquote>
<p>共享锁，互斥锁的区别：以java为例，<a target="_blank" rel="noopener" href="https://blog.csdn.net/fhb1922702569/article/details/77506491">读写锁</a>。</p>
<ul>
<li>读锁是共享锁，锁的是读操作与写操作不能兼并，但读读并发仍可以获得锁，与不加锁读读时情况一致，<br>  （无写时等同不加锁），即多个线程可以同时占用</li>
<li>写锁是互斥锁，锁的是写与读，写与写，相当于锁的是自身和其他操作。故互斥其他任何操作。<br>  即一次只能一个线程占用</li>
</ul>
</blockquote>
</li>
<li><p>基于锁的粒度分类：行级锁（innodb ）、表级锁（ innodb 、myisam）、页级锁（ innodb引擎）、记录锁、间隙锁、临键锁。</p>
</li>
<li><p>基于锁的状态分类：意向共享锁、意向排它锁。 </p>
</li>
</ol>
</li>
<li><p>定义</p>
<ol>
<li>共享锁（share lock）： 共享锁又称读锁，简称 S 锁；当一个事务为数据加上读锁之后，其他事务只能对该数据加读锁，而不能对数据加写锁，直到所有的读锁释放之后其他事务才能对其进行加持写锁。共享锁的特性主要是为了支持并发的读取数据，读取数据的时候不支持修改，避免出现重复读的问题。</li>
<li>排他锁（exclusive lock）：排他锁又称写锁，简称 X 锁；当一个事务为数据加上写锁时，其他请求将不能再为数据加任何锁，直到该锁释放之后，其他事务才能对数据进行加锁。排他锁的目的是在数据修改时候，不允许其他人同时修改，也不允许其他人读取，避免了出现脏数据和脏读的问题。</li>
<li>表锁（table lock）：表锁是指上锁的时候锁住的是整个表，当下一个事务访问该表的时候，必须等前一个事务释放了锁才能进行对表进行访问；特点：粒度大，加锁简单，容易冲突；</li>
<li>行锁：行锁是指上锁的时候锁住的是表的某一行或多行记录，其他事务访问同一张表时，只有被锁住的记录不能访问，其他的记录可正常访问，特点：粒度小，加锁比表锁麻烦，不容易冲突，相比表锁支持的并发要高</li>
<li>记录锁（Record lock）:记录锁也属于行锁中的一种，只不过记录锁的范围只是表中的某一条记录，记录锁是说事务在加锁后锁住的只是表的某一条记录，加了记录锁之后数据可以避免数据在查询的时候被修改的重复读问题，也避免了在修改的事务未提交前被其他事务读取的脏读问题</li>
<li>页锁：页级锁是 MysQL 中锁定粒度介于行级锁和表级锁中间的一种锁．表级锁速度快，但冲突多，行级冲突少，但速度慢。所以取了折衷的页级，一次锁定相邻的一组记录。特点：开销和加锁时间界于表锁和行锁之间，会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。</li>
<li>间隙锁：是属于行锁的一种，间隙锁是在事务加锁后其锁住的是表记录的某一个区间，当表的相邻ID之间出现空隙则会形成一个区间，遵循左开右闭原则。范围查询并且查询未命中记录，查询条件必须命中索引、间隙锁只会出现在REPEATABLE_READ（重复读）的事务级别中。</li>
<li>临键锁（Next-Key lock)：也属于行锁的一种，并且它是INNODB的行锁默认算法，总结来说它就是记录锁和间隙锁的组合，临键锁会把查询出来的记录锁住，同时也会把该范围查询内的所有间隙空间也会锁住，再之它会把相邻的下一个区间也会锁住。</li>
</ol>
</li>
</ul>
<h2 id="4-计算机网络基础"><a href="#4-计算机网络基础" class="headerlink" title="4. 计算机网络基础"></a>4. 计算机网络基础</h2><blockquote>
<ul>
<li>TCP/IP、 高并发负载均衡、集群</li>
<li>IO模型、内核给程序暴露api源自 socket</li>
<li>分布式、微服务、服务网格、大数据、云计算</li>
</ul>
</blockquote>
<h3 id="4-1-TCP-IP五层模式"><a href="#4-1-TCP-IP五层模式" class="headerlink" title="4.1 TCP/IP五层模式"></a>4.1 TCP/IP五层模式</h3><ul>
<li><p>应用层：详细健ediary的信息，再整理到此处；</p>
<ol>
<li><p>Http协议：http协议是面向传输协议</p>
<blockquote>
<p>GET / HTTP/1.0：<br>Get是HTTP的请求方法；/ 是指定以URL的形式连接；Http/1.0是指http协议的版本</p>
</blockquote>
</li>
</ol>
</li>
<li><p>传输控制层</p>
<ol>
<li><p>TCP</p>
<blockquote>
<p>面向<strong>连接</strong>的，<strong>可靠</strong>的。连接在三次握手，四次分手，是指名道姓的连接；可靠在连接中的各种优化机制，尤其是传输数据的ACK机制 <a target="_blank" rel="noopener" href="https://www.pianshen.com/article/87661372680/">https://www.pianshen.com/article/87661372680/</a><br>TCP整体评价 <a target="_blank" rel="noopener" href="https://blog.csdn.net/smilesundream/article/details/78060916">https://blog.csdn.net/smilesundream/article/details/78060916</a></p>
</blockquote>
<ul>
<li><p>定义</p>
<ol>
<li><p>TCP协议是面向通信协议，3次握手建立连接，传输数据，4次分手断开连接</p>
<blockquote>
<p>tcp3次握手后才建立连接(在本地内存里开辟以socket为特征的队列资源，资源又分发送队列和接受队列)，即socket只是对开辟的资源进行包装，并不是新东西<br><img src="D:/App/Typora/TyporaSource/Private/Java基础/Linux_netstat命令.png"></p>
<p>在linux系统中，通过该命令，可以查到如上多条传输控制层的通信协议连接信息，此处使用TCP协议，每个TCP连接都是一个socket资源(以socket为特征建立的资源)，即我们<strong>程序本质上是面向socket进行读写</strong>的。即程序与内存进行交互</p>
<ul>
<li><p>连接信息字段名</p>
<table>
<thead>
<tr>
<th>通信协议</th>
<th>接受队列(信息量)</th>
<th>发送队列(信息量)</th>
<th>本地域名地址(ip+端口)</th>
<th>远端域名地址(ip+端口)</th>
<th>状态</th>
<th>PID系统进程/系统名字；</th>
</tr>
</thead>
</table>
</li>
<li><p>socket是四元组</p>
<table>
<thead>
<tr>
<th>本地ip</th>
<th>本地端口</th>
<th>远端ip</th>
<th>远端端口</th>
</tr>
</thead>
</table>
<p>  也是’套’’接’字/插座插头，套/插头是本地ip+端口，接/插座是远端ip+端口，都具有绝对唯一的连接特性(不重复)</p>
<p>  建立一个socket就是建立一对唯一 本地域名地址(ip+端口)  远端域名地址(ip+端口) 的连接；查socket就可以在具有socket特征的信息中查出，如netstat -natp命令；</p>
<p>  同时服务端会默认占用一个80端口，用于将远端0.0.0.0：*(远端所有端口，通配的意思)的信息先转接到80端口；类似网关；</p>
<p>  其中TCP传输文件的最大单位可以在ifConfig命令查看网卡信息中的MTU的大小，1G大小的东西都会切分诸多碎片来传输；即内核通过网卡允许传输的最大容量MTU来传输数据；<br>  即程序面向内存传输时、内核面向数据包(通过网卡传输的封装包)时可能出现沾包粘包的现象，就是一个完整数据因大小被切割到多个数据包中的问题，拆包也同样是一个组装问题，即’’netty’’的沾包粘包与TCP没有关系；</p>
<p>  四次分手：客户端提出分手请求，服务端接受到客户端分手的请求，然后再问客户端现在是否分手(避免丢失仍在传输的数据)，客户端接受服务端的分手询问后会根据自身当前的情况，适时的发出第四次分手确认请求；此时才将以socket为特征的资源(内存)释放掉，才不会出错；<br>  若是三次连接后，因网络问题断开，双方是不知道的，但此时内核的keeplive心跳包机制就会来检测该四元组的连接是否网络断开，若真是断开则断开tcp连接；<br>  注意：在应用层的心跳检测是指表层的连接，即该四元组连接断开了，但是我可以尝试连接其他四元组来实现网络重连接，以达到原先的连接状态；</p>
</li>
<li><p>端口最大数为65535，但连接数不止65535<br>  连接的变数是四元，即可以通过增设本地ip，突破单机连接65535的上限；</p>
</li>
<li><p>IO模型<br>  程序和内核之间的通信就是IO阻塞或非阻塞来等待tcp建立连接，此为IO模型；</p>
</li>
</ul>
</blockquote>
</li>
</ol>
</li>
</ul>
</li>
<li><p>UDP</p>
</li>
</ol>
</li>
<li><p>网络层</p>
<ol>
<li>数据(tcp第一个握手的包–)，ip(网络接口分配的地址)和路由表(route)是确定通信对象(ip与子网掩码与运算确定是否下一跳到路由到交换机)<br> 网关：用于访问外网的下一跳，通过判断与运算判断是否为本地ip来是否执行下一跳</li>
</ol>
</li>
<li><p>链路层</p>
<ol>
<li>下一次只存放目标ip地址，但实际下一步的地址不知道，故引入mac地址。</li>
</ol>
</li>
<li><p>物理层</p>
<ol>
<li>拥有如上信息，将其封装成包，通过网卡(物理层)发送出去，回也是。最终三次握手则建立连接。</li>
</ol>
</li>
</ul>
<h2 id="5-JVM基础"><a href="#5-JVM基础" class="headerlink" title="5. JVM基础"></a>5. JVM基础</h2><h3 id="5-1-GC如何判断对象可以被回收？"><a href="#5-1-GC如何判断对象可以被回收？" class="headerlink" title="5.1 GC如何判断对象可以被回收？"></a>5.1 GC如何判断对象可以被回收？</h3><ul>
<li><p>引用计数法（已被淘汰的算法）</p>
<ol>
<li>每一个对象有一个引用属性，新增一个引用时加一，引用释放时减一，计数为0的时候可以回收。</li>
</ol>
<p>  但是这种计算方法，有一个致命的问题，无法解决循环引用的问题；</p>
</li>
<li><p>可达性分析算法（根引用）</p>
<ol>
<li>从GcRoot开始向下搜索，搜索所走过的路径被称为引用链，当一个对象到GcRoot没有任何引用链相连时，则证明此对象是不可用的，那么虚拟机就可以判定回收；</li>
<li>那么GcRoot有哪些？<ul>
<li>虚拟机栈中引用的对象</li>
<li>方法区中静态属性引用的对象。</li>
<li>方法区中常量引用的对象</li>
<li>本地方法栈中（即一般说的native方法）引用的对象</li>
</ul>
</li>
</ol>
</li>
<li><p>此外，不同的引用类型的回收机制是不一样的</p>
<ol>
<li>强引用：通过关键字new的对象就是强引用对象，强引用指向的对象任何时候都不会被回收，宁愿OOM也不会回收。</li>
<li>软引用：如果一个对象持有软引用，那么当JVM堆空间不足时，会被回收。一个类的软引用可以通过java.lang.ref.SoftReference持有。</li>
<li>弱引用：如果一个对象持有弱引用，那么在GC时，只要发现弱引用对象，就会被回收。一个类的弱引用可以通过java.lang.ref.WeakReference持有。</li>
<li>虚引用：几乎和没有一样，随时可以被回收。通过PhantomReference持有。</li>
</ol>
</li>
</ul>
<h3 id="5-2-JVM8为什么要增加元空间？"><a href="#5-2-JVM8为什么要增加元空间？" class="headerlink" title="5.2  JVM8为什么要增加元空间？"></a>5.2  JVM8为什么要增加元空间？</h3><ul>
<li>原因<ol>
<li>字符串存在永久代(jdk8之前)中，容易出现性能问题和内存溢出。</li>
<li>类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。</li>
<li>永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。</li>
</ol>
</li>
</ul>
<h3 id="5-3-JVM8中元空间有哪些特点？"><a href="#5-3-JVM8中元空间有哪些特点？" class="headerlink" title="5.3 JVM8中元空间有哪些特点？"></a>5.3 JVM8中元空间有哪些特点？</h3><ul>
<li>特点<ol>
<li>每个加载器有专门的存储空间。</li>
<li>不会单独回收某个类。</li>
<li>元空间里的对象的位置是固定的。</li>
<li>如果发现某个加载器不再存货了，会把相关的空间整个回收</li>
</ol>
</li>
</ul>
<h3 id="5-4-如何解决线上gc频繁的问题？"><a href="#5-4-如何解决线上gc频繁的问题？" class="headerlink" title="5.4 如何解决线上gc频繁的问题？"></a>5.4 如何解决线上gc频繁的问题？</h3><ul>
<li>方法<ol>
<li>查看监控，以了解出现问题的时间点以及当前FGC的频率（可对比正常情况看频率是否正常）</li>
<li>了解该时间点之前有没有程序上线、基础组件升级等情况。</li>
<li>了解JVM的参数设置，包括：堆空间各个区域的大小设置，新生代和老年代分别采用了哪些垃圾收集器，然后分析JVM参数设置是否合理。</li>
<li>再对步骤1中列出的可能原因做排除法，其中元空间被打满、内存泄漏、代码显式调用gc方法比较容易排查。</li>
<li>针对大对象或者长生命周期对象导致的FGC，可通过 jmap -histo 命令并结合dump堆内存文件作进一步分析，需要先定位到可疑对象。</li>
<li>通过可疑对象定位到具体代码再次分析，这时候要结合GC原理和JVM参数设置，弄清楚可疑对象是否满足了进入到老年代的条件才能下结论。</li>
</ol>
</li>
</ul>
<h3 id="5-5-JVM内存模型如何分配的？"><a href="#5-5-JVM内存模型如何分配的？" class="headerlink" title="5.5 JVM内存模型如何分配的？"></a>5.5 JVM内存模型如何分配的？</h3><ul>
<li>详细<br>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Java内存详细模型.png"></li>
</ul>
<h3 id="5-6-jvm有哪些垃圾回收器，实际中如何选择？"><a href="#5-6-jvm有哪些垃圾回收器，实际中如何选择？" class="headerlink" title="5.6 jvm有哪些垃圾回收器，实际中如何选择？"></a>5.6 jvm有哪些垃圾回收器，实际中如何选择？</h3><h3 id="5-7-synchronized和lock有哪些区别？"><a href="#5-7-synchronized和lock有哪些区别？" class="headerlink" title="5.7 synchronized和lock有哪些区别？"></a>5.7 synchronized和lock有哪些区别？</h3><table>
<thead>
<tr>
<th>区别类型</th>
<th>synchronized</th>
<th>Lock</th>
</tr>
</thead>
<tbody><tr>
<td>存在层次</td>
<td>Java的关键字，在jvm层面上</td>
<td>是JVM的一个接口</td>
</tr>
<tr>
<td>锁的获取</td>
<td>假设A线程获得锁，B线程等待。如果A线程阻塞，B线程会一直等待</td>
<td>情况而定，Lock有多个锁获取的方式，大致就是可以尝试获得锁，线程可以不用一直等待(可以通过tryLock判断有没有锁)</td>
</tr>
<tr>
<td>锁的释放</td>
<td>1、以获取锁的线程执行完同步代码，释放锁2、线程执行发生异常，jvm会让线程释放</td>
<td>在finally中必须释放锁，不然容易造成线程死锁</td>
</tr>
<tr>
<td>锁类型</td>
<td>锁可重入、不可中断、非公平</td>
<td>可重入、可判断 可公平（两者皆可）</td>
</tr>
<tr>
<td>性能</td>
<td>少量同步</td>
<td>适用于大量同步</td>
</tr>
<tr>
<td>支持锁的场景</td>
<td>1.  独占锁</td>
<td>1.  公平锁与非公平锁</td>
</tr>
</tbody></table>
<h3 id="5-8-ThreadLocal的原理是什么，使用场景有哪些？"><a href="#5-8-ThreadLocal的原理是什么，使用场景有哪些？" class="headerlink" title="5.8 ThreadLocal的原理是什么，使用场景有哪些？"></a>5.8 ThreadLocal的原理是什么，使用场景有哪些？</h3><ul>
<li><p>原理</p>
<ol>
<li><p>Thread类中有两个变量threadLocals和inheritableThreadLocals，二者都是ThreadLocal内部类ThreadLocalMap类型的变量，我们通过查看内部内ThreadLocalMap可以发现实际上它类似于一个HashMap。在默认情况下，每个线程中的这两个变量都为null:</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>只有当线程第一次调用ThreadLocal的set或者get方法的时候才会创建他们。</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ThreadLocalMap<span class="token punctuation">.</span>Entry</span> e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
                <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">&#125;</span>
    
<span class="token class-name">ThreadLocalMap</span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">.</span>threadLocals<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>除此之外，每个线程的本地变量不是存放在ThreadLocal实例中，而是放在调用线程的<strong>ThreadLocals</strong>变量里面。也就是说，<strong>ThreadLocal类型的本地变量是存放在具体的线程空间上</strong>，其本身相当于一个装载本地变量的载体，通过set方法将value添加到调用线程的threadLocals中，当调用线程调用get方法时候能够从它的threadLocals中取出变量。如果调用线程一直不终止，那么这个本地变量将会一直存放在他的threadLocals中，所以不使用本地变量的时候需要调用remove方法将threadLocals中删除不用的本地变量,防止出现内存泄漏。</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadLocalMap</span> map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token class-name">ThreadLocalMap</span> m <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>m <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
             m<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="5-9-ThreadLocal有哪些内存泄露问题，如何避免？"><a href="#5-9-ThreadLocal有哪些内存泄露问题，如何避免？" class="headerlink" title="5.9 ThreadLocal有哪些内存泄露问题，如何避免？"></a>5.9 ThreadLocal有哪些内存泄露问题，如何避免？</h3><ul>
<li><p>原理</p>
<ol>
<li>每个Thread都有一个ThreadLocal.ThreadLocalMap的map，该map的key为ThreadLocal实例，它为一个弱引用，我们知道弱引用有利于GC回收。当ThreadLocal的key == null时，GC就会回收这部分空间，但是value却不一定能够被回收，因为他还与Current Thread存在一个强引用关系，如下<br> <img src="D:/App/Typora/TyporaSource/Private/Java基础/Threadlocal.png"><br> 由于存在这个强引用关系，会导致value无法回收。如果这个线程对象不会销毁那么这个强引用关系则会一直存在，就会出现内存泄漏情况。</li>
<li>所以说只要这个线程对象能够及时被GC回收，就不会出现内存泄漏。如果碰到线程池，那就更坑了。 那么要怎么避免这个问题呢？ 在前面提过，在ThreadLocalMap中的setEntry()、getEntry()，如果遇到key == null的情况，会对value设置为null，当然我们也可以显示调用ThreadLocal的remove()方法进行处理。</li>
</ol>
</li>
<li><p>总结</p>
<ol>
<li>ThreadLocal 不是用于解决共享变量的问题的，也不是为了协调线程同步而存在，而是为了方便每个线程处理自己的状态而引入的一个机制。这点至关重要。</li>
<li>每个Thread内部都有一个ThreadLocal.ThreadLocalMap类型的成员变量，该成员变量用来存储实际的ThreadLocal变量副本。</li>
<li>ThreadLocal并不是为线程保存对象的副本，它仅仅只起到一个索引的作用。它的主要木得视为每一个线程隔离一个类的实例，这个实例的作用范围仅限于线程内部。</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="6-Spring基础"><a href="#6-Spring基础" class="headerlink" title="6. Spring基础"></a>6. Spring基础</h2><h3 id="1-1-说说你对Spring-的理解？"><a href="#1-1-说说你对Spring-的理解？" class="headerlink" title="1.1 说说你对Spring 的理解？"></a>1.1 说说你对Spring 的理解？</h3><blockquote>
<p>官网地址：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-framework#overview">https://spring.io/projects/spring-framework#overview</a></p>
<p>压缩包下载地址：<a target="_blank" rel="noopener" href="https://repo.spring.io/release/org/springframework/spring/">https://repo.spring.io/release/org/springframework/spring/</a></p>
<p>源码地址：<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework">https://github.com/spring-projects/spring-framework</a></p>
<details>
 <summary>简述</summary>
 <ol type="1">
 <li>Spring 使创建 Java 企业应用程序变得更加容易</li>
 <li>Spring 支持各种应用场景，解决不同场景环境运行应用程序的问题</li>
 <li>Spring 是开源的、拥有活跃的生态的</li>    
    </ol>
</details>
</blockquote>
<ul>
<li><p>你觉得Spring的核心是什么？</p>
<ol>
<li>spring是一个开源框架、是一个容器，也是一个生态，同时是整个生态里面的基石</li>
<li>spring是为了简化企业开发而生的，使得开发变得更加优雅和简洁。(解决了我们原神创建对象、销毁对象等繁杂操作)</li>
<li>spring是一个<strong>IOC</strong>和<strong>AOP</strong>的容器框架。<ul>
<li>IOC：控制反转；IOC是实现的思想，DI是具体的实现方式</li>
<li>AOP：面向切面编程，本质上是代理模式</li>
<li>容器：包含并管理应用对象的生命周期，就好比用桶装水一样，spring就是桶，而对象就是水</li>
</ul>
</li>
</ol>
</li>
<li><p>说一下使用spring的优势？</p>
<ol>
<li><p>Spring框架之外还存在一个构建在核心框架之上的庞大生态圈，它将Spring扩展到不同的领域，如Web服务、REST、移动开发以及NoSQL</p>
</li>
<li><p>低侵入式设计，代码的污染极低</p>
</li>
<li><p>独立于各种应用服务器，基于Spring框架的应用，可以真正实现Write Once,Run Anywhere的承诺</p>
</li>
<li><p>Spring通过DI、AOP和消除样板式代码来简化企业级Java开发</p>
<ul>
<li><p>Spring的IoC容器降低了业务对象替换的复杂性，提高了组件之间的解耦</p>
</li>
<li><p>Spring的AOP支持允许将一些通用任务如安全、事务、日志等进行集中式处理，从而提供了更好的复用</p>
</li>
</ul>
</li>
<li><p>Spring的ORM和DAO提供了与第三方持久层框架的的良好整合，并简化了底层的数据库访问</p>
</li>
<li><p>Spring的高度开放性，并不强制应用完全依赖于Spring，开发者可自由选用Spring框架的部分或全部</p>
</li>
</ol>
</li>
<li><p>Spring是如何简化开发的？</p>
<ol>
<li>基于POJO的轻量级和最小侵入性编程</li>
<li>通过依赖注入和面向接口实现松耦合</li>
<li>基于切面和惯例进行声明式编程</li>
<li>通过切面和模板减少样板式代码</li>
</ol>
</li>
</ul>
<h3 id="1-2-说说你对Aop的理解？"><a href="#1-2-说说你对Aop的理解？" class="headerlink" title="1.2 说说你对Aop的理解？"></a>1.2 说说你对Aop的理解？</h3><blockquote>
<p>AOP全称叫做 Aspect Oriented Programming  面向切面编程。它是为解耦而生的，解耦是程序员编码开发过程中一直追求的境界，AOP在业务类的隔离上，绝对是做到了解耦，在这里面有几个核心的概念：（建议看源码）</p>
</blockquote>
<ul>
<li><p>核心概念</p>
<ol>
<li><p>切面（Aspect）: 指关注点模块化，这个关注点可能会横切多个对象。事务管理是企业级Java应用中有关横切关注点的例子。 换言之，通过@Aspect注解在类上来设置切入方法时的切面</p>
</li>
<li><p>切点（Pointcut）: 匹配连接点的断言。通知和切点表达式相关联，并在满足这个切点的连接点上运行。换言之，通过@Pointcut(“@annotation(me.zhengjie.annotation.Log)”) 注解在空方法上来设置连接点，常与注解类搭配<br> （无方法体时主要为了让同类中其他方法使用此切入点）</p>
</li>
<li><p>连接点（Join point）: 在程序执行过程中某个特定的点，例如某个方法调用的时间点或者处理异常的时间点。在Spring AOP中，一个连接点总是代表一个方法的执行。如上的xx.annotation.Log。</p>
</li>
<li><p>通知（Advice）: 在切面的某个特定的连接点上执行的动作。通知有多种类型，包括“around”, “before” and “after”等等。通知的类型将在后面的章节进行讨论。 许多AOP框架，包括Spring在内，都是以拦截器做通知模型的，并维护着一个以连接点为中心的拦截器链。</p>
</li>
<li><p>引入（Introduction）: 声明额外的方法或者某个类型的字段。Spring允许引入新的接口（以及一个对应的实现）到任何被通知的对象上。例如，可以使用引入来使bean实现 <code>IsModified</code>接口， 以便简化缓存机制（在AspectJ社区，引入也被称为内部类型声明（inter））。</p>
</li>
<li><p>目标对象（Target object）: 被一个或者多个切面所通知的对象。也被称作被通知（advised）对象。既然Spring AOP是通过运行时代理实现的，那么这个对象永远是一个被代理（proxied）的对象。</p>
</li>
<li><p>AOP代理（AOP proxy）:AOP框架创建的对象，用来实现切面契约（aspect contract）（包括通知方法执行等功能）。在Spring中，AOP代理可以是JDK动态代理或CGLIB代理。</p>
</li>
<li><p>织入（Weaving）: 把切面连接到其它的应用程序类型或者对象上，并创建一个被被通知的对象的过程。这个过程可以在编译时（例如使用AspectJ编译器）、类加载时或运行时中完成。 Spring和其他纯Java AOP框架一样，是在运行时完成织入的。</p>
</li>
</ol>
</li>
<li><p>简述概念</p>
<ol>
<li>任何一个系统都是由不同的组件组成的，每个组件负责一块特定的功能，当然会存在很多组件是跟业务无关的，例如日志、事务、权限等核心服务组件，这些核心服务组件经常融入到具体的业务逻辑中，如果我们为每一个具体业务逻辑操作都添加这样的代码，很明显代码冗余太多，因此我们需要将这些公共的代码逻辑抽象出来变成一个切面，然后注入到目标对象（具体业务）中去，AOP正是基于这样的一个思路实现的，通过动态代理的方式，将需要注入切面的对象进行代理，在进行调用的时候，将公共的逻辑直接添加进去，而不需要修改原有业务的逻辑代码，只需要在原来的业务逻辑基础之上做一些增强功能即可。</li>
</ol>
</li>
</ul>
<h3 id="1-3-说说你对IOC的理解？"><a href="#1-3-说说你对IOC的理解？" class="headerlink" title="1.3 说说你对IOC的理解？"></a>1.3 说说你对IOC的理解？</h3><blockquote>
<p>原本我要对象是new出来，现在我要对象是和Spring容器要，容器给我对象；</p>
</blockquote>
<ul>
<li><p>简述概念</p>
<ol>
<li><p>谁控制谁：在之前的编码过程中，都是需要什么对象自己去创建什么对象，有程序员自己来控制对象，而有了IOC容器之后，就会变成由IOC容器来控制对象，</p>
</li>
<li><p>控制什么：在实现过程中所需要的对象及需要依赖的对象</p>
</li>
<li><p>什么是反转：在没有IOC容器之前我们都是先创建类后，在对象中主动去创建new依赖的对象，这是正转的，而有了IOC之后，依赖的对象直接由IOC容器创建后注入@AutoWired到对象中，由主动创建变成了被动接受，这是反转</p>
</li>
<li><p>哪些方面被反转：依赖的对象</p>
</li>
</ol>
</li>
</ul>
<h3 id="1-4-什么是bean的自动装配，它有哪些方式？"><a href="#1-4-什么是bean的自动装配，它有哪些方式？" class="headerlink" title="1.4 什么是bean的自动装配，它有哪些方式？"></a>1.4 什么是bean的自动装配，它有哪些方式？</h3><blockquote>
<p>bean的自动装配指的是bean的属性值在进行注入的时候通过某种特定的规则和方式去容器中查找，并设置到具体的对象属性中，主要有五种方式：</p>
</blockquote>
<ul>
<li>自动装配方法<ol>
<li>no – 缺省情况下，自动配置是通过“ref”属性手动设定，在项目中最常用</li>
<li>byName – 根据属性名称自动装配。如果一个bean的名称和其他bean属性的名称是一样的，将会自装配它。</li>
<li>byType – 按数据类型自动装配，如果bean的数据类型是用其它bean属性的数据类型，兼容并自动装配它。</li>
<li>constructor – 在构造函数参数的byType方式。</li>
<li>autodetect – 如果找到默认的构造函数，使用“自动装配用构造”; 否则，使用“按类型自动装配”。</li>
</ol>
</li>
</ul>
<h3 id="1-5-ACID是靠什么保证的？"><a href="#1-5-ACID是靠什么保证的？" class="headerlink" title="1.5 ACID是靠什么保证的？"></a>1.5 ACID是靠什么保证的？</h3><blockquote>
<p>Spring的ACID是还是基于数据库的来实现的，原理参照Mysql的ACID原则</p>
</blockquote>
<h3 id="1-6-BeanFactory和ApplicationContext有什么区别？"><a href="#1-6-BeanFactory和ApplicationContext有什么区别？" class="headerlink" title="1.6 BeanFactory和ApplicationContext有什么区别？"></a>1.6 BeanFactory和ApplicationContext有什么区别？</h3><blockquote>
<p>两者都是Spring容器</p>
</blockquote>
<ul>
<li>相同<ol>
<li>Spring提供了两种不同的IOC 容器，一个是BeanFactory，另外一个是ApplicationContext，它们都是Java  interface，ApplicationContext继承于BeanFactory(ApplicationContext继承ListableBeanFactory。</li>
<li>它们都可以用来配置XML属性，也支持属性的自动注入。</li>
<li>而ListableBeanFactory继承BeanFactory)，BeanFactory 和 ApplicationContext 都提供了一种方式，使用getBean(“bean name”)获取bean。</li>
</ol>
</li>
<li>不同<ol>
<li>当你调用getBean()方法时，BeanFactory仅实例化bean，而ApplicationContext 在启动容器的时候实例化单例bean，不会等待调用getBean()方法时再实例化。</li>
<li>BeanFactory不支持国际化，即i18n，但ApplicationContext提供了对它的支持。</li>
<li>BeanFactory与ApplicationContext之间的另一个区别是能够将事件发布到注册为监听器的bean。</li>
<li>BeanFactory 的一个核心实现是XMLBeanFactory 而ApplicationContext  的一个核心实现是ClassPathXmlApplicationContext，Web容器的环境我们使用WebApplicationContext并且增加了getServletContext 方法。</li>
<li>如果使用自动注入并使用BeanFactory，则需要使用API注册AutoWiredBeanPostProcessor，如果使用ApplicationContext，则可以使用XML进行配置。</li>
<li><strong>简而言之，BeanFactory提供基本的IOC和DI功能，而ApplicationContext提供高级功能，BeanFactory可用于测试和非生产使用，但ApplicationContext是功能更丰富的容器实现，应该优于BeanFactory</strong></li>
</ol>
</li>
</ul>
<h3 id="1-7-spring、springmvc、springboot的区别是什么？"><a href="#1-7-spring、springmvc、springboot的区别是什么？" class="headerlink" title="1.7 spring、springmvc、springboot的区别是什么？"></a>1.7 spring、springmvc、springboot的区别是什么？</h3><blockquote>
<p>Q</p>
</blockquote>
<ul>
<li>概念<ol>
<li>Spring和SpringMVC<ul>
<li>spring是一个一站式的轻量级的java开发框架，核心是控制反转（IOC）和面向切面（AOP），针对于开发的WEB层(springMvc)、业务层(Ioc)、持久层(jdbcTemplate)等都提供了多种配置解决方案；</li>
<li>springMvc是spring基础之上的一个MVC框架，主要处理web开发的路径映射和视图渲染，属于spring框架中WEB层开发的一部分；</li>
</ul>
</li>
<li>SpringBoot和SpringMVC<ul>
<li>springBoot框架相对于springMvc框架来说，更专注于开发微服务后台接口，不开发前端视图，同时遵循默认优于配置，简化了插件配置流程，不需要配置xml，相对springmvc，大大简化了配置流程；</li>
<li>springMVC属于一个企业WEB开发的MVC框架，涵盖面包括前端视图开发、文件配置、后台接口逻辑开发等，XML、config等配置相对比较繁琐复杂；</li>
</ul>
</li>
</ol>
</li>
<li>总结<ol>
<li>Spring 框架就像一个家族，有众多衍生产品例如 boot、security、jpa等等。但他们的基础都是Spring的ioc、aop等. ioc 提供了依赖注入的容器， aop解决了面向横切面编程，然后在此两者的基础上实现了其他延伸产品的高级功能；<strong>是一个底层框架</strong></li>
<li>springMvc主要解决WEB开发的问题，是基于Servlet 的一个MVC框架，通过XML配置，统一开发前端视图和后端逻辑；<strong>是一个spring中的web框架</strong></li>
<li>由于Spring的配置非常复杂，各种XML、JavaConfig、servlet处理起来比较繁琐，为了简化开发者的使用，从而创造性地推出了springBoot框架，默认(约定)优于配置，简化了springMvc的配置流程；但区别于springMvc的是，springBoot专注于单体微服务接口开发，和前端解耦，虽然springBoot也可以做成springMvc前后台一起开发，但是这就有点不符合springBoot框架的初衷了；<strong>是一个脚手架</strong></li>
</ol>
</li>
</ul>
<h3 id="1-8-springmvc工作流程是什么？"><a href="#1-8-springmvc工作流程是什么？" class="headerlink" title="1.8 springmvc工作流程是什么？"></a>1.8 springmvc工作流程是什么？</h3><blockquote>
<p>简述概念：当发起请求时被前置的控制器拦截到请求，根据请求参数生成代理请求，找到请求对应的实际控制器，控制器处理请求，创建数据模型，访问数据库，将模型响应给中心控制器，控制器使用模型与视图渲染视图结果，将结果返回给中心控制器，再将结果返回给请求者。</p>
</blockquote>
<ul>
<li>原理图<br>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/springmvc运行流程.jpg"></li>
<li>原理步骤<ol>
<li>DispatcherServlet表示前置控制器，是整个SpringMVC的控制中心。用户发出请求，DispatcherServlet接收请求并拦截请求。</li>
<li>HandlerMapping为处理器映射。DispatcherServlet调用HandlerMapping,HandlerMapping根据请求url查找Handler。</li>
<li>返回处理器执行链，根据url查找控制器，并且将解析后的信息传递给DispatcherServlet</li>
<li>HandlerAdapter表示处理器适配器，其按照特定的规则去执行Handler。</li>
<li>执行handler找到具体的处理器</li>
<li>Controller将具体的执行信息返回给HandlerAdapter,如ModelAndView。</li>
<li>HandlerAdapter将视图逻辑名或模型传递给DispatcherServlet。</li>
<li>DispatcherServlet调用视图解析器(ViewResolver)来解析HandlerAdapter传递的逻辑视图名。</li>
<li>视图解析器将解析的逻辑视图名传给DispatcherServlet。</li>
<li>DispatcherServlet根据视图解析器解析的视图结果，调用具体的视图，进行试图渲染</li>
<li>将响应数据返回给客户端</li>
</ol>
</li>
</ul>
<h3 id="1-9-springmvc的九大组件有哪些？"><a href="#1-9-springmvc的九大组件有哪些？" class="headerlink" title="1.9 springmvc的九大组件有哪些？"></a>1.9 springmvc的九大组件有哪些？</h3><blockquote>
<p>Q</p>
</blockquote>
<ul>
<li><p>HandlerMapping</p>
<ol>
<li>根据request找到相应的处理器。因为Handler（Controller）有两种形式，一种是基于类的Handler，另一种是基于Method的Handler（也就是我们常用的）</li>
</ol>
</li>
<li><p>HandlerAdapter</p>
<ol>
<li>调用Handler的适配器。如果把Handler（Controller）当做工具的话，那么HandlerAdapter就相当于干活的工人</li>
</ol>
</li>
<li><p>HandlerExceptionResolver</p>
<ol>
<li>对异常的处理</li>
</ol>
</li>
<li><p>ViewResolver</p>
<ol>
<li>用来将String类型的视图名和Locale解析为View类型的视图</li>
</ol>
</li>
<li><p>RequestToViewNameTranslator</p>
<ol>
<li>有的Handler（Controller）处理完后没有设置返回类型，比如是void方法，这是就需要从request中获取viewName</li>
</ol>
</li>
<li><p>LocaleResolver</p>
<ol>
<li>从request中解析出Locale。Locale表示一个区域，比如zh-cn，对不同的区域的用户，显示不同的结果，这就是i18n（SpringMVC中有具体的拦截器LocaleChangeInterceptor）</li>
</ol>
</li>
<li><p>ThemeResolver</p>
<ol>
<li>主题解析，这种类似于我们手机更换主题，不同的UI，css等</li>
</ol>
</li>
<li><p>MultipartResolver</p>
<ol>
<li>处理上传请求，将普通的request封装成MultipartHttpServletRequest</li>
</ol>
</li>
<li><p>FlashMapManager</p>
<ol>
<li>用于管理FlashMap，FlashMap用于在redirect重定向中传递参数</li>
</ol>
</li>
</ul>
<h3 id="1-10-springboot自动配置原理是什么？"><a href="#1-10-springboot自动配置原理是什么？" class="headerlink" title="1.10 springboot自动配置原理是什么？"></a>1.10 springboot自动配置原理是什么？</h3><blockquote>
<p>详见马士兵的md文档</p>
</blockquote>
<h3 id="1-11-spring事务的实现方式原理是什么？"><a href="#1-11-spring事务的实现方式原理是什么？" class="headerlink" title="1.11 spring事务的实现方式原理是什么？"></a>1.11 spring事务的实现方式原理是什么？</h3><blockquote>
<p>在使用Spring框架的时候，可以有两种事务的实现方式，一种是编程式事务，有用户自己通过代码来控制事务的处理逻辑，还有一种是声明式事务，通过@Transactional注解来实现，当添加此注解之后事务的自动功能就会关闭，有spring框架来帮助进行控制。</p>
</blockquote>
<ul>
<li>原理<ol>
<li>其实事务操作是AOP的一个核心体现，当一个方法添加@Transactional注解之后，spring会基于这个类生成一个代理对象，会将这个代理对象作为bean，当使用这个代理对象的方法的时候，如果有事务处理，那么会先把事务的自动提交给<del>关系</del>关闭掉，然后去执行具体的业务逻辑，如果执行逻辑没有出现异常，那么代理逻辑就会直接提交，如果出现任何异常情况，那么直接进行回滚操作，当然用户可以控制对哪些异常进行回滚操作。</li>
</ol>
</li>
</ul>
<h3 id="1-12-spring的事务传播机制是什么？"><a href="#1-12-spring的事务传播机制是什么？" class="headerlink" title="1.12 spring的事务传播机制是什么？"></a>1.12 spring的事务传播机制是什么？</h3><blockquote>
<p>简述：多个事务方法相互调用时，事务如何在这些方法之间进行传播,spring中提供了7中不同的传播特性，来保证事务的正常执行：</p>
</blockquote>
<ul>
<li>概念<ol>
<li>REQUIRED：默认的传播特性，如果当前没有事务，则新建一个事务，如果当前存在事务，则加入这个事务</li>
<li>SUPPORTS：当前存在事务，则加入当前事务，如果当前没有事务，则以非事务的方式执行</li>
<li>MANDATORY：当前存在事务，则加入当前事务，如果当前事务不存在，则抛出异常</li>
<li>REQUIRED_NEW：创建一个新事务，如果存在当前事务，则挂起改事务</li>
<li>NOT_SUPPORTED：以非事务方式执行，如果存在当前事务，则挂起当前事务</li>
<li>NEVER：不使用事务，如果当前事务存在，则抛出异常</li>
<li>NESTED：如果当前事务存在，则在嵌套事务中执行，否则REQUIRED的操作一样</li>
</ol>
</li>
<li>差异<ol>
<li>NESTED和REQUIRED_NEW的区别<ul>
<li>REQUIRED_NEW是新建一个事务并且新开始的这个事务与原有事务无关，而NESTED则是当前存在事务时会开启一个嵌套事务，在NESTED情况下，父事务回滚时，子事务也会回滚，而REQUIRED_NEW情况下，原有事务回滚，不会影响新开启的事务</li>
</ul>
</li>
<li>NESTED和REQUIRED的区别<ul>
<li>REQUIRED情况下，调用方存在事务时，则被调用方和调用方使用同一个事务，那么被调用方出现异常时，由于共用一个事务，所以无论是否catch异常，事务都会回滚，而在NESTED情况下，被调用方发生异常时，调用方可以catch其异常，这样只有子事务回滚，父事务不会回滚。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="1-13-spring事务的隔离级别有哪些？"><a href="#1-13-spring事务的隔离级别有哪些？" class="headerlink" title="1.13 spring事务的隔离级别有哪些？"></a>1.13 spring事务的隔离级别有哪些？</h3><blockquote>
<p> spring中的事务隔离级同Mysql一样，详见Mysql的事务隔离级别</p>
</blockquote>
<ul>
<li>优先级<ol>
<li>在进行配置的时候，如果数据库和spring代码中的隔离级别不同，那么以spring的配置为主。</li>
</ol>
</li>
</ul>
<h3 id="1-14-spring事务什么时候会失效？"><a href="#1-14-spring事务什么时候会失效？" class="headerlink" title="1.14 spring事务什么时候会失效？"></a>1.14 spring事务什么时候会失效？</h3><blockquote>
<p>一般不会失效，失效的时候也是建议排查法</p>
</blockquote>
<ul>
<li>失效的原因<ol>
<li>bean对象没有被spring容器管理</li>
<li>方法的访问修饰符不是public</li>
<li>自身调用问题</li>
<li>数据源没有配置事务管理器</li>
<li>数据库不支持事务</li>
<li>异常被捕获</li>
<li>异常类型错误或者配置错误</li>
</ol>
</li>
</ul>
<h3 id="1-15-Spring框架中的单例Bean是线程安全的么？"><a href="#1-15-Spring框架中的单例Bean是线程安全的么？" class="headerlink" title="1.15 Spring框架中的单例Bean是线程安全的么？"></a>1.15 Spring框架中的单例Bean是线程安全的么？</h3><blockquote>
<p> Spring中的Bean对象默认是单例的，框架并没有对bean进行多线程的封装处理</p>
<ul>
<li>Bean的状态：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangyang108/p/6031009.html">https://www.cnblogs.com/wangyang108/p/6031009.html</a></li>
</ul>
</blockquote>
<ul>
<li><p>概念</p>
<ol>
<li><p>Bean是有状态（有状态：指有属性值，导致修改属性值就是不同的Bean，不安全故需防止反射修改值）</p>
<ul>
<li>那么就需要开发人员自己来保证线程安全的保证，最简单的办法就是改变bean的作用域把singleton改成prototype，这样每次请求bean对象就相当于是创建新的对象来保证线程的安全，但效率会低</li>
</ul>
</li>
<li><p>Bean是无状态</p>
<ul>
<li>无状态就是不会存储数据，你想一下，我们的controller，service和dao本身并不是线程安全的，只是调用里面的方法，而且多线程调用一个实例的方法，会在内存中复制遍历，这是自己线程的工作内存，是最安全的。</li>
</ul>
</li>
</ol>
</li>
<li><p>总结</p>
<ol>
<li>因此在进行使用的时候，不要在bean中声明任何有状态的实例变量或者类变量，如果必须如此，也推荐大家使用ThreadLocal把变量变成线程私有，如果bean的实例变量或者类变量需要在多个线程之间共享，那么就只能使用synchronized，lock，cas等这些实现线程同步的方法了。<br> (ThreadLocal，在JVM基础中也有相应的讲解：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45040387/article/details/108299104%EF%BC%89">https://blog.csdn.net/qq_45040387/article/details/108299104）</a></li>
</ol>
</li>
</ul>
<h3 id="1-16-spring框架中使用了哪些设计模式及应用场景？"><a href="#1-16-spring框架中使用了哪些设计模式及应用场景？" class="headerlink" title="1.16 spring框架中使用了哪些设计模式及应用场景？"></a>1.16 spring框架中使用了哪些设计模式及应用场景？</h3><blockquote>
<p>Q</p>
</blockquote>
<ul>
<li>设计模式<ol>
<li>工厂模式，在各种BeanFactory以及ApplicationContext创建中都用到了</li>
<li>模版模式，在各种BeanFactory以及ApplicationContext实现中也都用到了</li>
<li>代理模式，Spring AOP 利用了 AspectJ AOP实现的! AspectJ AOP 的底层用了动态代理</li>
<li>策略模式，加载资源文件的方式，使用了不同的方法，比如：ClassPathResourece，FileSystemResource，ServletContextResource，UrlResource但他们都有共同的借口Resource；在Aop的实现中，采用了两种不同的方式，JDK动态代理和CGLIB代理</li>
<li>单例模式，比如在创建bean的时候。</li>
<li>观察者模式，spring中的ApplicationEvent，ApplicationListener,ApplicationEventPublisher</li>
<li>适配器模式，MethodBeforeAdviceAdapter,ThrowsAdviceAdapter,AfterReturningAdapter</li>
<li>装饰者模式，源码中类型带Wrapper或者Decorator的都是</li>
</ol>
</li>
</ul>
<h3 id="1-17-Mybatis基础之工作原理"><a href="#1-17-Mybatis基础之工作原理" class="headerlink" title="1.17 Mybatis基础之工作原理"></a>1.17 Mybatis基础之工作原理</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014745069/article/details/80788127">工作原理</a></p>
</blockquote>
<ul>
<li><p>原理图</p>
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/Mybatis工作原理.png" style="zoom:67%;" /></li>
<li><p>工作原理解析</p>
<ol>
<li>mybatis应用程序通过SqlSessionFactoryBuilder从mybatis-config.xml配置文件（也可以用Java文件配置的方式，需要添加@Configuration）来构建SqlSessionFactory（SqlSessionFactory是线程安全的）；</li>
<li>然后，SqlSessionFactory的实例直接开启一个SqlSession，再通过SqlSession实例获得Mapper对象并运行Mapper映射的SQL语句，完成对数据库的CRUD和事务提交，之后关闭SqlSession。</li>
<li>说明：SqlSession是单线程对象，因为它是非线程安全的，是持久化操作的独享对象，类似jdbc中的Connection，底层就封装了jdbc连接。</li>
</ol>
</li>
<li><p>详细流程</p>
<ol>
<li><p>加载mybatis全局配置文件（数据源、mapper映射文件等），解析配置文件，MyBatis基于XML配置文件生成Configuration，和一个个MappedStatement（包括了参数映射配置、动态SQL语句、结果映射配置），其对应着&lt;select | update | delete | insert&gt;标签项。</p>
</li>
<li><p>SqlSessionFactoryBuilder通过Configuration对象生成SqlSessionFactory，用来开启SqlSession。</p>
</li>
<li><p>SqlSession对象完成和数据库的交互：<br> a、用户程序调用mybatis接口层api（即Mapper接口中的方法）<br> b、SqlSession通过调用api的Statement ID找到对应的MappedStatement对象<br> c、通过Executor（负责动态SQL的生成和查询缓存的维护）将MappedStatement对象进行解析，sql参数转化、动态sql拼接，生成jdbc Statement对象<br> d、JDBC执行sql。</p>
<p> e、借助MappedStatement中的结果映射关系，将返回结果转化成HashMap、JavaBean等存储结构并返回。</p>
</li>
</ol>
</li>
<li><p>mybatis层次图</p>
  <div align=left><img  src="Java基础/Mybatis层次图.png" /></div></li>
</ul>
<h3 id="1-18-Mybatis与JPA区别？"><a href="#1-18-Mybatis与JPA区别？" class="headerlink" title="1.18 Mybatis与JPA区别？"></a>1.18 Mybatis与JPA区别？</h3><blockquote>
<p>本质两者都是持久层框架，使用场景略微不一样</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/july-sunny/p/12439390.html">两者对比</a></p>
</blockquote>
<h2 id="7-JUC基础"><a href="#7-JUC基础" class="headerlink" title="7. JUC基础"></a>7. JUC基础</h2><blockquote>
<p>线程中一定会运行main、gc 两个默认线程</p>
<p>JUC是JDK的Java.util.concurrent工具并发包，含 Java.util.concurrent 和 Java.util.concurrent.*</p>
</blockquote>
<h3 id="1-1-多线程"><a href="#1-1-多线程" class="headerlink" title="1.1 多线程"></a>1.1 多线程</h3><ul>
<li><p>实现方式</p>
<ol>
<li><p>继承Thread类</p>
</li>
<li><p>实现Runnable接口</p>
</li>
<li><p>实现Callable接口，并用Future接口返回参数</p>
<blockquote>
<p>FutureTask为Runnable的实现类，而FutureTask的构造函数可以传入Callable接口，所以最终传入Thread的多态转化为Runnable</p>
<p>注意：多个线程开启同一个FutureTask，只会执行一次，它会对一次执行后的结果做缓存，下次调用直接返回结果。</p>
<p>注意是FutureTask才会缓存，多个task调用同一个callable，不会缓存。</p>
</blockquote>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 结合lambda表达式的使用，若运行两个相同对象的FutureTask，则只会执行一次call方法，因为源码中State判断已执行过</span>
<span class="token comment">// (类似缓存),故不再执行第二个call方法，直接将第一个call方法的返回值拿给第二个call方法返回出去</span>
<span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回线程的返回值</span>
t<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>Thread源码的六大状态</p>
<ol>
<li>NEW 新生</li>
<li>RUNNABLE 运行</li>
<li>BLOCKED 阻塞</li>
<li>WAITING 等待</li>
<li>TIMED_WAITING 超时等待</li>
<li>TERMINATED 死亡</li>
</ol>
</li>
<li><p>线程生命周期</p>
  <img src="D:/App/Typora/TyporaSource/Private/Java基础/线程生命周期.png"  />

<p>  线程函数调用</p>
<ol>
<li>线程休眠 - Thread.sleep() - 线程阻塞、占着cpu睡眠、不释放锁</li>
<li>线程礼让 - Thread.yield() - 线程暂停，让出cpu、不释放锁</li>
<li>线程强制执行 - Thread.join() - 主线程等待子线程的终止（需子线程先t.start(),再t.join()，主线程才会等待子线程）</li>
<li>观测线程状态 - Thread.getState() - 获取线程的状态</li>
<li>线程的优先级 -Thread.getPriority.setPriority(int xxx) - xxx为1~10</li>
<li>守护线程 - Thread.setDaemon()</li>
</ol>
</li>
<li><p>wait() 和 sleep() 区别？</p>
<ol>
<li>wait()来自Object类，sleep()来自Thread类</li>
<li>wait()会释放锁，sleep()不会释放锁</li>
<li>wait()得使用在同步代码块中，sleep()可在任何地方</li>
</ol>
</li>
<li><p>线程资源类OOP示例</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
* 真正的多线程开发，公司中的开发，降低耦合性
* 线程就是一个单独的资源类，没有任何附属的操作！
* 1、 属性、方法
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 并发：多线程操作同一个资源类, 把资源类丢入线程</span>
        <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// @FunctionalInterface 函数式接口，jdk1.8 lambda表达式 (参数)->&#123; 代码 &#125;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> 
<span class="token comment">// 资源类OOP的示例写法</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 属性、方法</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token comment">// 卖票的方式</span>
    <span class="token comment">// synchronized 本质: 队列，锁</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>number<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"卖出了"</span><span class="token operator">+</span><span class="token punctuation">(</span>number<span class="token operator">-</span>
            <span class="token operator">-</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"票,剩余："</span><span class="token operator">+</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="1-3-锁"><a href="#1-3-锁" class="headerlink" title="1.3 锁"></a>1.3 锁</h3><blockquote>
<p>乐观锁讲究的是结果，只在结果处上锁验证对否，故效率高</p>
<p>悲观锁讲究的是过程，全程参与上锁，故效率较低。</p>
</blockquote>
<ul>
<li><p>Synchronized  </p>
</li>
<li><p>Lock</p>
<ol>
<li><p>公平、非公平锁</p>
<ul>
<li>公平锁：不能够插队，必须先来后到  </li>
<li>非公平锁：可以插队 （默认都是非公平）  </li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/w8y56f/article/details/89554060">可重入锁（递归锁）</a></p>
<ul>
<li><p>定义：</p>
<blockquote>
<p>可重入就是说某个线程已经获得某个锁并且这个锁还没释放，可以再次获取该锁而不会出现死锁，不管是可重入锁还    是不可重入锁，锁多少次，就要释放多少次</p>
</blockquote>
</li>
<li><p>作用：提高效率</p>
<blockquote>
<p>为什么要有可重入锁：在一个村子里面，有一口井水，水质非常的好，村民们都想打井里的水。这井只有一口，村里的人那么多，所以得出个打水的规则才行。村长绞尽脑汁，最终想出了一个比较合理的方案，咱们来仔细的看看聪明的村长大人的智慧。 井边安排一个看井人，维护打水的秩序。 打水时，以家庭为单位，哪个家庭任何人先到井边，就可以先打水，而且如果一个家庭占到了打水权，其家人这时候过来打水不用排队。而那些没有抢占到打水权的人，一个一个挨着在井边排成一队，先到的排在前面</p>
</blockquote>
</li>
</ul>
</li>
<li><p>自旋锁</p>
<blockquote>
<p>本质是通过CAS实现的</p>
</blockquote>
</li>
<li><p>死锁</p>
</li>
</ol>
</li>
<li><p>Synchronized 和Lock区别</p>
<ol>
<li><p>(类型不同)Synchronized 内置的Java关键字，Lock是一个Java类</p>
</li>
<li><p>(是否可获取锁的状态)Synchronized无法判断获取锁的状态，Lock可以判断是否获取到了锁：lock.tryLock();</p>
</li>
<li><p>(自动化与非自动化)Synchronized 会自动释放锁，lock必须要手动释放锁! 如果不释放锁，死锁</p>
</li>
<li><p>(获取不到锁是否会一直等待)Synchronized线程1(获得锁，阻塞)、线程2(等待，傻傻的等） ;Lock锁就不一定会等待下去;</p>
</li>
<li><p>(是否可以获取公平锁)Synchronized可重入锁，不可以中断的，非公平;Lock，可重入锁，可以判断锁，非公平(可以自己设置）;</p>
</li>
<li><p>(性能问题)Synchronized适合锁少量的代码同步问题，Lock适合锁大量的同步代码!</p>
</li>
<li><p>Lock可以实现精确通知(利用可重入锁ReentrantLock的特性)</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> AA <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Data</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">show1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">show2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">show3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Data</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Condition</span> c1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Condition</span> c2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Condition</span> c3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> c1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            c2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> c2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"222"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            c3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> c3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"333"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            c1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
111
222
333
111
222
333
111
222
333
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
</ul>
<h3 id="1-3-读写锁"><a href="#1-3-读写锁" class="headerlink" title="1.3 读写锁"></a>1.3 读写锁</h3><blockquote>
<p>本质上是共享锁和互斥锁（独占锁）的区别</p>
</blockquote>
<ul>
<li><p>共享锁，互斥锁的区别：</p>
<blockquote>
<ol>
<li>读锁是共享锁，锁的是读操作与写操作不能兼并，但读读并发仍可以获得锁，与不加锁读读时情况一致，<br> （无写时等同不加锁）</li>
<li>写锁是互斥锁，锁的是写与读，写与写，相当于锁的是自身和其他操作。故互斥其他任何操作。</li>
<li>ReadWriteLock <ul>
<li>读-读 可以共存！ </li>
<li>读-写 不能共存！ </li>
<li>写-写 不能共存！</li>
</ul>
</li>
</ol>
</blockquote>
</li>
</ul>
<h3 id="1-3-阻塞队列"><a href="#1-3-阻塞队列" class="headerlink" title="1.3 阻塞队列"></a>1.3 阻塞队列</h3><blockquote>
<p>BlockingQueue阻塞队列满时的情况<br><img src="D:/App/Typora/TyporaSource/Private/Java基础/阻塞队列满时情况.png" style="zoom: 33%;" /></p>
<p>SynchronousQueue 同步队列：</p>
<p>和其他的BlockingQueue不一样。</p>
<p>没有容量， 进去一个元素，必须等待取出来之后，才能再往里面放一个元素！</p>
<p>只有 put()、take()两个方法</p>
<p>什么情况下我们会使用 阻塞队列：多线程并发处理，线程池！  </p>
</blockquote>
<h3 id="1-3-线程池"><a href="#1-3-线程池" class="headerlink" title="1.3 线程池"></a>1.3 线程池</h3><blockquote>
<p>三大方法、7大参数、4种拒绝策略</p>
</blockquote>
<ul>
<li><p>三大方法</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//使用1个线程去执行，1核心 1max</span>
<span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使用指定线程数量去执行 指定数量的核心与max,推荐使用</span>
<span class="token class-name">ExecutorService</span> executorService1 <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//动态执行，核心线程为0，最大线程为Integer.MAX_VALUE 21亿,容易出现OOM等异常</span>
<span class="token class-name">ExecutorService</span> executorService2 <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>7大参数</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span><span class="token comment">//核心线程数 也就是一直工作的线程数量</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span><span class="token comment">//最大线程数，如果核心心线程数使用完</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span><span class="token comment">//非核心线程的存活时间</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span><span class="token comment">//非核心线程的存活时间单位</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">,</span><span class="token comment">//阻塞队列</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span><span class="token comment">//线程工厂</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token comment">//拒绝策略</span>
    
<span class="token comment">//示例</span>
<span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
        <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>CallerRunsPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>4大拒绝策略</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*
*  线程的最大数量怎么设计?
*/</span>
<span class="token comment">// CPU密集型：更加CPU的核心数设定max–Runtime.getRuntime().availableProcessors()</span>
<span class="token comment">// IO密集型：设定的线程数得满足耗时任务的执行，起码要大于它。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="1-3-集合类不安全"><a href="#1-3-集合类不安全" class="headerlink" title="1.3 集合类不安全"></a>1.3 集合类不安全</h3><blockquote>
<p>cow写入时复制是一种空间换时间的操作</p>
</blockquote>
<ul>
<li><p>以保证线程安全的List为例</p>
<ol>
<li><p>Vector是线程安全，它给每个方法加上了synchronized，效率低</p>
</li>
<li><p>使用Collections.synchronizedList()获得线程安全的list</p>
</li>
<li><p>CopyOnWriteArrayList</p>
<p> CopyOnWriteArrayList比1,2好在哪里：使用Lock进行操作，提高了性能，<strong>本质是写入时复制，类似Mysql的快照读。</strong></p>
</li>
</ol>
</li>
</ul>
<h3 id="1-3-四大函数接口-重要"><a href="#1-3-四大函数接口-重要" class="headerlink" title="1.3 四大函数接口(重要)"></a>1.3 四大函数接口(重要)</h3><blockquote>
<p>函数式接口：只有一个方法的接口。这个接口有一个注解：@FunctionalInterface</p>
<p>函数式接口是简化函数编程，简化了重写，匿名方法，与lambda搭配，即实现函数式接口有显示书写和隐式书写<br>（仍给一个lambda表达式给函数接口，默认匹配内部的实现方法）</p>
</blockquote>
<ul>
<li><p>四大原生的函数式接口：</p>
<ol>
<li><p>函数型接口：Function&lt;T,R&gt;：输入参数T、返回类型R</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Funcation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>
	<span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
* Function 函数型接口, 有一个输入参数，有一个输出
* 只要是 函数型接口 可以 用 lambda表达式简化
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo01</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 原式：</span>
<span class="token comment">// Function&lt;String,String> function = new Function&lt;String,String>() &#123;</span>
<span class="token comment">// 	@Override</span>
<span class="token comment">// 	public String apply(String str) &#123;</span>
<span class="token comment">// 	return str;</span>
<span class="token comment">// 	&#125;</span>
<span class="token comment">// &#125;;</span>
<span class="token comment">// lambda简化式：</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> function <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> str<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>function<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"asd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
<li><p>断定型接口：Predicate<T>：返回类型T</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>
	<span class="token keyword">boolean</span> test（<span class="token class-name">T</span> t）
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
* 断定型接口：有一个输入参数，返回值只能是 布尔值！
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo02</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 判断字符串是否为空</span>
<span class="token comment">// Predicate&lt;String> predicate = new Predicate&lt;String>()&#123;</span>
<span class="token comment">// 	@Override</span>
<span class="token comment">// 	public boolean test(String str) &#123;</span>
<span class="token comment">// 	return str.isEmpty();</span>
<span class="token comment">// 	&#125;</span>
<span class="token comment">// &#125;;</span>
<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> predicate <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
<li><p>生产者接口：Supplier<T>：返回类型T</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>
	<span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
* Supplier 供给型接口 没有参数，只有返回值
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo04</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Supplier supplier = new Supplier&lt;Integer>() &#123;</span>
<span class="token comment">// 	@Override</span>
<span class="token comment">// 	public Integer get() &#123;</span>
<span class="token comment">// 	System.out.println("get()");</span>
<span class="token comment">// 	return 1024;</span>
<span class="token comment">// 	&#125;</span>
<span class="token comment">// &#125;;</span>
<span class="token class-name">Supplier</span> supplier <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
<li><p>消费型接口：Consumer<T> - 传入参数T</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>
	<span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
* Consumer 消费型接口: 只有输入，没有返回值
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo03</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Consumer&lt;String> consumer = new Consumer&lt;String>() &#123;</span>
<span class="token comment">// 	@Override</span>
<span class="token comment">// 	public void accept(String str) &#123;</span>
<span class="token comment">// 	System.out.println(str);</span>
<span class="token comment">// 	&#125;</span>
<span class="token comment">// &#125;;</span>
<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> consumer <span class="token operator">=</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"sdadasd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
<li><p>旧时代编程特色</p>
<ol>
<li><p>泛型通配符</p>
<blockquote>
<ul>
<li>上界通配符<code>&lt;? extends T&gt;</code>来接收返回的数据，此写法的泛型集合不能使用add方法，<br>  下界通配符<code>&lt;? super T&gt;</code>不能使用get方法，作为接口调用赋值时易出错。核心在<strong>多态性</strong></li>
<li>PECS(Producer Extends Consumer Super)原则：<ol>
<li>第一、频繁往外读取内容的，适合用&lt;? extends T&gt;。（生产类是拿来get）</li>
<li>第二、经常往里插入的，适合用<code>&lt;? super T&gt;</code>。（消费类是拿来set）</li>
</ol>
</li>
<li>先看 &lt;? extends T&gt; 和 &lt;? super T&gt; 的使用 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1837603">https://cloud.tencent.com/developer/article/1837603</a><br>  后看 简单应用 <a target="_blank" rel="noopener" href="https://blog.csdn.net/WANGSHUANGQUAN_A/article/details/112789960">https://blog.csdn.net/WANGSHUANGQUAN_A/article/details/112789960</a></li>
</ul>
</blockquote>
<ol>
<li><p>上界通配符&lt;？ extends T&gt;：解决泛型多态问题</p>
<ul>
<li><p>普通类之间可以使用多态，但是建立在泛型之上的父子关系类是无法进行多态转换的；</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java">正确：<span class="token class-name">Fruit</span> fruit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
错误：<span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
所以：就算容器里装的东西之间有继承关系，但容器之间是没有继承关系的。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>通过上界通配符 Plate&lt;？ extends Fruit&gt; 可以让泛型用起来符合人的逻辑；</p>
<p>  （上界通配符：上界（父类）通配所有下面（子类）的符号，如同树状图中正三角的顶角）</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Plate&lt;？extends Fruit>和Plate&lt;Apple>最大的区别就是：</span>
<span class="token comment">// Plate&lt;？extends Fruit>是Plate&lt;Fruit>以及Plate&lt;Apple>的基类，即一个能放水果以及一切是水果派生类的盘子</span>
<span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Fruit</span><span class="token punctuation">></span></span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><? extends Fruit>会使往盘子里放东西的set()方法失效。但取东西get()方法还有效

  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Fruit</span><span class="token punctuation">></span></span> fruitPlate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 不能存入任何元素</span>
<span class="token comment">// 理由：因为可以放入任意Fruit的子类，可能出现lev3的盘子，但是set入lev2和lev4的水果，其中lev2是不允许出</span>
<span class="token comment">//		现的情况，因此编辑器是标上一个占位符：CAP#1，来表示捕获一个Fruit或Fruit的子类，具体是什么类不知</span>
<span class="token comment">//		道，代号CAP#1。故盘子无论set什么都失效</span>
fruitPlate<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Error  编译错误</span>
fruitPlate<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Fruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Error  编译错误</span>

<span class="token comment">// 读取出来的东西只能放在Fruit或它的基类里</span>
<span class="token class-name">Fruit</span> newFruit1<span class="token operator">=</span>fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> newFruit2 <span class="token operator">=</span> fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Apple</span> newFruit3 <span class="token operator">=</span> fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

  </li>
</ul>
</li>
<li><p>下界通配符&lt;? super T&gt;：解决泛型多态问题</p>
<ul>
<li><p>效果与上界相反，</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 即一个能放水果以及一切是水果基类的盘子</span>
<span class="token class-name">Plate</span><span class="token operator">&lt;</span>？ <span class="token keyword">super</span> <span class="token class-name">Fruit</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>使用下界&lt;? super Fruit&gt;会使从盘子里取东西的get( )方法部分失效，只能存放到Object对象里。set( )方法正常</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Fruit</span><span class="token punctuation">></span></span> fruitPlate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Fruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 存入元素正常</span>
<span class="token comment">// 理由：因为放入的类只能是Fruit类和Fruit的基类，导致往盘子里set子类时，只要是继承Fruit的子类，都可以</span>
<span class="token comment">//		set进来。</span>
fruitPlate<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fruitPlate<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Fruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 读取出来的东西只能存放在Object类里，因为取出来的类不确定是Fruit或Fruit的基类</span>
<span class="token class-name">Object</span> newFruit1 <span class="token operator">=</span> fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Fruit</span> newFruit2 <span class="token operator">=</span> fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Error</span>
<span class="token class-name">Apple</span> newFruit3 <span class="token operator">=</span> fruitPlate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>应用</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wsq<span class="token punctuation">.</span>io<span class="token punctuation">.</span>nio</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * java开发手册
 *      一、编程规范
 *          （六）集合处理
 *             12. 【强制】泛型通配符&lt;? extends T>来接收返回的数据，此写法的泛型集合不能使用add方法，而&lt;? super T>不能使用get方法，
 *             两者在接口调用赋值的场景中容易出错。 说明：扩展说一下PECS(Producer Extends Consumer Super)原则：
 *             第一、频繁往外读取内容的，适合用&lt;? extends T>。第二、经常往里插入的，适合用&lt;? super T>
 *
 * @author midouwan
 * @date 2021-01-18 9:17 上午
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">//最小子类</span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 多态体现</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Animal</span><span class="token punctuation">></span></span> animals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animals<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> students <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        students<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//List&lt;?> 无界通配符</span>
        <span class="token comment">//List&lt;? extends Person> 上界通配符  ？表示Person的子类</span>
        <span class="token comment">//List&lt;? super Person>   下界通配符  ？表示Person的父类</span>

        <span class="token comment">// 调用上界通配符接口保存信息，接口入参为 List&lt;? extends Person>，只能传入List&lt;Person>或者List&lt;Student></span>
        <span class="token function">saveExtendsList</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveExtendsList</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveExtendsList</span><span class="token punctuation">(</span>animals<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错</span>

        <span class="token comment">// 调用下界通配符接口保存信息，接口入参为 List&lt;? super Person>，只能传入List&lt;Person>或者List&lt;animals></span>
        <span class="token function">saveSuperList</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveSuperList</span><span class="token punctuation">(</span>animals<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveSuperList</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错</span>

        <span class="token comment">//调用别人提供的接口，获取集合信息，不清楚提供方到底返回的是哪个集合，List&lt;Person> 还是 List&lt;Student> ？</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> extendList <span class="token operator">=</span> <span class="token function">getExtends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用get会返回上边界父类对象，可以用父类方法操作子类</span>
        <span class="token class-name">Person</span> p <span class="token operator">=</span> extendList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Student</span> s <span class="token operator">=</span> extendList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错，编译器表示，老色龙后代五花八样，谁知道你是啥样的人</span>
        <span class="token comment">//下面三行全报错，按理说应该可以添加student对象，从当前类看只有animal,student,person三个类，如果还有别的呢，</span>
        <span class="token comment">// 比如学生下面还有两个同级子类，高中生和小学生，别人提供的接口返回的是高中生，然后添加了小学生，编译器表示这个我懵逼，我得报错</span>
        extendList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错</span>
        extendList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错</span>
        extendList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不满足，编译器报错</span>

        <span class="token comment">//那有没有啥办法让编译器不懵逼呢？</span>
        <span class="token comment">//如果您很确定返回的是某个类的数据，强转</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> studentList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token function">getExtends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        studentList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token function">getExtends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        personList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Animal</span><span class="token punctuation">></span></span> animalList <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Animal</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token function">getExtends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animalList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 若果您看懂了上面，下面soEasy了</span>
        <span class="token comment">//调用别人接口获取数据，只知道数据是person或者person父类的集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> aSuper <span class="token operator">=</span> <span class="token function">getSuper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 所以用get获取数据，编译器表示老子怎么知道是你哪个老子，压根不晓得你的老子是啥，万一是禽兽呢，我只能object呀，你自己去判断</span>
        <span class="token class-name">Object</span> object1 <span class="token operator">=</span> aSuper<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//同样如果知道是哪个，强转</span>
        <span class="token class-name">Animal</span> dd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">)</span>aSuper<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// add方法，编译器表示，你的父类肯定是你儿子孙子的父类，多态支持我这么搞</span>
        aSuper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aSuper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 接口：保存信息
     *  此处，必须传入person类或者父类集合
     * @param list  下界通配符  ？表示Person的父类
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveSuperList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 接口：保存信息
     *  此处，必须传入person类或者子类集合
     * @param list  ? extends Person 上界通配符
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveExtendsList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> <span class="token function">getSuper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> <span class="token function">getExtends</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>枚举</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 由于枚举类不可被反射获取，故枚举类也应用于多线程的安全单例模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>反射</p>
</li>
<li><p>其他</p>
<ul>
<li>迭代器：无修改遍历使用foreach，有修改遍历使用iterator</li>
</ul>
</li>
</ol>
</li>
<li><p>新时代编程特色</p>
<ol>
<li><p>lambda表达式</p>
</li>
<li><p>链式编程(参考流式编程)</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 方法中return this；即可保证链式调用方法，适用于建造者模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>函数式接口</p>
</li>
<li><p>流式计算</p>
</li>
<li><p>双冒号“::”：</p>
<ul>
<li><p>用法：类名::方法名</p>
</li>
<li><p>作用：简化lambda语法。lambda是简化到参数()-&gt;{}方法体，此处参数为接受外界传入参数，即上一个方法得到的结果默认传入到形参，形参带入方法体；而此处”::”则直接省略的形参，直接隐式获取参数，带入到方法中执行</p>
</li>
<li><p>简化过程：</p>
<ol>
<li><p>把 x -&gt; System.out.println(x) 简化为 System.out::println 的过程称之为 eta-conversion</p>
</li>
<li><p>把 System.out::println 简化为 x -&gt; System.out.println(x) 的过程称之为 eta-expansion</p>
<blockquote>
<ul>
<li><p>范例一</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 使用1：用于隐式接收参数。即forEach出来的对象带入到new Demo中，再调用 已带入参数的（new）Demo中调用print方法（已含参数）</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"bbbb"</span><span class="token punctuation">,</span> <span class="token string">"cccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//对象实例语法	instanceRef::methodName</span>
		list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">print</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>范例二</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 使用2：类Example先实现InterfaceExample，再通过构造器构造new一个实现类com，调用实现类com中的有参构造器来创造对象，利用多态向上转型为父类类型，打印name信息。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

	<span class="token class-name">Example</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token comment">// 作用类似于实现类，即构造</span>
		<span class="token class-name">InterfaceExample</span> com <span class="token operator">=</span>  <span class="token class-name">Example</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
		<span class="token class-name">Example</span> bean <span class="token operator">=</span> com<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">InterfaceExample</span><span class="token punctuation">&#123;</span>
	<span class="token class-name">Example</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li><p>学习目的：简化编程模型，在新版本的底层大量应用。</p>
<p>  如：list.foreatch(消费者类型的函数式接口);</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="1-3-Stream流"><a href="#1-3-Stream流" class="headerlink" title="1.3 Stream流"></a>1.3 Stream流</h3><blockquote>
<p>为什么要有流的存在？大数据 ： 存储+计算；集合、Mysql的本质为存储，Stream流的本质是计算</p>
<p>并发流使用的默认线程数等于你机器的处理器核心数。可需考虑到cpu上下文切换的消耗，故并发流不一定快</p>
<p>通过这个方法可以修改这个值，这是全局属性。</p>
<p>System.setProperty(“java.util.concurrent.ForkJoinPool.common.parallelism”, “12”);</p>
<p>Parallel stream 底层就是用的 fork-join ，只不过fork-join大部分是手动实现的；</p>
</blockquote>
<ul>
<li><p>流式编程</p>
  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">User</span> u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小红"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小王"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小曾"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小刘"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小李"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小H"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小Q"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> u8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"小W"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>u1<span class="token punctuation">,</span> u2<span class="token punctuation">,</span> u3<span class="token punctuation">,</span> u4<span class="token punctuation">,</span> u5<span class="token punctuation">,</span> u6<span class="token punctuation">,</span> u7<span class="token punctuation">,</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 所有男生</span>
        <span class="token comment">// 分数前三</span>
        <span class="token comment">// 的名字</span>
        list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-></span> u<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uu1<span class="token punctuation">,</span> uu2<span class="token punctuation">)</span> <span class="token operator">-></span> uu2<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> uu1<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
        小Q
        小W
        小王
        */</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>



<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> score<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h3 id="1-3-ForkJoin"><a href="#1-3-ForkJoin" class="headerlink" title="1.3 ForkJoin"></a>1.3 ForkJoin</h3><blockquote>
<p>设计核心：分而治之。即大化小，小化了</p>
</blockquote>
<ul>
<li><p>特点：会自动任务窃取，我已经执行完，把别人的任务拿来执行，提高资源利用率</p>
<blockquote>
<p>每个线程都会为分配给它的任务保存一个双向链式队列，每完成一个任务，就会从队列头上取出下一个任务开始执行。当有线程执行完毕的时候，就会随机选个线程，从队尾选个任务进行执行。</p>
</blockquote>
</li>
<li><p>待分解的任务需要继承的类</p>
<ol>
<li><p>RecursiveAction ：无返回值的任务</p>
</li>
<li><p>RecursiveTask ：有返回值的任务</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zq<span class="token punctuation">.</span>juc1</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinPool</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinTask</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RecursiveTask</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">LongStream</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> s <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">t3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> e <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e <span class="token operator">-</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 278单位</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ans <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 126单位</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ForkJoinPool</span> pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10_0000_0000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> submit <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>submit<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 139单位 并行流</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">t3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> reduce <span class="token operator">=</span> <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10_0000_0000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reduce<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>


<span class="token comment">// 递归分解</span>
<span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">long</span> start<span class="token punctuation">;</span><span class="token comment">//开始位置</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> end<span class="token punctuation">;</span><span class="token comment">//结束位置</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> boundary <span class="token operator">=</span> <span class="token number">500_0000</span><span class="token punctuation">;</span><span class="token comment">//分界线</span>

    <span class="token keyword">public</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> boundary<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//不分解了，直接计算</span>
            <span class="token keyword">long</span> ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> ans <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">return</span> ans<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>end <span class="token operator">+</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token comment">//分解计算</span>
            <span class="token class-name">MyTask</span> task1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task1<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行</span>
            <span class="token class-name">MyTask</span> task2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task2<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行</span>
            <span class="token keyword">return</span> task1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> task2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取执行结果</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>z<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
</ul>
<h3 id="1-3-JMM"><a href="#1-3-JMM" class="headerlink" title="1.3 JMM"></a>1.3 JMM</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/325469611/answer/694336275">JMM（Java Memory Model）</a></p>
<p>本质为每个线程中的工作内存与主内存的关系问题</p>
</blockquote>
<h3 id="1-3-Volatile"><a href="#1-3-Volatile" class="headerlink" title="1.3 Volatile"></a>1.3 Volatile</h3><blockquote>
<p>深入解析Volatile的实现原理，如何保证有序性、可见性？</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_37990128/article/details/109186447">https://blog.csdn.net/weixin_37990128/article/details/109186447</a></p>
<p>换言之，volatile不是不能保证原子性，它是只能保证单次读或写操作的原子性，因此对于多线程的中原子性的变量操作，volatile是可以保证原子性的；Synchronized同步锁保证可见，原子，有序性，自然更能解决更多多线程的问题。</p>
</blockquote>
<ul>
<li><p>如何保证可见性？</p>
<ol>
<li>缓存一致性</li>
<li>happends-before关系</li>
</ol>
</li>
<li><p>如何保证有序性（禁止指令重排）？</p>
<ol>
<li>代码在执行之前会经过编辑器重排序优化和处理器重排序优化</li>
<li>voliatile在编辑器层面有volatile重排序规则表，限制了重排序的规范</li>
<li>在处理器层有内存屏障，禁止重排序；而内存屏障使用最多的地方是DCL懒汉式单例(volatile修饰)</li>
</ol>
</li>
<li><p>Synchronized和volatile的区别？</p>
<blockquote>
<p>深入解析synchronized实现原理，如何保证原子性、有序性和可见性？</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44799530/article/details/117810053">https://blog.csdn.net/qq_44799530/article/details/117810053</a></p>
</blockquote>
<ol>
<li>volatile本质：是java虚拟机(JVM)当前变量在工作内存中的值是不确定的，需要从主内存中读取；synchronized则是锁定当前的变量，只有当前线程可以访问到该变量，其他的线程将会被阻塞。</li>
<li>volatile只能实现变量的修改可见性，并不能保证原子性；而synchronized则可以保证变量的修改可见性和原子性。</li>
<li>volatile只能使用在变量级别；synchronized则可以使用在变量、方法、和类级别的。</li>
<li>volatile不会造成线程的阻塞；synchronized可能会造成线程的阻塞。</li>
</ol>
</li>
</ul>
<h3 id="1-3-CAS"><a href="#1-3-CAS" class="headerlink" title="1.3 CAS"></a>1.3 CAS</h3><blockquote>
<p>CAS（CompareAndSwap）：比较当前工作内存中的值和主内存中的值，如果这个值是期望的，那么则执行操作！如果不是就<br>一直循环！  </p>
<p>Java中实现原子操作的类为原子类，原子的底层是Unsafe类，Unsafe类的自增1方法 getAndAddInt() 底层是CAS,故原子类操作与CAS密不可分<br><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4286318/blog/3320842">https://my.oschina.net/u/4286318/blog/3320842</a></p>
<p>缺点：<br>1、 循环会耗时<br>2、一次性只能保证一个共享变量的原子性<br>3、ABA问题  ，通过原子引用类解决（引入另一个标志位(类似Mysql的历史版本)来验证期望值，即1到2为正常，若ABA则1到4，明显标志位不同，多次修改）</p>
</blockquote>
<h3 id="1-3-原子引用"><a href="#1-3-原子引用" class="headerlink" title="1.3 原子引用"></a>1.3 原子引用</h3><blockquote>
<ol>
<li><p>原子引用类的compareAndSet是底层源码是通过“=”对比两个Integer对象的地址是否不同，(因为在Integer范围区间内，是会产生缓存IntegerCache.cache的，这会导致使用“=”比较地址与“equals”比较值产生一样的结果，但超出范围就地址比较为false，故推荐使用equals判断。实践中，我们常使用封装对象来比较，则此时“=”也是原本对象的地址。这个问题是包装类值范围的专属问题)所以需要外部定义对象，然后传的时候传对象Integer而不是传值int</p>
</li>
<li><p>Integer的范围是-128-127之间，故超过此范围则会立即生成新的对象，地址就变了，比较结果也为false<br> 可重入锁：可以重复进入的锁，即拿到外面的锁，里面的锁自动获取</p>
</li>
</ol>
</blockquote>
<h3 id="1-8-计数辅助类"><a href="#1-8-计数辅助类" class="headerlink" title="1.8 计数辅助类"></a>1.8 计数辅助类</h3><ul>
<li>CountDownLatch 减法计数器</li>
<li>CyclicBarrier 加法计数器</li>
<li>Semaphore 信号量 限流 - 类似池的效果</li>
</ul>
<h2 id="8-Java中间件"><a href="#8-Java中间件" class="headerlink" title="8. Java中间件"></a>8. Java中间件</h2><blockquote>
<p>单体架构本质是集所有功能与一个服务中运行 </p>
<p>分布式架构本质上是多模块服务独立运行（功能的实现无语言要求，只管返回需求的数据，故可多语言开发），通过网络通信调用方法获取数据，解耦运行项目，而中间件就是解决多模块服务之间的通信(遵守什么通信协议如TCP/IP协议等）、高可用(是否支持集群等)、持久化功能、跨平台(解决不同语言之间的局限性)等问题而存在。</p>
<p>中间件本质上是依据TCP\IP协议或UDP协议实现的，但因实际需求，以基础协议为底，封装了其他操作更适合作为中间件使用功能强大而简单易用。而http协议携带信息过于冗余，故不直接使用http协议</p>
<p>废话：<br>分布式系统分布式事务问题<br>-、可靠生产：<br>利用rabbitMQ的消息确认机制（需开启此功能）<br>生产者<br> 利用消息冗余表，标记消息是否发到MQ<br> 如果消息发到了MQ的交换机，交换机会给生产者一个回执（利用消息确认机制来完成回执）<br> 一旦生产者接收到回执，会把本地冗余表状态改为成功<br> 消息确认机制，本地维护消息状态表<br>二、可靠消费<br>重试机制（默认是关闭的）<br>消费者<br> 1.控制重试次数+死信队列<br> 2.try catch+手动ack<br> 3.try catch+手动ack+死信队列+人工干预<br>优点：通用性强、拓展方便、耦合度低，方案也比较成熟<br>缺点：<br> 1.基于消息中间件，只适合异步场景<br> 2.消息会延迟处理，需要业务上能够容忍<br>建议：<br>尽量避免使用分布式事务，核心业务最好单体架构，非核心业务拆分<br>根据业务考衡是否要用分布式事务</p>
</blockquote>
<h3 id="8-1-中间件为什么需要持久化、高可用、跨平台？"><a href="#8-1-中间件为什么需要持久化、高可用、跨平台？" class="headerlink" title="8.1 中间件为什么需要持久化、高可用、跨平台？"></a>8.1 中间件为什么需要持久化、高可用、跨平台？</h3><blockquote>
<p>安装事项：云服务器在云端的安全组中开启端口、在linux中关闭对应端口的防火墙</p>
</blockquote>
<ul>
<li><p>持久化</p>
<blockquote>
<p>A–&gt;中间件C–&gt;B</p>
</blockquote>
<ol>
<li>无持久化的中间件是短链接，短连接是A发信息给C时，链路出现错误，C无保存，当恢复链路通信后，数据信息自然丢失。</li>
<li>有持久化的中间件是长链接，长链接 是A发信息给C时，链路出现错误，C有保存，当恢复链路通信后，数据信息仍在，会再次传输数据信息给B，”连接时间长，路途也长，故称长链接”</li>
</ol>
</li>
<li><p>高可用</p>
<ol>
<li>中间件高可用就是中间件也支持集群配置，避免单个中间件出现问题时出现整体服务故障</li>
</ol>
</li>
<li><p>跨平台</p>
<ol>
<li>不同语言有不同优势，根据业务选择合适的语言来实现业务会提升整体服务的效率及可用性</li>
</ol>
</li>
</ul>
<h3 id="8-2-消息中间件的类型"><a href="#8-2-消息中间件的类型" class="headerlink" title="8.2 消息中间件的类型"></a>8.2 消息中间件的类型</h3><ul>
<li><p>分布式消息中间件：RabbitMQ、Kafka</p>
</li>
<li><p>负载均衡中间件：Nginx</p>
</li>
<li><p>缓存中间件：Redis</p>
</li>
<li><p>数据库中间件：Mycat、shardingJdbc</p>
<p>  注意：消息分发模式中从资源的角度看：轮训模式是绝对公平(能者多劳)，公平模式是相对公平(人人平等)</p>
</li>
</ul>
<h3 id="8-3-RabbitMQ消息中间件"><a href="#8-3-RabbitMQ消息中间件" class="headerlink" title="8.3 RabbitMQ消息中间件"></a>8.3 RabbitMQ消息中间件</h3><blockquote>
<p>异步编程，流量削峰；高内聚，低耦合：</p>
<p>本地若串行执行会阻塞；本地异步需要占用线程池线程，涉及线程池的维护，若执行错误会涉及IO流存储信息。如上操作都会造成耦合。剥离出中间件操作则解决如上问题，保证了效率和资源</p>
<p>1.rabbitmq的队列中可以单队列接受多个路由key消息，也可以单路由key发送多队列消息，需设置交换机类型为direct<br>2.fanout类型是对所有队列进行发布<br>3.topic是路由key的模糊匹配，#.order.#、* .course. *：其中#为匹配路由键级数&gt;=0个时都符合， *为匹配路由键级数仅=1个时才符合</p>
<p>rabbitmq学习就分两步，学习原理流程图及springboot模式的应用方式。</p>
</blockquote>
<ul>
<li><p>RabbitMQ原理流程图</p>
<p>  <img src="D:/App/Typora/TyporaSource/Private/Java基础/RabbitMQ中间件工作流程.png"></p>
<p>  实现步骤</p>
<ol>
<li><p>Producer</p>
</li>
<li><p>Connection</p>
</li>
<li><p>Broker(RabbitMQ服务端)</p>
<ul>
<li><p>Exchange交换机</p>
<blockquote>
<p>Type</p>
<ol>
<li>fanout全匹配模式：对所有队列发布message</li>
<li>direct路由模式：对标记了指定routerkey的队列发送message，同时是代码中的默认模式</li>
<li>topic模糊匹配模式：topic是路由key的模糊匹配，#.order.#、* .course. *：其中#为匹配路由键级数&gt;=0个时都符合， *为匹配路由键级数仅=1个时才符合</li>
<li>header参数匹配模式：匹配args，类似direct模式</li>
</ol>
</blockquote>
</li>
<li><p>Routerkey路由键</p>
</li>
<li><p>Bindings绑定关系：将Quene绑定到Exchange</p>
</li>
</ul>
</li>
<li><p>Connection</p>
</li>
<li><p>Consumer</p>
</li>
</ol>
</li>
<li><p>RabbitMQ支持的消息格式</p>
<blockquote>
<p>本质是依据交换机的模式而定义的</p>
</blockquote>
<ol>
<li>模式<ul>
<li>Fanout模式</li>
<li>Direct模式</li>
<li>Topic模式</li>
</ul>
</li>
<li>其他<ul>
<li>队列或消息的失效时间属性ttl</li>
<li>死信队列</li>
</ul>
</li>
</ol>
</li>
<li><p>RabbitMQ内存与磁盘上限的设置</p>
</li>
<li></li>
</ul>
<h1 id="三、设计基础"><a href="#三、设计基础" class="headerlink" title="三、设计基础"></a>三、设计基础</h1><h2 id="1-23种设计模式"><a href="#1-23种设计模式" class="headerlink" title="1. 23种设计模式"></a>1. 23种设计模式</h2><blockquote>
<ul>
<li><p>设计模式的本质：面向对象设计原则的实际运用，是对类的封装性、继承性和多态性以及类的关联关系和组合关系的充分理解</p>
</li>
<li><p>设计模式分三类</p>
<ol>
<li>创建型模式：单例模式, 工厂模式, 抽象工厂模式, 建造者模式, 原型模式；</li>
<li>结构型模式：适配器模式, 桥接模式,  代理模式，装饰模式, 组合模式, 外观模式, 享元模式；</li>
<li>行为型模式：模板方法模式, 命令模式, 迭代器模式, 观察者模式, 中介者模式, 备忘录模式, 解释器模式, 状态模式, 策略模     式, 职责链模式, 访问者模式；</li>
</ol>
</li>
<li><p>OOP面向对象程序设计(Object Oriented Programming)七大原则</p>
<ol>
<li>开闭原则：对扩展开放, 对修改关闭（新增功能时，只新增代码，不修改代码）</li>
<li>里氏替换原则:：继承必须确保超类所拥有的性质在子类中仍然成立</li>
<li>依赖倒置原则: ：要面向接口编程, 不要面向实现编程</li>
<li>单一职责原则： 控制类的粒度大小, 将对象解耦, 提高其内聚性</li>
<li>接口隔离原则：要为各个类建立它们需要的专用接口</li>
<li>迪米特法则：只与你的直接朋友交谈,不跟”陌生人”说话</li>
<li>合成复用原则：尽量先使用组合或者聚合等关联关系实现,其次才考虑使用继承关系来实现</li>
</ol>
</li>
<li><p>类继承和对象组合是复用的两种最常用的技术</p>
<ol>
<li><p>类继承：继承是Is a 的关系，也就是Student继承Person,则说明Student is a Person</p>
 <details>
     <summary>详细说明</summary>
     优点
     <ol type="1">
     <li>子类可以重写父类的方法来方便地实现对父类的扩展。</li>
     </ol>
     缺点
     <ol type="1">
     <li>父类的内部细节对子类是可见的。</li>
     <li>子类从父类继承的方法在编译时就确定下来了，所以无法在运行期间改变从父类继承的方法的行为。</li>
     <li>如果对父类的方法做了修改的话（比如增加了一个参数），则子类的方法必须做出相应的修改。所以说子类与父类是一种高耦合，违背了面向对象思想。</li>
     </ol>
 </details></li>
<li><p>对象组合：组合是has a的关系，也就是设计类的时候把要组合的类的对象加入到该类中作为自己的成员变量，希望注入什么对象就组合什么对象</p>
 <details>
     <summary>详细说明</summary>
     优点
     <ol type="1">
     <li>当前对象只能通过所包含的那个对象去调用其方法，所以所包含的对象的内部细节对当前对象时不可见的。</li>
     <li>当前对象与包含的对象是一个低耦合关系，如果修改包含对象的类中代码不需要修改当前对象类的代码。</li>
     <li>当前对象可以在运行时动态的绑定所包含的对象。可以通过set方法给所包含对象赋值。</li>
     </ol>
     缺点
     <ol type="1">
     <li>容易产生过多的对象。</li>
     <li>为了能组合多个对象，必须仔细对接口进行定义。</li>
     </ol>
     总结：组合比继承更具灵活性和稳定性，所以在设计的时候优先使用组合。只有当下列条件满足时才考虑使用继承：<br />
     <ol type="1">
     <li>子类是一种特殊的类型，而不只是父类的一个角色</li>
     <li>子类的实例不需要变成另一个类的对象。</li>
     <li>子类扩展，而不是覆盖或者使父类的功能失效。</li>
     </ol>
 </details> </li>
</ol>
</li>
<li><p>GoF设计模式：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/adamjwh/category/1215890.html">https://www.cnblogs.com/adamjwh/category/1215890.html</a></p>
</li>
</ul>
</blockquote>
<h3 id="1-1-单例模式"><a href="#1-1-单例模式" class="headerlink" title="1.1 单例模式"></a>1.1 单例模式</h3><blockquote>
<p>设计核心：即一个类只有一个对象实例</p>
</blockquote>
<ul>
<li><p>经典单例</p>
<blockquote>
<p>可被反射机制破解：都可被外界使用反射机制 调用构造器或修改标识位 来达到外部创建单例的目的，破坏其封装性；并且单例使用时建议以无状态变量(无标识位)来使用，即以工具类来使用；</p>
</blockquote>
<ol>
<li><p>饿汉式</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 饿汉使单例模式</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hungry</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Hungry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 可能会浪费空间。由于static特性，开辟了空间，却没有使用</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">Hungry</span> HUNGRY <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hungry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Hungry</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> HUNGRY<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>懒汉式</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyMan</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> lazyMan<span class="token punctuation">;</span>
    
    <span class="token comment">// 需要使用时才加载内存</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lazyMan<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            lazyMan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> lazyMan<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 1、2点都不适合多线并发开发，仅适合单线程</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
                <span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>DCL(Double Check Lock)懒汉式：双重检测锁模式的懒汉式单例</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyMan</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token comment">// volatile关键字保证可见性、禁止指令重排序 </span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> lazyMan<span class="token punctuation">;</span>

    <span class="token comment">// 双重检测锁模式的懒汉式单例 </span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lazyMan<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">// synchronized加锁解决多线程下的问题</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>lazyMan <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                    <span class="token comment">// 如下不是一个原子性操作，即可分割操作，但步骤不能保证100%按顺序执行；</span>
                    <span class="token comment">// 若是原子性，就一个步骤达到实现效果，就不存在内部执行顺序的问题；</span>
                    lazyMan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> lazyMan<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*
    * lazyMan = new LazyMan()从字节码角度分如下三步骤 
    *    |字节码角度分析构造对象 https://blog.csdn.net/qq_15038565/article/details/106981553
    * 1. 分配new LazyMan()(空对象1)的内存空间，此作为模板
    *    |new—创建一个对象，并将其引用值压入栈顶。
    * 2、创造需要初始化的对象，注意区分空'空对象1'和'空对象2'
    *    |复制栈顶一个字长的数据，将复制后的数据压栈(复制'空对象1'，此命名为空对象2)。
    * 3. 通过构造器对'初始化对象'初始化
    *    |具体的初始化逻辑，作用在'空对象2'而不是'空对象1'
    * 4、把这个对象引用lazyMan指向栈顶元素中的内存空间
    *    
    * 若无volatile关键字修饰，则一个不是原子性操作的内部指令排序可能会被打乱，有则保证有序性，如下：
    * 正常顺序）1(23)4 =>正常构造一个对象
    * 错误顺序1) 1243 => 在当前线程中仍可以正常构造对象并返回，但因其顺序改变，导致其他线程非加锁逻辑出现错误判断
    *    |如if(lazyMan==null)是不需要加锁的逻辑，而多线程中其他线程却可以执行该逻辑。因提前给对象引用指向内存地
    *    |址，导致对象引用不为null，但对象因顺序问题未及时赋值为null，导致返回对象引用的结果为null，即在多线程中
    *    |若在此瞬间其他线程执行了if(lazyMan==null)，则会发生NPE异常；
    * 错误顺序2）1423) =>可以走完正常构造对象步骤，然后释放锁，但当前线程lazyMan对象引用内存储内存地址是的是空
    *    |对象1，而实际存值的是空对象2，导致返回的空对象，发生NPE异常；
    * 总结：实际中，1、2操作是简单操作，执行顺序完全不会乱，而3是复杂的初始化，与4可能发生混乱；换言之，由于没有
    *    |原子性保障，理论上1是可以第四步执行的，但实际中100%不会发生，故错误顺序2是不会发生的，但错误顺序1可能；
    * 第3个线程）123 =>由于上一个2是最后执行的，导致已初始化对象
    *
    * */</span>

    <span class="token comment">// 多线程并发</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
                <span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>静态内部类</p>
</li>
</ol>
</li>
</ul>
<pre><code>    <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ph<span class="token punctuation">.</span>single</span><span class="token punctuation">;</span>

<span class="token comment">// 静态内部类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Holder</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 构造器私有</span>
    <span class="token keyword">private</span> <span class="token class-name">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Holder</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">InnerClass</span><span class="token punctuation">.</span>HOLDER<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Holder</span> HOLDER <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Holder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

5. 利用红绿灯(标识位)防止反射调用构造器创建对象（但可被反编译获取标识位，再修改标识位破解）；

    <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//单例懒汉式</span>
<span class="token comment">//懒汉式单例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyMan</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> qingjiang <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//红绿等解决通过反射创建对象（反编译可以破解该方法）</span>
    <span class="token keyword">private</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>qingjiang<span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                qingjiang <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"不要试图使用反射破坏单例"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> lazyMan<span class="token punctuation">;</span><span class="token comment">//volatile避免指令重排</span>

    <span class="token comment">//双重检测锁模式的懒汉式单例(由原本的双检查null 到 先检查null，后检查标识位)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyMan</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>lazyMan<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            lazyMan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyMan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不是一个原子性操作</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> lazyMan<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token comment">// 反射破解</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//LazyMan instance = LazyMan.getInstance();</span>
    <span class="token class-name">Field</span> qingjiang <span class="token operator">=</span> <span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"qingjiang"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qingjiang<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LazyMan</span><span class="token punctuation">></span></span> declaredConstructor <span class="token operator">=</span> <span class="token class-name">LazyMan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//无视私有的构造器</span>
    <span class="token class-name">LazyMan</span> instance1 <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qingjiang<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>instance1<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LazyMan</span> instance2 <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre>
<ul>
<li><p>解决办法(枚举单例)</p>
<blockquote>
<p>枚举：通过反射破解枚举发现不成功：<br>1、普通的反编译会欺骗开发者，说enum枚举是无参构造<br>2、实际enum为有参构造（见后面反编译工具jad，通过使用命令：jad -sjava example1.class）；<br>3、通过反射破解枚举会发现抛出异常<br>Exception in thread “main” java.lang.IllegalArgumentException: Cannot reflectively create enum objects at java.lang.reflect.Constructor.newInstance(Constructor.java:417) at com.ph.single.Test.main(EnumSingle.java:19)</p>
</blockquote>
<ol>
<li><p>枚举单例</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//enmu是什么？本身也是一个class类</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">EnumSingle</span> <span class="token punctuation">&#123;</span>
    INSTANCE<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">EnumSingle</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">EnumSingle</span> instance <span class="token operator">=</span> <span class="token class-name">EnumSingle</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnumSingle</span><span class="token punctuation">></span></span> declaredConstructor <span class="token operator">=</span> <span class="token class-name">EnumSingle</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EnumSingle</span> instance2 <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//java.lang.NoSuchMethodException: com.ph.single.EnumSingle.&lt;init>()</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>分析问题</p>
<ul>
<li><p>构造器有无参问题</p>
<blockquote>
<p>通过反编译工具来找出真正有无参构造器</p>
</blockquote>
<ol>
<li><p>Idea自带jdk的反编译工具(javap -p class文件全名)，实际结果是欺骗开发者<br> <img src="D:/App/Typora/TyporaSource/Private/Java基础/Jdk反编译枚举类.png"></p>
</li>
<li><p>使用专业反编译工具Jad，真正的结果，含参构造器</p>
 <img src="D:/App/Typora/TyporaSource/Private/Java基础/Jad反编译枚举类.png" style="zoom:80%;" /></li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>拓展：单例模式不一定全局唯一<ol>
<li>在分布式系统中，会有多个JVM虚拟机，各自虚拟机中都有一个实例，即正常情况下有多个实例；</li>
<li>一个JVM虚拟机的使用多个类加载器加载这个类，产生多个实例；</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="1-2-工厂模式"><a href="#1-2-工厂模式" class="headerlink" title="1.2 工厂模式"></a>1.2 工厂模式</h3><blockquote>
<p>设计核心：实例化对象不使用new, 用工厂方法代替，将选择实现类, 创建对象统一管理和控制. 从而将调用者跟我们的实现类解耦</p>
</blockquote>
<ul>
<li><p>简单工厂模式</p>
<blockquote>
<p>用来生产统一等级结构中的任意产品(增加新的产品,需要覆盖已有代码)。<strong>即不符开闭原则，逻辑清晰但工程量大时不利于维护</strong></p>
<ul>
<li>仅对 具体类Car 进行抽象化处理</li>
</ul>
</blockquote>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tesla</span> <span class="token keyword">implements</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"特斯拉"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WuLing</span> <span class="token keyword">implements</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"五菱宏光"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>工厂类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 静态工厂模式：增加一个新的产品需修改代码做</span>
    
    <span class="token comment">// 方法一</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Car</span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token class-name">String</span> car<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>car<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"五菱宏光"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WuLing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>car<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"特斯拉"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Tesla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 方法二</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Car</span> <span class="token function">getWuLing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WuLing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Car</span> <span class="token function">getTesla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Tesla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>执行类（消费类）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 接口，所有实现类</span>
        <span class="token class-name">Car</span> wuLing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WuLing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Car</span> tesla <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tesla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wuLing<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tesla<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        wuLing<span class="token operator">=</span><span class="token class-name">CarFactory</span><span class="token punctuation">.</span><span class="token function">getCar</span><span class="token punctuation">(</span><span class="token string">"五菱宏光"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tesla<span class="token operator">=</span><span class="token class-name">CarFactory</span><span class="token punctuation">.</span><span class="token function">getCar</span><span class="token punctuation">(</span><span class="token string">"特斯拉"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wuLing<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tesla<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>工厂方法模式</p>
<blockquote>
<p>用来生产同一等级结构中的固定产品(支持增加任意产品)。<strong>即符合开闭原则，便于维护但工程量大时因为类的数量较多而不利于维护</strong></p>
<ul>
<li>对 具体类Car、具体类CarFactory 进行抽象化处理。即将工厂类变更到接口实现类中，宏观上层数减少，但微观上类的数量变多；</li>
<li>工厂方法模式与抽象工厂附魔书的区别<br>  区别在于产品，如果产品单一，最合适用工厂模式，但是如果有多个业务品种、业务分类时，通过抽象工厂模式产生需要的对象是一种非常好的解决方式。再通俗深化理解下：工厂模式针对的是一个产品等级结构 ，抽象工厂模式针对的是面向多个产品等级结构的。</li>
</ul>
</blockquote>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//工厂方法模式</span>
    <span class="token class-name">Car</span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tesla</span> <span class="token keyword">implements</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"特斯拉"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeslaFactory</span> <span class="token keyword">implements</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Tesla</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WuLing</span> <span class="token keyword">implements</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"五菱宏光"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WuLingFactory</span> <span class="token keyword">implements</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WuLing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>执行端（消费类）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kuang<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>method</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kuang<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">CarFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kuang<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">Tesla</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>kuang<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">WuLing</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//接口，所有实现类</span>
        <span class="token class-name">Car</span> wuLing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WuLingFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Car</span> tesla <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeslaFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wuLing<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tesla<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token comment">//结构复杂度: simple</span>
<span class="token comment">//代码复杂度: simple</span>
<span class="token comment">//编程复杂度: simple</span>
<span class="token comment">//管理上的复杂度: simple</span>
<span class="token comment">//根据设计原则:工厂方法模式!</span>
<span class="token comment">//根据实际业务:简单工厂模式!</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>抽象工厂模式</p>
<blockquote>
<p>围绕一个超级工厂创建其他工厂, 该超级工厂又称为其他工厂的工厂。<strong>即便于维护且工程量大时也便于查找类，但类的数量较多</strong></p>
<ul>
<li>对 具体类（Car类、CarFactory类）这个概念 进行抽象化处理，万物皆产品，不分车与房；</li>
<li>导致接口类抽象化、接口实现类抽象化，即都增加一层用于封装抽象化；  <img src="D:/App/Typora/TyporaSource/Private/Java基础/抽象工厂模式UML类图.png" style="zoom:67%;" /></li>
</ul>
</blockquote>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//手机产品接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPhoneProduct</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//路由器产品接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRouterProduct</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">openWifi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//抽象产品工厂</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IProductFactory</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//生产手机</span>
    <span class="token class-name">IPhoneProduct</span> <span class="token function">iPhoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//生产路由器</span>
    <span class="token class-name">IRouterProduct</span> <span class="token function">iRouterProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiPhone</span> <span class="token keyword">implements</span> <span class="token class-name">IPhoneProduct</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米开机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米关机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米打电话"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米发信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiRouter</span> <span class="token keyword">implements</span> <span class="token class-name">IRouterProduct</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米开启路由器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米关闭路由器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openWifi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米开启Wifi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小米设置路由器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IProductFactory</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IPhoneProduct</span> <span class="token function">iPhoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XiaomiPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IRouterProduct</span> <span class="token function">iRouterProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XiaomiRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>执行端（执行端）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=================小米系列产品=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XiaomiFactory</span> xiaomiFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XiaomiFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IPhoneProduct</span> iPhoneProduct <span class="token operator">=</span> xiaomiFactory<span class="token punctuation">.</span><span class="token function">iPhoneProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iPhoneProduct<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IRouterProduct</span> iRouterProduct <span class="token operator">=</span> xiaomiFactory<span class="token punctuation">.</span><span class="token function">iRouterProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iRouterProduct<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-3-建造者模式"><a href="#1-3-建造者模式" class="headerlink" title="1.3 建造者模式"></a>1.3 建造者模式</h3><blockquote>
<p>设计核心;本质上与JavaWeb端的开发三层架构类似，Pojo实体-Product、Dao层-Builder、Service层-Director、没有Controller层，都是为了解耦、分层封装底层逻辑，其中建造者模式的思想在Worker类中体现比较明显；</p>
</blockquote>
<ul>
<li><p>建造者模式</p>
<ol>
<li><p>Product（实体层）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//产品，房子</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> builderA<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> builderB<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> builderC<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> builderD<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuilderA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> builderA<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuilderA</span><span class="token punctuation">(</span><span class="token class-name">String</span> builderA<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builderA <span class="token operator">=</span> builderA<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuilderB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> builderB<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuilderB</span><span class="token punctuation">(</span><span class="token class-name">String</span> builderB<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builderB <span class="token operator">=</span> builderB<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuilderC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> builderC<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuilderC</span><span class="token punctuation">(</span><span class="token class-name">String</span> builderC<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builderC <span class="token operator">=</span> builderC<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuilderD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> builderD<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuilderD</span><span class="token punctuation">(</span><span class="token class-name">String</span> builderD<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builderD <span class="token operator">=</span> builderD<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Product&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"builderA='"</span> <span class="token operator">+</span> builderA <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", builderB='"</span> <span class="token operator">+</span> builderB <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", builderC='"</span> <span class="token operator">+</span> builderC <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", builderD='"</span> <span class="token operator">+</span> builderD <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Builder（Dao层接口）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//抽象的建造者：方法</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">builderA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//地基</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">builderB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//钢筋工程</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">builderC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//铺电线</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">builderD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//粉刷</span>

    <span class="token comment">//完工：得到产品</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Worker（Dao层实现类）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//具体的建造者：工人</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>
    
	<span class="token comment">// 建造者模式的核心区分点在Worker类</span>
    <span class="token keyword">private</span> <span class="token class-name">Product</span> product<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">builderA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuilderA</span><span class="token punctuation">(</span><span class="token string">"地基"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"地基"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">builderB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuilderB</span><span class="token punctuation">(</span><span class="token string">"钢筋工程"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"钢筋工程"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">builderC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuilderC</span><span class="token punctuation">(</span><span class="token string">"铺电线"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"铺电线"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">builderD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuilderD</span><span class="token punctuation">(</span><span class="token string">"粉刷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"粉刷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Director（Service层）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 指挥：核心，负责指挥构建一个工程，工程如何构建，由它决定</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 指挥工人按照顺序建房子</span>
    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        builder<span class="token punctuation">.</span><span class="token function">builderA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">builderB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">builderC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">builderD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//指挥</span>
        <span class="token class-name">Director</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指挥具体的工人完成产品</span>
        <span class="token class-name">Product</span> build <span class="token operator">=</span> director<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>无Director层的建造者模式（链式调用）</p>
<ol>
<li><p>Product</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//产品：套餐</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">BuildA</span> <span class="token operator">=</span><span class="token string">"汉堡"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">BuildB</span> <span class="token operator">=</span><span class="token string">"可乐"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">BuildC</span> <span class="token operator">=</span><span class="token string">"薯条"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">BuildD</span> <span class="token operator">=</span><span class="token string">"甜点"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuildA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">BuildA</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuildA</span><span class="token punctuation">(</span><span class="token class-name">String</span> buildA<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BuildA</span> <span class="token operator">=</span> buildA<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuildB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">BuildB</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuildB</span><span class="token punctuation">(</span><span class="token class-name">String</span> buildB<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BuildB</span> <span class="token operator">=</span> buildB<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuildC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">BuildC</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuildC</span><span class="token punctuation">(</span><span class="token class-name">String</span> buildC<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BuildC</span> <span class="token operator">=</span> buildC<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBuildD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">BuildD</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBuildD</span><span class="token punctuation">(</span><span class="token class-name">String</span> buildD<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BuildD</span> <span class="token operator">=</span> buildD<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Product&#123;"</span> <span class="token operator">+</span>
                <span class="token string">"BuildA='"</span> <span class="token operator">+</span> <span class="token class-name">BuildA</span> <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", BuildB='"</span> <span class="token operator">+</span> <span class="token class-name">BuildB</span> <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", BuildC='"</span> <span class="token operator">+</span> <span class="token class-name">BuildC</span> <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">", BuildD='"</span> <span class="token operator">+</span> <span class="token class-name">BuildD</span> <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
                <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Builder</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//建造者</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Builder</span> <span class="token class-name">BuildA</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"汉堡";</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Builder</span> <span class="token class-name">BuildB</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"可乐";</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Builder</span> <span class="token class-name">BuildC</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"薯条";</span>
    <span class="token keyword">abstract</span> <span class="token class-name">Builder</span> <span class="token class-name">BuildD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//"甜点";</span>

    <span class="token keyword">abstract</span> <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Worker</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">Product</span> product<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Builder</span> <span class="token class-name">BuildA</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuildA</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Builder</span> <span class="token class-name">BuildB</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuildB</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Builder</span> <span class="token class-name">BuildC</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuildC</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Builder</span> <span class="token class-name">BuildD</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        product<span class="token punctuation">.</span><span class="token function">setBuildD</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Product</span> <span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> product<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//服务员</span>
        <span class="token class-name">Worker</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//可以按默认走，也可以自由组合</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">worker<span class="token punctuation">.</span></span>BuildA</span><span class="token punctuation">(</span><span class="token string">"全家桶"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">BuildB</span><span class="token punctuation">(</span><span class="token string">"雪碧"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-4-原型模式"><a href="#1-4-原型模式" class="headerlink" title="1.4 原型模式"></a>1.4 原型模式</h3><blockquote>
<p>设计核心：使用clone()方法来创建重复对象，同时又能保证性能。因为Object.clone()方法是C/C++编写的(native)，效率比 Java的IO流或new高，故建议此代替new等操作；</p>
<ul>
<li>被复制的类需要实现Clonable接口，本身类对象才能调用clone方法；</li>
<li>clone()方法有浅拷贝(仅引用指向)，深拷贝(真正复制为副本)</li>
</ul>
</blockquote>
<ul>
<li><p>浅拷贝原型模式</p>
<ol>
<li><p>实体类（仅Person实现Cloneable接口）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Happyjava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Address</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"浙江杭州"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span> newPerson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> person<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person <span class="token operator">==</span> newPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> newPerson<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>输出结果<br> 通过 == 比较是否是同一个对象（判断内存地址）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token boolean">false</span>
<span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 说明了通过clone方法拷贝出来的对象，与原对象并不是同一个对象。而person.getAddress() == newPerson.getAddress() 的比较是true，说明了二者的引用都是指向同一个对象。这就是浅拷贝，引用类型还是指向原来的对象，修改person的属性，newPerson的属性也会跟着一起改。</p>
</li>
</ol>
</li>
<li><p>深拷贝原型模式</p>
<ol>
<li><p>实体类（两者都实现Cloneable接口）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Person</span> newPerson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newPerson<span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newPerson<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类（同上）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Happyjava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Address</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"浙江杭州"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Person</span> newPerson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> person<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person <span class="token operator">==</span> newPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> newPerson<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>输出结果</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token boolean">false</span>
<span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>序列化实现深拷贝原型模式</p>
<blockquote>
<p>通过clone方法实现深拷贝是比较麻烦的一件事情，这里推荐大家可以通过序列化、反序列化的方式实现深拷贝。我们可以直接使用commons-lang3包的序列化、反序列工具类。</p>
</blockquote>
<ol>
<li><p>引入依赖</p>
 <pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>序列化需要实现Serializable接口，Person和Address类都需要实现</p>
</li>
<li><p>测试</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Happyjava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Address</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    address<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"浙江杭州"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 序列化</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> serialize <span class="token operator">=</span> <span class="token class-name">SerializationUtils</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 反序列化</span>
    <span class="token class-name">Person</span> newPerson <span class="token operator">=</span> <span class="token class-name">SerializationUtils</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>serialize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person <span class="token operator">==</span> newPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> newPerson<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>结果同深拷贝一样</p>
</li>
</ol>
</li>
</ul>
<h3 id="1-5-适配器模式"><a href="#1-5-适配器模式" class="headerlink" title="1.5 适配器模式"></a>1.5 适配器模式</h3><blockquote>
<p>设计核心：将一个类的接口变换成客户端所期待的另一种接口，使得原本因接口不匹配而无法一起工作的两个类能够一起工作。<strong>换言之</strong>，适配器即帮助 适配类 获取 被适配类的具体功能，适配类本身不具有此具体功能，因此需要做 适配 的操作，才能间接的调用被适配类的具体功能，达到一起工作的目的。</p>
<ul>
<li>电脑使用USB接口通过适配器接上网线的WALAN接口，实现电脑能够上网的功能（上网的功能是网线的，电脑只是适配接口后才能够调用网线的上网功能），举例如下</li>
</ul>
</blockquote>
<ul>
<li><p>对象适配器模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 被适配的类：网线（因为网线具有上网的功能，电脑主动去连接网线，网线是被动的对象）</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"连接网线上网"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 电脑想通过适配得到的抽象功能，即希望适配器具有具体上网的功能</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NetToUsb</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 作用:处理请求，网线=>usb</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 真正的适配器，对象适配器中仅默认电脑USB口接入适配器中，还需插入网线</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adapter2</span> <span class="token keyword">implements</span> <span class="token class-name">NetToUsb</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//组合模式</span>
    <span class="token keyword">private</span> <span class="token class-name">Adaptee</span> adaptee<span class="token punctuation">;</span>
	<span class="token comment">// 通过构造器将具有具体上网功能的网线插入到适配器</span>
    <span class="token keyword">public</span> <span class="token class-name">Adapter2</span><span class="token punctuation">(</span><span class="token class-name">Adaptee</span> adaptee<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>adaptee <span class="token operator">=</span> adaptee<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 由于网线插入到适配器中，</span>
        <span class="token comment">// 此时将具体的上网功能放入到 电脑想适配得到的功能中(抽象功能的具体实现)，来实现具体的上网功能</span>
        <span class="token comment">// 此时适配器的抽象功能已具备具体的上网功能，剩下就差电脑连接上适配器，电脑就可以上网；</span>
        adaptee<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试(电脑端)</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 客户端关: 想上:网，插不L:网线~</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 适配器已提前插入电脑的USB口，现需通过适配来调用具体的上网功能</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">net</span><span class="token punctuation">(</span><span class="token class-name">NetToUsb</span> adapter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 将适配器的具体上网功能放在Computer类中的方法内，即电脑通过已连接上USB口的适配器来调用适配器的功能</span>
        adapter<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 电脑，网线，适配器，</span>
        <span class="token class-name">Computer</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token class-name">Adaptee</span> adaptee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// 将网线插入 已插入电脑USB口的适配器 中</span>
        <span class="token class-name">Adapter2</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter2</span><span class="token punctuation">(</span>adaptee<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
        <span class="token comment">// 将 已插入网线、USB口的适配器对象 拿来给电脑调用具体上网功能；</span>
        computer<span class="token punctuation">.</span><span class="token function">net</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>类的适配器模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 被适配的类：网线（因为网线具有上网的功能，电脑主动去连接网线，网线是被动的对象）</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adaptee</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"连接网线上网"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 电脑想通过适配得到的抽象功能，即希望适配器具有具体上网的功能</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NetToUsb</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 作用:处理请求，网线=>usb</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口继承实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//真正的适配器，类的适配器中默认网线和电脑的USB口接入到适配器中，此时不再 需要插入网线或USB口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Adapter</span> <span class="token keyword">extends</span> <span class="token class-name">Adaptee</span> <span class="token keyword">implements</span> <span class="token class-name">NetToUsb</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//上网的具体实现，找一个转接头</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试（电脑端）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//客户端关: 想上:网，插不L:网线~</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//我们的电脑需要连接:转换器才可以:网</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">net</span><span class="token punctuation">(</span><span class="token class-name">NetToUsb</span> adapter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//.上网的具体实现， 找个转换器</span>
        adapter<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//电脑，适配器，网线~</span>
        <span class="token class-name">Computer</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//电脑</span>
        <span class="token class-name">Adaptee</span> adaptee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//网线</span>
        <span class="token class-name">Adapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转按器</span>
        
        <span class="token comment">// 由于适配器已经插入网线和电脑的USB口，即直接通过电脑调用具体的上网方法即可</span>
        computer<span class="token punctuation">.</span><span class="token function">net</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-6-桥接模式"><a href="#1-6-桥接模式" class="headerlink" title="1.6 桥接模式"></a>1.6 桥接模式</h3><blockquote>
<p>设计核心：桥接模式是将抽象部分与它的实现部分进行二元分离, 使他们都可以独立地变化, 它是一种对象结构型模式, 又称为柄体(Handle and Body)模式或接口(Interface)模式，若不能二元分离，则可尝试适配器模式强行发生关系再二元分离。</p>
<details>
 <summary>详细说明</summary>
 优点
 <ol type="1">
 <li>桥接模式偶尔类似于多继承方案，但是多继承方案违背了类的单一职责原则，复用性比较差，类的个数也非常多，桥接模式是比多继承方案更好的解决方法。极大的减少了子类的个数，从而降低管理和维护的成本。</li>
 <li>桥接模式提高了系统的可扩充性，在两个变化维度中任意扩展一个维度，都不需要修改原有系统。符合开闭原则，就像一座桥，可以把两个变化的维度连接起来!</li>    
    </ol>
 缺点
 <ol type="1">
 <li>桥接模式的引入会增加系统的理解与设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计与编程。</li>
 <li>桥接模式要求正确识别出系统中两个独立变化的维度，因此其使用范围具有一定的局限性.</li>
    </ol>
 实践
 <ol type="1">
 <li>如果一个系统需要在构建的抽象化角色和具体化角色之间增加更多的灵活性，避免在两个层次之间建立静态的继承联系，通过桥接模式可以使它们在抽象层建立一个关联关系。抽象化角色和实现化角色可以以继承的方式独立扩展而互不影响，在程序运行时可以动态将一个抽象化子类的对象和一个实现化子类的对象进行组合，即系统需要对抽象化角色和实现化角色进行动态耦合。</li>
 <li>一个类存在两个独立变化的维度，且这两个维度都需要进行扩展。</li>
 <li>虽然在系统中使用继承是没有问题的，但是由于抽象化角色和具体化角色需要独立变化，设计要求需要独立管理这两者。对于那些不希望使用继承或因为多层次继承导致系统类的个数急剧增加的系统，桥接模式尤为适用。</li>    
    </ol>
 场景
 <ol type="1">
 <li>Java语言通过Java虚拟机实现了平台的无关性。</li>
 <li>JDBC驱动程序也是桥接模式的应用之一。</li>
    </ol>
</details>


<ul>
<li>以品牌, 类型为例，二元分电脑类型和电脑品牌  <img src="D:/App/Typora/TyporaSource/Private/Java基础/桥接模式代码示例图.png" style="zoom: 50%;" /></li>
</ul>
</blockquote>
<ul>
<li><p>桥接模式</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//品牌：品牌是抽象部分且有多种，故将其抽象化为接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Brand</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//联想品牌</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lenovo</span> <span class="token keyword">implements</span> <span class="token class-name">Brand</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"联想"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//联想品牌</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token keyword">implements</span> <span class="token class-name">Brand</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"苹果"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象的电脑类型类：电脑是实现部分，故组合抽象部分，又因为具体实现是对组合后的类进行继承且拓展，故使用继承</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//组合，品牌~</span>
    <span class="token keyword">protected</span> <span class="token class-name">Brand</span> brand<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token class-name">Brand</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//自带品牌</span>
        brand<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token punctuation">&#125;</span>
<span class="token comment">// 通过继承的特性，对子类进行功能的拓展，即构造时指定何种机子子类、传参何种品牌</span>
<span class="token keyword">class</span> <span class="token class-name">Desktop</span> <span class="token keyword">extends</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Desktop</span><span class="token punctuation">(</span><span class="token class-name">Brand</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"台式机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Laptop</span> <span class="token keyword">extends</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Laptop</span><span class="token punctuation">(</span><span class="token class-name">Brand</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"笔记本"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//苹果管记本</span>
        <span class="token class-name">Computer</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Laptop</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Apple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        computer<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//联想台式机</span>
        <span class="token class-name">Computer</span> computer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Desktop</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Lenovo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        computer2<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>代码流程图</p>
 <img src="D:/App/Typora/TyporaSource/Private/Java基础/桥接模式代码图.png" style="zoom: 67%;" /></li>
</ol>
</li>
</ul>
<h3 id="1-7-代理模式"><a href="#1-7-代理模式" class="headerlink" title="1.7 代理模式"></a>1.7 代理模式</h3><blockquote>
<p>设计核心：除了静态代理类体现的代理思想理论上助于理解，实践中更建议使用 JDK代理类和CGLIB三方代理类；如果目标对象实现了接口，建议采用JDK的动态代理实现AOP ，反之使用CGLIB代理。</p>
<details>
 <summary>详细说明</summary>
 优点
 <ol type="1">
 <li>可以使真实角色的操作更加纯粹,不用去关注一些公共的业务</li>
 <li>公共也就交给代理角色,实现了业务的分工</li>
 <li>公共业务发生扩展的时候,方便集中管理</li>      
    </ol>
 缺点
 <ol type="1">
 <li>一个真实角色就会产生一个代理角色,代码量会翻倍,开发效率会变低</li>
    </ol>
 JDK动态代理和CGLIB字节码生成的区别？
 <ol type="1">
 <li>JDK动态代理只能对实现了接口的类生成代理，而不能针对类</li>
 <li>CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法，因为是继承，所以该类或方法最好不要声明成final </li>    
 如何强制使用CGLIB实现AOP？
 <ol type="1">
 <li>添加CGLIB库，SPRING_HOME/cglib/*.jar</li>
 <li>在spring配置文件中加入<aop:aspectj-autoproxy proxy-target-class="true"/> </li>        
    </ol>
</details>


<ul>
<li>Jdk和Cglib 代理的区别和实现  <a target="_blank" rel="noopener" href="https://www.cnblogs.com/leifei/p/8263448.html">https://www.cnblogs.com/leifei/p/8263448.html</a></li>
</ul>
</blockquote>
<ul>
<li><p>静态代理</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Rent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//房东</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Host</span> <span class="token keyword">implements</span> <span class="token class-name">Rent</span><span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"房东要出租房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//代理</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Rent</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Host</span> host<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">Host</span> host<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        host<span class="token punctuation">.</span><span class="token function">rent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">seeHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hetong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//看房</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">seeHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"中介带你看房"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//收中介费</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收中介费"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//签合同</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hetong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"签合同"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//房东要租房子</span>
        <span class="token class-name">Host</span> host <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Host</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//代理,中介帮房东租房子,但是 代理一般会有一些附属操作</span>
        <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//不用面对房东,直接找中介租房即可</span>
        proxy<span class="token punctuation">.</span><span class="token function">rent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>JDK动态代理(万能动态代理)</p>
<blockquote>
<p>java动态代理是利用反射机制生成一个实现代理接口的匿名类，在调用具体方法前调用InvokeHandler来处理。</p>
</blockquote>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//用户管理接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserManager</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//新增用户抽象方法</span>
    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span><span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//删除用户抽象方法</span>
    <span class="token keyword">void</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//用户管理实现类,实现用户管理接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManagerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserManager</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//重写新增用户方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了新增的方法！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"传入参数为 userName: "</span><span class="token operator">+</span>userName<span class="token operator">+</span><span class="token string">" password: "</span><span class="token operator">+</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//重写删除用户方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"调用了删除的方法！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"传入参数为 userName: "</span><span class="token operator">+</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>JDK动态代理类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description 无论代理谁，只需要通过此工具类就可以进行代理
 * 接口InvocationHandler：实现该接口是为了提供 代理实例所需要调用处理程序实现的方法invoke()；每个代理实例都有一    个关联的调用处理程序
 * (通俗说就是代理实例调用接口方法时，把实现的方法扔到了该接口InvocationHandler，所以我们要实现该接口：代理模式)
 * 类Proxy：此类通过构造的所在类ObjectProxy的加载器和注入的接口来生成对应的代理类的实例
 */</span>
<span class="token comment">// JDK动态代理实现InvocationHandler接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target <span class="token punctuation">;</span><span class="token comment">//需要代理的目标对象</span>
    
	<span class="token comment">// 执行代理实例的方法并返回结果 : 当调用代理类对象的方法，会通过反射机制调用左边的invoke方法来实现</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"JDK动态代理，监听开始！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"JDK动态代理，监听结束！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//定义获取代理对象方法</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">getJDKProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> targetObject<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//为目标对象target赋值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> targetObject<span class="token punctuation">;</span>
        <span class="token comment">//JDK动态代理只能针对实现了接口的类进行代理，newProxyInstance 函数所需参数就可看出</span>
        <span class="token keyword">return</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>targetObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> targetObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类（测试的类对象自行设置）</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 实例化JDKProxy对象</span>
        <span class="token class-name">JdkProxy</span> jdkProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdkProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 通过真实对象来获取代理对象，此代理对象是动态生成的</span>
        <span class="token class-name">UserManager</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserManager</span><span class="token punctuation">)</span> jdkProxy<span class="token punctuation">.</span><span class="token function">getJDKProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserManagerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行新增方法</span>
        user<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"123123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>CGLIB三方动态代理（需要导入两个jar包，asm-5.2.jar,cglib-3.2.5.jar。版本自行选择）</p>
<blockquote>
<p>cglib动态代理是利用asm开源包，对代理对象类的class文件加载进来，通过修改其字节码生成子类来处理。</p>
</blockquote>
<ol>
<li><p>Cglib动态代理</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//Cglib动态代理，实现MethodInterceptor接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span><span class="token comment">//需要代理的目标对象</span>
    
    <span class="token comment">//重写拦截方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Cglib动态代理，监听开始！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> invoke <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//方法执行，参数：target 目标对象 arr参数数组</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Cglib动态代理，监听结束！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> invoke<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//定义获取代理对象方法</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getCglibProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> objectTarget<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//为目标对象target赋值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> objectTarget<span class="token punctuation">;</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置父类,因为Cglib是针对指定的类生成一个子类，所以需要指定父类</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>objectTarget<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设置回调 </span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建并返回代理对象</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CglibProxy</span> cglib <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实例化CglibProxy对象</span>
        <span class="token class-name">UserManager</span> user <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">UserManager</span><span class="token punctuation">)</span> cglib<span class="token punctuation">.</span><span class="token function">getCglibProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserManagerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取代理对象</span>
        user<span class="token punctuation">.</span><span class="token function">delUser</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行删除方法</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-8-装饰器模式"><a href="#1-8-装饰器模式" class="headerlink" title="1.8 装饰器模式"></a>1.8 装饰器模式</h3><blockquote>
<p>设计核心：动态地给一个对象添加一些额外的功能，<strong>换言之</strong>，本质是把新方法和原方法缝合，不是像继承的那种真正的扩展。就增加功能来说，装饰模式比生成子类更为灵活，因为装饰器模式是在 对象整体外+新功能，而生成子类则是在 对象内部中+新功能。Java的IO流各种子类就是使用装饰器模式来解耦。</p>
<ul>
<li>以下图为例，都是在一代机器人上增添功能，两种方法，虚线的箱子表示装饰器模式  <img src="D:/App/Typora/TyporaSource/Private/Java基础/装饰器模式-机器人范例.png" style="zoom: 33%;" /></li>
</ul>
</blockquote>
<ul>
<li><p>装饰器模式</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Robot</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstRobot</span> <span class="token keyword">implements</span> <span class="token class-name">Robot</span><span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>printin（<span class="token string">"对话"</span>）<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span>printin（<span class="token string">"叫歌"</span>）<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>装饰器实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// public abstract class RobotDecorator implements Robot&#123; 若多重装饰，则可以令装饰器实现类为抽象类，层层封装</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RobotDecorator</span> <span class="token keyword">implements</span> <span class="token class-name">Robot</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// 我们希望组合Robot的子类，因此组合Robot对象，利用多态</span>
    <span class="token keyword">private</span> <span class="token class-name">Robot</span> robot<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">RobotDecorator</span><span class="token punctuation">(</span><span class="token class-name">Robot</span> robot<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>robot<span class="token operator">=</span>robot<span class="token punctuation">;</span>   
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        robot<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doMoreThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        robot<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"跳舞、拖地"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DecoratorPattern</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// 将一代机器人整体装饰，然后在外界新加 "跳舞、拖地" 的功能，执行这个封装方法 </span>
        <span class="token keyword">new</span> <span class="token class-name">RobotDecorator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FirstRobot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doMoreThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-9-组合模式"><a href="#1-9-组合模式" class="headerlink" title="1.9 组合模式"></a>1.9 组合模式</h3><blockquote>
<p>设计核心：你可以使用组合模式将对象组合成树状结构，并且能像使用独立对象一样使用他们；</p>
<ul>
<li>以下图为例  <img src="D:/App/Typora/TyporaSource/Private/Java基础/组合模式-树叶树干范例.png" style="zoom:67%;" /></li>
</ul>
</blockquote>
<ul>
<li><p>组合模式</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 统计接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Counter</span><span class="token punctuation">&#123;</span>
	<span class="token comment">// 计数</span>
    <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 叶子节点</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token keyword">implements</span> <span class="token class-name">Counter</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token keyword">int</span> sum<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sum <span class="token operator">=</span> sum<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 容器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Composite</span> <span class="token keyword">implements</span> <span class="token class-name">Counter</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span><span class="token punctuation">></span></span> counterList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Counter</span> counter<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        counterList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Counter</span> counter<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        counterList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span><span class="token punctuation">></span></span> <span class="token function">getChind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> counterList<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Counter</span> counter<span class="token operator">:</span>counterList<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			sum <span class="token operator">+=</span> counter<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompositePattern</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		
        <span class="token class-name">Composite</span> china<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        china<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        china<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
        <span class="token class-name">Composite</span> <span class="token class-name">ShanXi</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ShanXi</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ShanXi</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        china<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ShanXi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>china<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>	
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-10-外观模式"><a href="#1-10-外观模式" class="headerlink" title="1.10 外观模式"></a>1.10 外观模式</h3><blockquote>
<p>设计核心：要求一个子系统的外部与其内部的通信必须通过一个统一的对象进行。外观模式提供一个高层次的接口，使得子系统更易使用，但不符合开闭原则，<strong>换言之</strong>，就是门面模式，</p>
<ul>
<li>Q</li>
</ul>
</blockquote>
<ul>
<li>外观模式<ol>
<li>Q</li>
</ol>
</li>
</ul>
<h3 id="1-11享元模式"><a href="#1-11享元模式" class="headerlink" title="1.11享元模式"></a>1.11享元模式</h3><blockquote>
<p>设计核心：运用共享技术有效地支持大量细类度的对象</p>
<ul>
<li>享元模式最典型的应用就是池技术，如字符串常量池、数据连接池</li>
</ul>
</blockquote>
<ul>
<li>享元模式<ol>
<li>Q</li>
</ol>
</li>
</ul>
<h3 id="1-12-模板方法模式"><a href="#1-12-模板方法模式" class="headerlink" title="1.12 模板方法模式"></a>1.12 模板方法模式</h3><blockquote>
<p>设计核心：定义一个操作中的算法的框架，而将一些步骤延迟到子类中。使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤，换言之，父类一般是抽象步骤的接口，子类继承再具体实现，符合开闭原则</p>
<ul>
<li>Q</li>
</ul>
</blockquote>
<ul>
<li>模板方法模式</li>
</ul>
<h3 id="1-13-命令模式"><a href="#1-13-命令模式" class="headerlink" title="1.13 命令模式"></a>1.13 命令模式</h3><blockquote>
<p>设计核心：它可将请求转换为一个包含与请求相关的所有信息的独立对象。该转换让你能根据不同的请求将方法参数化、延迟请求执行或将其放入队列中，且能实现可撤销操作，换言之，将动作的请求者从动作的执行者中解耦。</p>
<ul>
<li>命令模式范例 <a target="_blank" rel="noopener" href="https://blog.csdn.net/dx94sg/article/details/80389137">https://blog.csdn.net/dx94sg/article/details/80389137</a></li>
<li>命令模式的作用：现在有两个类电视和电灯都有on()和off()两个方法，我们需要设计一个遥控器类来控制电视和点灯的打开或者关闭；</li>
</ul>
</blockquote>
<ul>
<li><p>命令模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">&#123;</span>
 
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"灯打开了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"灯关闭了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tv</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电视打开了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电视关闭了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//遥控器，负责使用命令对象</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleRemoteController</span> <span class="token punctuation">&#123;</span>
	
	<span class="token comment">//有一个插槽持有命令，这个命令控制着一个装置</span>
	<span class="token class-name">Command</span> command<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">SimpleRemoteController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	
	<span class="token comment">//这个方法用来设置插槽控制的命令，如果想要改变遥控器按钮的行为，可以多次调用这个方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCommand</span><span class="token punctuation">(</span><span class="token class-name">Command</span> command<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>command <span class="token operator">=</span> command<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">//当按下按钮的时候，这个方法会被调用，调用当前命令的execute方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//所有命令对象都需要实现此接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Command</span> <span class="token punctuation">&#123;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//这是一个命令，所以需要事先Command接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LightOn</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span><span class="token punctuation">&#123;</span>
	
	<span class="token class-name">Light</span> light<span class="token punctuation">;</span>
	
	<span class="token comment">//构造器传入了电灯，以便被命令控制，然后记录在实例变量中，一旦调用execute，就由这个电灯成为接受者，负责接收请求</span>
	<span class="token keyword">public</span> <span class="token class-name">LightOn</span><span class="token punctuation">(</span><span class="token class-name">Light</span> light<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">//这个execute用于接收对象的的on方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		light<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//这是一个命令，所以需要事先Command接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LightOff</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span><span class="token punctuation">&#123;</span>
	
	<span class="token class-name">Light</span> light<span class="token punctuation">;</span>
	
	<span class="token comment">//构造器传入了电灯，以便被命令控制，然后记录在实例变量中，一旦调用execute，就由这个电灯成为接受者，负责接收请求</span>
	<span class="token keyword">public</span> <span class="token class-name">LightOff</span><span class="token punctuation">(</span><span class="token class-name">Light</span> light<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>light <span class="token operator">=</span> light<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">//这个execute用于接收对象的的off方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		light<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TvOn</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span><span class="token punctuation">&#123;</span>
 
	<span class="token class-name">Tv</span> tv<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">TvOn</span><span class="token punctuation">(</span><span class="token class-name">Tv</span> tv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">//这个execute用于接收对象的的on方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		tv<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TvOff</span> <span class="token keyword">implements</span> <span class="token class-name">Command</span><span class="token punctuation">&#123;</span>
 
	<span class="token class-name">Tv</span> tv<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">TvOff</span><span class="token punctuation">(</span><span class="token class-name">Tv</span> tv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token comment">//这个execute用于接收对象的的on方法</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		tv<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*
* 请求是light()，将请求拆分成命令对象LightOn或LightOff,此时命令单独存在解耦，若需组合命令，则将命令自由加入
* SimpleRemoteController类，此时内类组合对象为队列即可，然后再遍历执行队列中command.execute()方法，这样组合命令
* 比调用一个请求命令或再门面模式包装各自单独命令更简洁，也更容易维护；
*/</span>
<span class="token comment">//这是命令模式的客户</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//遥控器就是调用者，会传入一个命令对象，用来发出请求</span>
        <span class="token class-name">SimpleRemoteController</span> simpleRemoteController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRemoteController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建一个请求接受者对象</span>
        <span class="token class-name">Light</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Light</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建一个命令对象，将请求接受者传给过来</span>
        <span class="token class-name">LightOn</span> on <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LightOn</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>on<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LightOff</span> off <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LightOff</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>off<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Tv</span> tv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TvOn</span> tvOn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TvOn</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>tvOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TvOff</span> tvOff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TvOff</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>tvOff<span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleRemoteController<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
</ul>
<h3 id="1-14-迭代器模式"><a href="#1-14-迭代器模式" class="headerlink" title="1.14 迭代器模式"></a>1.14 迭代器模式</h3><blockquote>
<p>设计核心：提供一种方法访问一个容器对象中各个元素，而又不暴露该对象的内部细节。</p>
<ul>
<li>iterator适用于需增删等操作的遍历取值操作，而foreach适用于不增删等操作的遍历取值操作，for无特色，详见Java优化；</li>
<li>由于迭代器模式是与集合共生共死的，提供迭代器都会内部提供，不需要手动实现；</li>
</ul>
</blockquote>
<ul>
<li><p>迭代器模式</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 迭代器类接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Iterator</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 容器类接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Aggregate</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">Iterator</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteIterator</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> cursor <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">ConcreteIterator</span><span class="token punctuation">(</span><span class="token class-name">List</span> list<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>cursor<span class="token operator">==</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cursor<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> obj<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteAggregate</span> <span class="token keyword">implements</span> <span class="token class-name">Aggregate</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
	<span class="token keyword">public</span> <span class="token class-name">Iterator</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteIterator</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
 
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token class-name">Aggregate</span> ag <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ag<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"小明"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ag<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"小红"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ag<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"小刚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Iterator</span> it <span class="token operator">=</span> ag<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
			<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
</ul>
<h3 id="1-15-观察者模式"><a href="#1-15-观察者模式" class="headerlink" title="1.15 观察者模式"></a>1.15 观察者模式</h3><blockquote>
<p>设计核心：定义对象间的一种一对多依赖关系，使得每当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。换言之，是发布-订阅模式，把订阅的方法放到发布中，当情况有变，就调用存放订阅方法的发布方法。</p>
<ul>
<li>有一个微信公众号服务，不定时发布一些消息，关注公众号就可以收到推送消息，取消关注就收不到推送消息。</li>
</ul>
</blockquote>
<ul>
<li><p>观察者模式</p>
<ol>
<li><p>接口类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/***
 * 抽象被观察者接口
 * 声明了添加、删除、通知观察者方法
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observerable</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/***
 * 抽象观察者
 * 定义了一个update()方法，当被观察者调用notifyObservers()方法时，观察者的update()方法会被回调。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>接口实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 被观察者，也就是微信公众号服务
 * 实现了Observerable接口，对Observerable接口的三个方法进行了具体实现
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WechatServer</span> <span class="token keyword">implements</span> <span class="token class-name">Observerable</span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">//注意到这个List集合的泛型参数为Observer接口，设计原则：面向接口编程而不是面向实现编程</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">WechatServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//遍历</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Observer</span> oserver <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            oserver<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setInfomation</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> s<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"微信服务更新消息： "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//消息更新，通知所有观察者</span>
        <span class="token function">notifyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 观察者
 * 实现了update方法
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">" 收到推送消息： "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">WechatServer</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WechatServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Observer</span> userZhang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"ZhangSan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Observer</span> userLi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"LiSi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Observer</span> userWang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"WangWu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        server<span class="token punctuation">.</span><span class="token function">registerObserver</span><span class="token punctuation">(</span>userZhang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">registerObserver</span><span class="token punctuation">(</span>userLi<span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">registerObserver</span><span class="token punctuation">(</span>userWang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">setInfomation</span><span class="token punctuation">(</span><span class="token string">"PHP是世界上最好用的语言！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span>userZhang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">setInfomation</span><span class="token punctuation">(</span><span class="token string">"JAVA是世界上最好用的语言！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <div align=left><img  src="Java基础/观察者模式-代码测试结果.png"/></div></li>
</ol>
</li>
</ul>
<h3 id="1-16-中介者模式"><a href="#1-16-中介者模式" class="headerlink" title="1.16 中介者模式"></a>1.16 中介者模式</h3><blockquote>
<p>设计核心：能让你少对家之间混乱无序的依赖关。该模式会限制对象之间的直接交互，迫使它们通过一个中介者对象进行合作。</p>
<ul>
<li>以联合国为例</li>
<li>从代码逻辑看：相比代理模式，此处使用抽象类继承，而继承可通过子类构造传参绑定父类组合对象，导致活用多态性；</li>
</ul>
</blockquote>
<ul>
<li><p>中介者模式</p>
<ol>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象中介者:联合国机构</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">UnitedNations</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">declare</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Country</span> country<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象国家类:需组合中介者角色，因为每个国家面对联合国机构而不面对各自国家</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Country</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token class-name">UnitedNations</span> unitedNations<span class="token punctuation">;</span>
    
    <span class="token comment">// 组合中介者角色，绑定中介角色</span>
    <span class="token keyword">public</span> <span class="token class-name">Country</span><span class="token punctuation">(</span><span class="token class-name">UnitedNations</span> unitedNations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>unitedNations <span class="token operator">=</span> unitedNations<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>继承抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 具体国家类，继承了抽象国家类。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> USA <span class="token keyword">extends</span> <span class="token class-name">Country</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 组合中介者角色</span>
    <span class="token keyword">public</span> <span class="token function">USA</span><span class="token punctuation">(</span><span class="token class-name">UnitedNations</span> unitedNations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>unitedNations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	
    <span class="token comment">// 通过父类调用绑定中介者角色的declare方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">declare</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        unitedNations<span class="token punctuation">.</span><span class="token function">declare</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"美国获得对方信息："</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Iraq</span> <span class="token keyword">extends</span> <span class="token class-name">Country</span> <span class="token punctuation">&#123;</span>
	
    <span class="token comment">// 子类传参绑定父类组合对象</span>
	<span class="token keyword">public</span> <span class="token class-name">Iraq</span><span class="token punctuation">(</span><span class="token class-name">UnitedNations</span> unitedNations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>unitedNations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">declare</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		unitedNations<span class="token punctuation">.</span><span class="token function">declare</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"伊拉克获得对方信息："</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 联合国安理会，具体中介者角色，继承抽象中介者，重写其declare()方法，对不同国家发送不同信息。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnitedNationsSecurityCouncil</span> <span class="token keyword">extends</span> <span class="token class-name">UnitedNations</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">USA</span> usa<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Iraq</span> iraq<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsa</span><span class="token punctuation">(</span><span class="token class-name">USA</span> usa<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usa <span class="token operator">=</span> usa<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIraq</span><span class="token punctuation">(</span><span class="token class-name">Iraq</span> iraq<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>iraq <span class="token operator">=</span> iraq<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">declare</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Country</span> country<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>country <span class="token operator">==</span> usa<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            iraq<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            usa<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">UnitedNationsSecurityCouncil</span> UNSC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnitedNationsSecurityCouncil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">USA</span> usa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">USA</span><span class="token punctuation">(</span>UNSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iraq</span> iraq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Iraq</span><span class="token punctuation">(</span>UNSC<span class="token punctuation">)</span><span class="token punctuation">;</span>

        UNSC<span class="token punctuation">.</span><span class="token function">setUsa</span><span class="token punctuation">(</span>usa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        UNSC<span class="token punctuation">.</span><span class="token function">setIraq</span><span class="token punctuation">(</span>iraq<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行流程：USA类的declare-->UnitedNations类的declare-->Iraq.getMessage(message)，实现了USA通过联合国向伊拉克喊话的功能，</span>
        <span class="token comment">// 语境理解：USA喊话，中介者联合会接受USA的喊话请求，以第三方的角色传递话语给Iraq，Iraq同样也可以通过中介者联合国喊话USA，甚者还可以加入第三个国家，无附属关系。但代理模式则是存在附属关系，与此不同</span>
        usa<span class="token punctuation">.</span><span class="token function">declare</span><span class="token punctuation">(</span><span class="token string">"不准研制核武器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iraq<span class="token punctuation">.</span><span class="token function">declare</span><span class="token punctuation">(</span><span class="token string">"我们没有核武器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <div align=left><img  src="Java基础/中介者模式-代码示例结果.png"/></div>

</li>
</ol>
</li>
</ul>
<h3 id="1-17-备忘录模式"><a href="#1-17-备忘录模式" class="headerlink" title="1.17 备忘录模式"></a>1.17 备忘录模式</h3><blockquote>
<p>设计核心：在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存着这个状态。这样以后就可将该对象恢复到原先保存的状态。</p>
<ul>
<li>为了符合迪米特法则，需要有一个管理备忘录的类</li>
<li>不要在频繁建立备份的场景中使用备忘录模式。为了节约内存，可使用原型模式+备忘录模式</li>
</ul>
</blockquote>
<ul>
<li><p>备忘录模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 发起人角色</span>
<span class="token comment">// 记录当前时刻的内部状态，并负责创建和恢复备忘录数据，允许访问返回到先前状态所需的所有数据。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Originator</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Memento</span> <span class="token function">createMento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Memento</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMemento</span><span class="token punctuation">(</span><span class="token class-name">Memento</span> memento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        state <span class="token operator">=</span> memento<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"state = "</span> <span class="token operator">+</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 备忘录角色</span>
<span class="token comment">// 负责存储Originator发起人对象的内部状态，在需要的时候提供发起人需要的内部状态。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Memento</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Memento</span><span class="token punctuation">(</span><span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 备忘录管理员角色</span>
<span class="token comment">// 对备忘录进行管理、保存和提供备忘录，只能将备忘录传递给其他角色。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Caretaker</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">Memento</span> memento<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Memento</span> <span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> memento<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMemento</span><span class="token punctuation">(</span><span class="token class-name">Memento</span> memento<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>memento <span class="token operator">=</span> memento<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 下面编写一小段代码测试一下，即先将状态置为On，保存后再将状态置为Off，然后通过备忘录管理员角色恢复初始状态。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Originator</span> originator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Originator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"On"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Originator初始状态</span>
        originator<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

        <span class="token class-name">Caretaker</span> caretaker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Caretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        caretaker<span class="token punctuation">.</span><span class="token function">setMemento</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">createMento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"Off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Originator状态变为Off</span>
        originator<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        originator<span class="token punctuation">.</span><span class="token function">setMemento</span><span class="token punctuation">(</span>caretaker<span class="token punctuation">.</span><span class="token function">getMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//回复初始状态</span>
        originator<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ol>
</li>
</ul>
<h3 id="1-18-解释器模式"><a href="#1-18-解释器模式" class="headerlink" title="1.18 解释器模式"></a>1.18 解释器模式</h3><blockquote>
<p>设计核心：暂时搁置</p>
<ul>
<li><p>以解释器模式来实现四则运算(减价法)：</p>
<p>  使用Calculator构造函数传参，并解析封装。这里根据栈的“先进后出”来安排运算的先后顺序（主要用在乘除法，这里只写了加减法比较简单）。以加法为例，Calculator构造函数接收一个表达式，然后把表达式转换为char数组，并判断运算符号，如果是‘+’则进行加法运算，把左边的数（left变量）和右边的数（right变量）加起来即可。</p>
</li>
<li><p>例如a+b-c这个表达式，根据for循环，首先被压入栈中的是a元素生成的VarExpression对象，然后判断到加号时，把a元素的对象从栈中pop出来，与右边的数组b进行相加，而b是通过当前的数组游标下移一个单元格得来的（为了防止该元素被再次遍历，通过++i的方式跳过下一遍历）。减法运算同理。</p>
</li>
</ul>
</blockquote>
<ul>
<li><p>解释器模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 解析器封装类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Calculator</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//定义表达式</span>
    <span class="token keyword">private</span> <span class="token class-name">Expression</span> expression<span class="token punctuation">;</span>

    <span class="token comment">//构造函数传参，并解析</span>
    <span class="token keyword">public</span> <span class="token class-name">Calculator</span><span class="token punctuation">(</span><span class="token class-name">String</span> expStr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//安排运算先后顺序</span>
        <span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Expression</span><span class="token punctuation">></span></span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//表达式拆分为字符数组</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> charArray <span class="token operator">=</span> expStr<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Expression</span> left <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">Expression</span> right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>charArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>charArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token string">'+'</span><span class="token operator">:</span>    <span class="token comment">//加法</span>
                left <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                right <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VarExpression</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>charArray<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AddExpression</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token operator">:</span>    <span class="token comment">//减法</span>
                left <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                right <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VarExpression</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>charArray<span class="token punctuation">[</span><span class="token operator">++</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SubExpression</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>    <span class="token comment">//公式中的变量</span>
                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VarExpression</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>charArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//计算</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token punctuation">.</span><span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象表达式类</span>
<span class="token comment">// 通过Map键值对，使键对应公式参数，如a、b、c等，值为运算时取得的具体数值。</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Expression</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//解析公式和数值，key是公式中的参数，value是具体的数值</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象继承类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 变量解析器</span>
<span class="token comment">// 通过interpreter()方法从map中取之。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VarExpression</span> <span class="token keyword">extends</span> <span class="token class-name">Expression</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">VarExpression</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">var</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象运算符号解析器</span>
<span class="token comment">// 这里，每个运算符合都只和自己左右两个数字有关系，但左右两个数字有可能也是一个解析的结果，无论何种类型，都是Expression类的实现类。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SymbolExpression</span> <span class="token keyword">extends</span> <span class="token class-name">Expression</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Expression</span> left<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Expression</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SymbolExpression</span><span class="token punctuation">(</span><span class="token class-name">Expression</span> left<span class="token punctuation">,</span> <span class="token class-name">Expression</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>二次继承抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 加法解析器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddExpression</span> <span class="token keyword">extends</span> <span class="token class-name">SymbolExpression</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">AddExpression</span><span class="token punctuation">(</span><span class="token class-name">Expression</span> left<span class="token punctuation">,</span> <span class="token class-name">Expression</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>left<span class="token punctuation">.</span><span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span>right<span class="token punctuation">.</span><span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 减法解析器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubExpression</span> <span class="token keyword">extends</span> <span class="token class-name">SymbolExpression</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">SubExpression</span><span class="token punctuation">(</span><span class="token class-name">Expression</span> left<span class="token punctuation">,</span> <span class="token class-name">Expression</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>left<span class="token punctuation">.</span><span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">super</span><span class="token punctuation">.</span>right<span class="token punctuation">.</span><span class="token function">interpreter</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 这里就比较简单了，通过getExpStr()方法获取表达式，再通过getValue()方法获取值的映射，最后再实例化Calculator类，通过run()方法获取最终的运算结果。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> expStr <span class="token operator">=</span> <span class="token function">getExpStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>expStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Calculator</span> calculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Calculator</span><span class="token punctuation">(</span>expStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"运算结果："</span> <span class="token operator">+</span> expStr <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> calculator<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//获得表达式</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getExpStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入表达式："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//获得值映射</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> expStr<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch <span class="token operator">:</span> expStr<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token string">'+'</span> <span class="token operator">&amp;&amp;</span> ch <span class="token operator">!=</span> <span class="token string">'-'</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"的值："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> in <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <div align=left><img  src="Java基础/解释器模式-代码示例结果.png" /></div></li>
</ol>
</li>
</ul>
<h3 id="1-19-状态模式"><a href="#1-19-状态模式" class="headerlink" title="1.19 状态模式"></a>1.19 状态模式</h3><blockquote>
<p>设计核心：允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。</p>
<ul>
<li>Q</li>
</ul>
</blockquote>
<ul>
<li><p>状态模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 首先定义出电梯的所有状态，然后定义当前电梯状态，再定义四种状态对应的方法，如Openning状态是由open()方法产生的。</span>
<span class="token comment">// 至于这些方法中的逻辑，就用print来代替了。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//定义出电梯的所有状态</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">LiftState</span> OPENNING_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenningState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">LiftState</span> CLOSING_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClosingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">LiftState</span> RUNNING_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunningState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">LiftState</span> STOPPING_STATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StoppingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//定义一个当前电梯状态</span>
    <span class="token keyword">private</span> <span class="token class-name">LiftState</span> liftState<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LiftState</span> <span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> liftState<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token comment">// 注意此处两次传参构造绑定组合对象：第一次是因为LiftState需绑定外界的对象，第二次因为调用liftState的方法，而在子类liftState的方法是继承父类即super.context，其需绑定对象为了更改liftState的状态，相当于改变Context的状态</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">LiftState</span> liftState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState <span class="token operator">=</span> liftState<span class="token punctuation">;</span>
        <span class="token comment">//通知到各个实现类中</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>liftState<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 这里我们定义并把Context这个环境角色聚合进来，并传递到子类。所以我们可以这样理解，Context环境角色的作用就是串联</span>
<span class="token comment">// 各个状态的过渡，也就是在4个具体的实现类中，各自根据自己的环境来决定如何进行状态的过渡。</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Context</span> context<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContext</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//电梯门开启动作</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//电梯门关闭动作</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//电梯运行</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//电梯停止</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象实现类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 对于开门状态，除去自身的开启电梯门的方法之外，在打开门之后应该还具备关闭电梯门的功能，而门开着的时候是不能运行</span>
<span class="token comment">// 也不能停止的。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OpenningState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//执行打开电梯门方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯门开启"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//打开后还可以关闭电梯门</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//状态修改</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>CLOSING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//动作委托为CLOSING_STATE执行</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//门开着不能运行</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//什么都不做</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//门开着已经停止了</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//什么都不做</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 对于闭门状态，除去自身外，电梯门关闭之后还可以再度打开，所以有open()方法；而门关了之后是可以运行的，所以有</span>
<span class="token comment">// run()方法；如果关了门没有按楼层的话，此时电梯处于停止状态，所以有stop()方法。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClosingState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//电梯门关了可以再开</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//置为敞门状态</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>OPENNING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// * 执行电梯门关闭方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯门关闭"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//电梯门关了就运行</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>RUNNING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//电梯门关了但没有按楼层</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>STOPPING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 当电梯处于运行状态时，此时当然是不能开门的；而门肯定是关了的，所以也不必执行关门方法；此时电梯可以从运行状态转</span>
<span class="token comment">// 变为停止状态。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunningState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//运行时不能开门</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//什么都不做</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//运行时门肯定是关的</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//什么都不做</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// * 执行运行方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯运行中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//运行后可以停止</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//环境设置为停止状态</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>STOPPING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 当电梯处于停止状态时，门是关闭着的，所以不能执行关门的方法；但此时是可以开门的；而停止后电梯也可以再度运行，所</span>
<span class="token comment">// 以存在run()方法。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StoppingState</span> <span class="token keyword">extends</span> <span class="token class-name">LiftState</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">//停下了要开门</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>OPENNING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//门本来就是关着的</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//什么都不做</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//停止后可以再运行</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>RUNNING_STATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getLiftState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//执行停止方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"电梯停止了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 这里假设初始状态为闭门状态，大家可以自行尝试其它初始值。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//定义初始状态为关门（共四种初始值）(本质还是利用多态)</span>
        context<span class="token punctuation">.</span><span class="token function">setLiftState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClosingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-20-策略模式"><a href="#1-20-策略模式" class="headerlink" title="1.20 策略模式"></a>1.20 策略模式</h3><blockquote>
<p>设计核心：定义一组算法，将每个算法都封装起来，并且使它们之间可以互换。策略模式让算法独立于使用它的客户而变化，也称为政策模式（Policy）</p>
<ul>
<li>以商场促销为例使用策略模式实现商场促销算法 例</li>
</ul>
</blockquote>
<ul>
<li><p>策略模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 首先声明一个CashSuper对象，通过构造方法，传入具体的收费策略，getResult()方法的功能为根据收费策略的不同获得计算结果。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CashContext</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">CashSuper</span> cashSuper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CashContext</span><span class="token punctuation">(</span><span class="token class-name">CashSuper</span> cashSuper<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cashSuper <span class="token operator">=</span> cashSuper<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> cashSuper<span class="token punctuation">.</span><span class="token function">acceptCash</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 策略类，为抽象类，抽象出收费的方法供子类实现。</span>
  <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CashSuper</span> <span class="token punctuation">&#123;</span>
      
      <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">acceptCash</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象继承里</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 正常收费子类：没有任何活动的情况，正常收费，返回原价。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CashNormal</span> <span class="token keyword">extends</span> <span class="token class-name">CashSuper</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">acceptCash</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> money<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 打折收费子类：打折活动，根据折扣返回打折后的价格。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CashRebate</span> <span class="token keyword">extends</span> <span class="token class-name">CashSuper</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">double</span> moneyRebate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">//折扣</span>

    <span class="token keyword">public</span> <span class="token class-name">CashRebate</span><span class="token punctuation">(</span><span class="token keyword">double</span> moneyRebate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moneyRebate <span class="token operator">=</span> moneyRebate<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">acceptCash</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> money <span class="token operator">*</span> moneyRebate<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 返利收费子类：返利活动，输入返利条件和返利值，比如满300返100，moneyCoditation为300，moneyReturn为100。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CashReturn</span> <span class="token keyword">extends</span> <span class="token class-name">CashSuper</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">double</span> moneyConditation <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>    <span class="token comment">//返利条件</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> moneyReturn <span class="token operator">=</span> <span class="token number">0.0d</span><span class="token punctuation">;</span>    <span class="token comment">//返利值</span>

    <span class="token keyword">public</span> <span class="token class-name">CashReturn</span><span class="token punctuation">(</span><span class="token keyword">double</span> moneyConditation<span class="token punctuation">,</span> <span class="token keyword">double</span> moneyReturn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moneyConditation <span class="token operator">=</span> moneyConditation<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moneyReturn <span class="token operator">=</span> moneyReturn<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">acceptCash</span><span class="token punctuation">(</span><span class="token keyword">double</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">double</span> result <span class="token operator">=</span> money<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>money <span class="token operator">>=</span> moneyConditation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 如果当前金额大于等于返利条件，则使用当前金额减去返利值。</span>
            result <span class="token operator">=</span> money <span class="token operator">-</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>money <span class="token operator">/</span> moneyConditation<span class="token punctuation">)</span> <span class="token operator">*</span> moneyReturn<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试端</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CashContext</span> cashContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入打折方式（1/2/3）："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> in <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>in<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                cashContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CashContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CashNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                type <span class="token operator">+=</span> <span class="token string">"正常收费"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                cashContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CashContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CashReturn</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                type <span class="token operator">+=</span> <span class="token string">"满300返100"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
                cashContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CashContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CashRebate</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                type <span class="token operator">+=</span> <span class="token string">"打8折"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"请输入1/2/3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">double</span> totalPrices <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入单价："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> price <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"请输入数量："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> num <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalPrices <span class="token operator">=</span> cashContext<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span>price <span class="token operator">*</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"单价："</span> <span class="token operator">+</span> price <span class="token operator">+</span> <span class="token string">"，数量："</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"，类型："</span> <span class="token operator">+</span> type <span class="token operator">+</span> <span class="token string">"，合计："</span> <span class="token operator">+</span> totalPrices<span class="token punctuation">)</span><span class="token punctuation">;</span>

        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <div align=left><img  src="Java基础/策略模式-代码示范结果.png" height="270" width="500"/></div></li>
</ol>
</li>
</ul>
<h3 id="1-21-职责链模式"><a href="#1-21-职责链模式" class="headerlink" title="1.21 职责链模式"></a>1.21 职责链模式</h3><blockquote>
<p>设计核心：使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这个对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。<strong>换言之</strong>，职责链就是所谓的多级结构，比如去医院开具病假条，普通医生只能开一天的证明，如果需要更多时常，则需将开具职责转交到上级去，上级医师只能开三天证明，如需更多时常，则需将职责转交到他的上级，以此类推</p>
<ul>
<li>以请假/加薪为例</li>
</ul>
</blockquote>
<ul>
<li><p>职责链模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 申请类,即封装请求对象</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Request</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> requestType<span class="token punctuation">;</span>    <span class="token comment">//申请类别</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> requestContent<span class="token punctuation">;</span>    <span class="token comment">//申请内容</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number<span class="token punctuation">;</span>    <span class="token comment">//数量</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> requestType<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRequestType</span><span class="token punctuation">(</span><span class="token class-name">String</span> requestType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>requestType <span class="token operator">=</span> requestType<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> requestContent<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRequestContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> requestContent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>requestContent <span class="token operator">=</span> requestContent<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象管理者：通过Manager抽象类管理所有管理者，setSuperior()方法用于定义职责链的下一级，即定义当前管理者的上级。</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">protected</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">Manager</span> superior<span class="token punctuation">;</span>    <span class="token comment">//管理者的上级</span>

    <span class="token keyword">public</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//设置管理者的上级</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSuperior</span><span class="token punctuation">(</span><span class="token class-name">Manager</span> superior<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>superior <span class="token operator">=</span> superior<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//申请请求</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handlerRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象继承类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 经理类如下，只可批准两天以内的假期，其余请求将继续申请上级。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonManager</span> <span class="token keyword">extends</span> <span class="token class-name">Manager</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">CommonManager</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"请假"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//只能批准两天内的假期</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，时长："</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"天，被批准"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//其余请求申请上级</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>superior <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                superior<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 总监类如下，只可批准五天以内的假期，其余请求将继续申请上级。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Majordomo</span> <span class="token keyword">extends</span> <span class="token class-name">Manager</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">Majordomo</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"请假"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//只能批准五天内的假期</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，时长："</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"天，被批准"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//其余请求申请上级</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>superior <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                superior<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 总经理类，可以批准任意时常的假期，并且可以批准是否加薪。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeneralManager</span> <span class="token keyword">extends</span> <span class="token class-name">Manager</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">GeneralManager</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"请假"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//能批准任意时长的假期</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，时长："</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"天，被批准"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"加薪"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，金额：￥"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，被批准"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"加薪"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getRequestContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，金额：￥"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，再说吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CommonManager</span> commonManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonManager</span><span class="token punctuation">(</span><span class="token string">"尼古拉斯·经理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Majordomo</span> majordomo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Majordomo</span><span class="token punctuation">(</span><span class="token string">"尼古拉斯·总监"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GeneralManager</span> generalManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeneralManager</span><span class="token punctuation">(</span><span class="token string">"尼古拉斯·总经理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置上级</span>
        commonManager<span class="token punctuation">.</span><span class="token function">setSuperior</span><span class="token punctuation">(</span>majordomo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        majordomo<span class="token punctuation">.</span><span class="token function">setSuperior</span><span class="token punctuation">(</span>generalManager<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setRequestType</span><span class="token punctuation">(</span><span class="token string">"请假"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setRequestContent</span><span class="token punctuation">(</span><span class="token string">"adam请假"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commonManager<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request2<span class="token punctuation">.</span><span class="token function">setRequestType</span><span class="token punctuation">(</span><span class="token string">"请假"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request2<span class="token punctuation">.</span><span class="token function">setRequestContent</span><span class="token punctuation">(</span><span class="token string">"adam请假"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request2<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commonManager<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request3<span class="token punctuation">.</span><span class="token function">setRequestType</span><span class="token punctuation">(</span><span class="token string">"加薪"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request3<span class="token punctuation">.</span><span class="token function">setRequestContent</span><span class="token punctuation">(</span><span class="token string">"adam请求加薪"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request3<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commonManager<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request3<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request4<span class="token punctuation">.</span><span class="token function">setRequestType</span><span class="token punctuation">(</span><span class="token string">"加薪"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request4<span class="token punctuation">.</span><span class="token function">setRequestContent</span><span class="token punctuation">(</span><span class="token string">"adam请求加薪"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request4<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commonManager<span class="token punctuation">.</span><span class="token function">handlerRequest</span><span class="token punctuation">(</span>request4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h3 id="1-22-访问者模式"><a href="#1-22-访问者模式" class="headerlink" title="1.22 访问者模式"></a>1.22 访问者模式</h3><blockquote>
<p>设计核心：封装一些作用于某种数据结构的各元素的操作，它可以在不改变数据结构的前提下定义作用于这些元素的新的操作</p>
<ul>
<li>Q</li>
</ul>
</blockquote>
<ul>
<li><p>访问者模式</p>
<ol>
<li><p>普通类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 结构对象：元素生产者，一般容纳在多个不同类、不同接口的容器，如List、Set、Map等，在项目中，一般很少抽象出这个角色。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectStructure</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Element</span><span class="token punctuation">></span></span> elements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        elements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        elements<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Visitor</span> visitor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            element<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象访问者：此处可为抽象类或接口，用于声明访问者可以访问哪些元素，具体到程序中就是visit方法的参数定义哪些对象是可以被访问的。</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Visitor</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">visitConcreteElementA</span><span class="token punctuation">(</span><span class="token class-name">ConcreteElementA</span> concreteElementA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">visitConcreteElementB</span><span class="token punctuation">(</span><span class="token class-name">ConcreteElementB</span> concreteElementB<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 抽象元素：此处为接口后抽象类，用于声明接受哪一类访问者访问，程序上是通过accpet方法中的参数来定义的。</span>
<span class="token comment">// 抽象元素有两类方法，一是本身的业务逻辑，也就是元素作为一个业务处理单元必须完成的职责；另外一个是允许哪一个访问者来访问。这里只声明的第二类即accept方法。</span>
  <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Element</span> <span class="token punctuation">&#123;</span>
      
      <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Visitor</span> visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>抽象继承类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 具体访问者：影响访问者访问到一个类后该干什么、怎么干。这里以ConcreteVisitor1为例，ConcreteVisitor2就不再赘述了。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteVisitor1</span> <span class="token keyword">extends</span> <span class="token class-name">Visitor</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitConcreteElementA</span><span class="token punctuation">(</span><span class="token class-name">ConcreteElementA</span> concreteElementA<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>concreteElementA<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 被 "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 访问"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visitConcreteElementB</span><span class="token punctuation">(</span><span class="token class-name">ConcreteElementB</span> concreteElementB<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>concreteElementB<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 被 "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 访问"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 具体元素：实现accept方法，通常是visitor.visit(this)。这里以ConcreteElementA为例，ConcreteElementB就不再赘述了。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteElementA</span> <span class="token keyword">extends</span> <span class="token class-name">Element</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Visitor</span> visitor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        visitor<span class="token punctuation">.</span><span class="token function">visitConcreteElementA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">//其它方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试类</p>
 <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 我们通过以下场景模拟一下访问者模式。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ObjectStructure</span> objectStructure <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectStructure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        objectStructure<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteElementA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectStructure<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteElementB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ConcreteVisitor1</span> visitor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteVisitor1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ConcreteVisitor2</span> visitor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteVisitor2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        objectStructure<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectStructure<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>visitor2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <div align=left><img  src="Java基础/访问者模式-代码示例结果.png" /></div></li>
</ol>
</li>
</ul>
<h2 id="2-数据结构与算法"><a href="#2-数据结构与算法" class="headerlink" title="2. 数据结构与算法"></a>2. 数据结构与算法</h2><blockquote>
<p>Q</p>
</blockquote>
<h1 id="四、ECS基础"><a href="#四、ECS基础" class="headerlink" title="四、ECS基础"></a>四、ECS基础</h1><blockquote>
<p>Q</p>
</blockquote>
<h2 id="1-初始化配置"><a href="#1-初始化配置" class="headerlink" title="1. 初始化配置"></a>1. 初始化配置</h2><h3 id="1-1-实例初始化配置"><a href="#1-1-实例初始化配置" class="headerlink" title="1.1 实例初始化配置"></a>1.1 实例初始化配置</h3><ul>
<li><p>步骤</p>
<ol>
<li><p>修改实例ID(yinglonglll)和实例密码(54.Lu****ya)，等待实例重启；</p>
</li>
<li><p>打开Xshell软件，点击新建，更改名称为ECS的到期时间，输入公网ip，端口默认22，点击连接随后输入用户名</p>
<ul>
<li>windows系统用户名为administrator，Linux为root，密码为实例密码；</li>
</ul>
</li>
<li><p>连接完毕后在 /home目录下新建目录格式：/home/身份小写缩写_真实姓名小写缩写/**，主用户默认master,采用解压缩方式安装软件</p>
<ul>
<li>个人目录：/home/master_zzj/app</li>
<li>子目录：/home/master_zzj/env</li>
</ul>
</li>
<li><p>设置实例的安全组：实例–&gt;管理–&gt;安全组–&gt;配置规则，记得描述写上端口用途；</p>
</li>
<li><p>在 /home/master_zzj/env 安装JDK8</p>
</li>
<li><p>将linux防火墙永久关闭，对端口的控制仅在安全组上控制即可</p>
<blockquote>
<ul>
<li>先查看有无开启：systemctl status firewalld.service</li>
<li>有则先关闭再禁止：<ol>
<li>systemctl stop firewalld.service</li>
<li>systemctl disable firewalld.service</li>
</ol>
</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li><p>Linux的文件夹模式</p>
<ol>
<li>bin：常用命令</li>
<li>boot：开机会使用到</li>
<li>dev：外界的接入设备</li>
<li>etc：系统配置文件</li>
<li>home：用户主目录</li>
<li>lib：存放其他地方会调用的函数库，如bin和sbin会调用里面的函数库；</li>
<li>media：放置可删除设备</li>
<li>mnt：暂时挂载某些额外的设备</li>
<li>opt：给第三方软件放置的目录</li>
<li>root：系统管理员root的主文件夹，区分与home</li>
<li>sbin：放置开机时所需要调用的命令，普通用户都执行不了</li>
<li>srv：服务启动之后，需要访问的数据目录，如www服务需要访问的网页数据存放在/srv/www内</li>
<li>tmp：存放临时文件目录，该目录下的所有文件会被定时删除</li>
<li>var：var目录主要针对常态性变动的文件，比如，缓存，登录文件，以及某些软件运行所产生的文件，包括程序文件</li>
</ol>
</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">yinglonglll</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://yinglonglll.github.io/posts/981f.html">http://yinglonglll.github.io/posts/981f.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">yinglonglll</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Java/">
                                    <span class="chip bg-color">Java</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'hdO23UKnJJP3UWW6H70jzwov-gzGzoHsz',
        appKey: 'MbaKnMNVq2FupWTOJPYlBahW',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '留下你的足迹...'
    });
</script>

<!--酷Q推送-->

<!-- 直达评论 -->
<div id="to_comment" class="comment-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#vcomments" title="直达评论">
        <i class="fas fa-comments"></i>
    </a>
</div>

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/posts/981f.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.webp" class="responsive-img" alt="Java基础">
                        
                        <span class="card-title">Java基础</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            摘要：Java基础
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-02-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%AC%94%E8%AE%B0/" class="post-category">
                                    笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/essay-demo.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.webp" class="responsive-img" alt="随笔文章模板">
                        
                        <span class="card-title">随笔文章模板</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            摘要：随笔文章模板
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%9A%8F%E7%AC%94/" class="post-category">
                                    随笔
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%9A%8F%E7%AC%94/">
                        <span class="chip bg-color">随笔</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: yinglonglll<br />'
            + '文章作者: yinglonglll<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 对页面进行仿信纸样式修饰essay -->

<style> 
    .ititle { 
        margin: 15px 0; 
        text-align:center; 
        font-family: 'Architects Daughter', cursive; 
    } .ipage { 
        line-height: 30px; 
        margin: 0 auto; 
        padding: 15px 32px 29px; 
        background-color: #f9f9f9; 
        box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.26); 
        -moz-border-radius-bottomleft: 20px 500px; 
        -moz-border-radius-bottomright: 500px 30px; 
        -moz-border-radius-topright: 5px 100px; 
        -webkit-border-bottom-left-radius: 20px 500px; 
        -webkit-border-bottom-right-radius: 64px 10px; 
        -webkit-border-top-right-radius: 5px 100px; 
        border-bottom-left-radius: 20px 500px; 
        border-bottom-right-radius: 64px 10px; 
        border-top-right-radius: 5px 100px; 
        -webkit-background-size: 100% 30px; 
        -moz-box-shadow: 0 2px 10px 1px rgba(0, 0, 0, 0.2); 
        -webkit-box-shadow: 0 2px 10px 1px rgba(0, 0, 0, 0.2); 
        text-shadow: 0 1px 0 #F6EF97; 
        position: relative; 
    } 
    .izhengwen { 
        position: relative; 
        top: 0; 
        left: 0; 
        z-index: 2; 
        height: auto; 
        background: repeating-linear-gradient(to bottom, #f9f9f9, #f9f9f9 31px, #6BA2D8 1px, #f9f9f9); background-size: 100% 32px;
    } 
    #articleContent p { 
        margin: 0 
    } 
    .ititle { 
        font-family: 'Architects Daughter', cursive; 
        font-size: 1.45rem!important; padding: 10px auto; 
    } 
    .izhengwen p { 
        position: relative; 
        line-height: 2.2rem!important; 
        text-indent: 2em; 
        font-family: 'Architects Daughter', cursive!important; 
        font-size: 1.45rem!important; 
    } 
    .ipage::before { 
        content: " "; display: inline-block; 
        position: absolute; top: 0px; bottom: 0; 
        right: 52px; z-index: 4; 
        width: 4px; 
        height: 100%; 
        border-left: 1px solid #fca1a1; 
    } 
    .izhengwen p:nth-child(odd):before { 
        content: " "; 
        display: inline-block; 
        position: absolute; 
        top: 0; left: -16px; z-index: 3; 
        width: 24px; height: 24px; 
        background-color: #fff; 
        -webkit-border-radius: 50%; 
        -moz-border-radius: 50%; 
        border-radius: 50%; 
        box-shadow: inset 0px 2px 5px 0px rgba(0, 0, 0, 0.26); 
    } 
    .ipage:after { 
        content: " "; 
        display: inline-block; 
        position: absolute; 
        top: 0; 
        bottom: 0; 
        left: 52px; 
        z-index: 3; 
        width: 4px; 
        height: 100%; 
        border-left: 4px double #fca1a1; 
    } 
    .ipage p { 
        padding: 0 2em; 
        color: #333!important; 
    } 
    body.dark .ipage { 
        opacity: 0.85; 
    } 
    /*小屏幕下(手机类)的样式*/ 
    @media only screen and (max-width: 600px) { 
        .ipage { 
            padding: 15px 23px 29px; 
        } 
        .ipage:after { 
            left: 36px; 
        } 
        .ipage::before { 
            right: 36px; 
        } 
        .ipage p { 
            padding: 0 0.9em; 
        } 
    } 
</style>
    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card">
        <!-- <div class="toc-widget card" style="background-color: white;"> 解决黑夜模式下目录仍固定白色背景的情况-->
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="5198999470"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='list'
                   preload='auto'
                   volume='0.6'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <a href="/about" target="_blank">yinglonglll</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">74.2k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2021";
                        var startMonth = "11";
                        var startDate = "28";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis"><!-- 
    <a href="https://github.com/yinglonglll" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:948706806@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=948706806" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 948706806" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>



    <a href="https://space.bilibili.com/11388935" class="tooltipped" target="_blank" data-tooltip="在B站上关注我: " data-position="top" data-delay="50">
        <i class="fas fa-play-circle"></i>
    </a>
 -->
</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- 数字雨 -->
    <!-- <canvas id="canvas" width="1440" height="900" ></canvas> -->
    <script type="text/javascript" src="/js/DigitalRain.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    <!-- 动态标题 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var OriginTitile = document.title,st;
            document.addEventListener("visibilitychange", function () {
            document.hidden ? (document.title = "w(ﾟДﾟ)w页面崩溃啦~", clearTimeout(st)) : (document.title =
            "╰(*°▽°*)╯页面恢复啦~", st = setTimeout(function () {
            document.title = OriginTitile
            }, 3e3))
            })
        </script>
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script>(function (w, d, s, id) {
            if (typeof (w.webpushr) !== 'undefined') return; w.webpushr = w.webpushr || function () { (w.webpushr.q = w.webpushr.q || []).push(arguments) }; var js, fjs = d.getElementsByTagName(s)[0]; js = d.createElement(s); js.id = id; js.async = 1; js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window, document, 'script', 'webpushr-jssdk'));webpushr('setup', { 'key': 'BNgmq5FVdJ-KyqD36I-eH-mHzVd-IHkK8eYttWSgCh3CTz3e2okxqiuAoo9WKgf8E1Rx2n2HNqTa4Q3Oxlb-Nkk' });</script></body>

</html>
